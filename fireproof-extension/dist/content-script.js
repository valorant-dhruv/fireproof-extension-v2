/*! For license information please see content-script.js.LICENSE.txt */
(()=>{var __webpack_modules__={408:(e,t)=>{"use strict";var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function g(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||p}function w(){}function b(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=g.prototype;var _=b.prototype=new w;_.constructor=b,y(_,g.prototype),_.isPureReactComponent=!0;var v=Array.isArray,k=Object.prototype.hasOwnProperty,E={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var o,i={},s=null,a=null;if(null!=t)for(o in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)k.call(t,o)&&!T.hasOwnProperty(o)&&(i[o]=t[o]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];i.children=u}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===i[o]&&(i[o]=c[o]);return{$$typeof:r,type:e,key:s,ref:a,props:i,_owner:E.current}}function x(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function B(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,o,i,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case r:case n:c=!0}}if(c)return s=s(c=e),e=""===i?"."+B(c,0):i,v(s)?(o="",null!=e&&(o=e.replace(C,"$&/")+"/"),A(s,t,o,"",(function(e){return e}))):null!=s&&(x(s)&&(s=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,o+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(c=0,i=""===i?".":i+":",v(e))for(var u=0;u<e.length;u++){var d=i+B(a=e[u],u);c+=A(a,t,o,d,s)}else if(d=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof d)for(e=d.call(e),u=0;!(a=e.next()).done;)c+=A(a=a.value,t,o,d=i+B(a,u++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function P(e,t,r){if(null==e)return e;var n=[],o=0;return A(e,n,"","",(function(e){return t.call(r,e,o++)})),n}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},N={transition:null},F={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:N,ReactCurrentOwner:E};t.Children={map:P,forEach:function(e,t,r){P(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=s,t.PureComponent=b,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=y({},e.props),i=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=E.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)k.call(t,u)&&!T.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:r,type:e.type,key:i,ref:s,props:o,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,r){return D.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,r){return D.current.useReducer(e,t,r)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return D.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return D.current.useTransition()},t.version="18.2.0"},294:(e,t,r)=>{"use strict";e.exports=r(408)},887:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(294),o=r(796);const i=(...e)=>{var{useLiveQuery:t,database:r}=u();return i.database=r,t(...e)},s=i,a=(...e)=>{var{useDocument:t,database:r}=u();return a.database=r,t(...e)},c=a;function u(e="useFireproof",t={}){const r="string"==typeof e?o.fireproof(e,t):e;return{useLiveQuery:function(e,t={},o=[]){const[i,s]=n.useState({rows:o,docs:o.map((e=>e.doc))}),a=n.useCallback((async()=>{var n=await r.query(e,t);s({...n,docs:n.rows.map((e=>e.doc))})}),[JSON.stringify(t)]);return n.useEffect((()=>r.subscribe((()=>{a()}))),[r,a]),n.useEffect((()=>{a()}),[e.toString(),JSON.stringify(t)]),i},useDocument:function(e){const t=e._id,[o,i]=n.useState(e);var s=n.useCallback((async()=>{var e=t?{...o,_id:t}:o;return r.put(e)}),[t,o]);const a=n.useCallback((async()=>{t&&i(await r.get(t).catch((()=>e)))}),[t,e]);return n.useEffect((()=>r.subscribe((e=>{e.find((e=>e.key===t))&&a()}))),[t,a]),n.useEffect((()=>{a()}),[]),[o,(t,r)=>i(t?r?t:e=>({...e,...t}):e),s]},database:r,ready:!0}}Object.keys(o).forEach((function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})),t.FireproofCtx={},t.useDocument=c,t.useFireproof=u,t.useLiveQuery=s},796:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})},__copyProps=(e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of __getOwnPropNames(t))__hasOwnProp.call(e,o)||o===r||__defProp(e,o,{get:()=>t[o],enumerable:!(n=__getOwnPropDesc(t,o))||n.enumerable});return e},__toESM=(e,t,r)=>(r=null!=e?__create(__getProtoOf(e)):{},__copyProps(!t&&e&&e.__esModule?r:__defProp(r,"default",{value:e,enumerable:!0}),e)),__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),__publicField=(e,t,r)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,r),r),__accessCheck=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},__privateGet=(e,t,r)=>(__accessCheck(e,t,"read from private field"),r?r.call(e):t.get(e)),__privateAdd=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},__privateSet=(e,t,r,n)=>(__accessCheck(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),__privateWrapper=(e,t,r,n)=>({set _(n){__privateSet(e,t,n,r)},get _(){return __privateGet(e,t,n)}}),require_encode=__commonJS({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/encode.js"(e,t){t.exports=function e(t,n,o){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");n=n||[];for(var i=o=o||0;t>=r;)n[o++]=255&t|128,t/=128;for(;-128&t;)n[o++]=255&t|128,t>>>=7;return n[o]=0|t,e.bytes=o-i+1,n};var r=Math.pow(2,31)}}),require_decode=__commonJS({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/decode.js"(e,t){t.exports=function e(t,r){var n,o=0,i=0,s=r=r||0,a=t.length;do{if(s>=a||i>49)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=s-r,o}}}),require_length=__commonJS({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/length.js"(e,t){var r=Math.pow(2,7),n=Math.pow(2,14),o=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),a=Math.pow(2,42),c=Math.pow(2,49),u=Math.pow(2,56),d=Math.pow(2,63);t.exports=function(e){return e<r?1:e<n?2:e<o?3:e<i?4:e<s?5:e<a?6:e<c?7:e<u?8:e<d?9:10}}}),require_varint=__commonJS({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/index.js"(e,t){t.exports={encode:require_encode(),decode:require_decode(),encodingLength:require_length()}}}),require_number=__commonJS({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/codec/number.js"(e){function t(e){for(var t="",r=0;r<e.length;r++){var n=e[r];isNaN(Number(n))||" "===n?"-"!==n&&(t+=n):t+=String(9-Number(n))}return t}e.encode=function(e){if(isNaN(e))return"DaN";if(0===e)return"FE  0M0";if(e===1/0)return"FF";if(e===-1/0)return"DD";var r,n=e.toExponential().split("e"),o=Number(n[1])+500,i=n[0]+(-1===n[0].indexOf(".")?".":"")+"0".repeat(20),s="E"+(r=String(o)," ".repeat(3-r.length).substr(0,3)+r+"M")+String(i);return e>0?"F"+s:"D"+t(s)},e.decode=function(e){if("DaN"===e)return NaN;if("FF"===e)return 1/0;if("DD"===e)return-1/0;var r="D"===e[0],n=(r?t(e):e).slice(2).split("M");return Number((r?"-":"")+n[1]+"e"+String(Number(n[0])-500))}}}),require_object=__commonJS({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/codec/object.js"(e){var t={"?":"?@","!":"??",'"':"?%"},r={"?@":"?","??":"!","?%":'"'};e.factory=function(e){return{encode:n,decode:function(t){if("A"===t)return null;if("K!"===t)return[];for(var n,o=t.split('"'),i=[[]],s=0,a=o.length,c=0;c<a;c++){for(var u=o[c],d=u.length,l=0;"K"==u[l];)l++;for(var h=0;"!"==u[d-h-1];)h++;for(var f=u.slice(l,d-h),p=s+l,y=s;y<p;y++)i[y+1]=[],i[y].push(i[y+1]),n=i[s=p];for(0!==f.length&&n.push(e.decode(/\?[%\?@]/.test(m=f)?m.replace(/\?[%\?@]/g,(function(e){return r[e]})):m)),y=p=s-h;y<s;y++)i[y+1]=[],n=i[s=p]}var m;return i[0][0]}};function n(e){if(null===e)return"A";if(!Array.isArray(e))throw new Error("can only encode arrays");var t=e.length;if(0==t)return"K!";for(var r=o(e[0]),n=1;n<t;n++)r+='"'+o(e[n]);return"K"+r+"!"}function o(r){return"object"==typeof r?n(r):(o=e.encode(r),/[!"]/.test(o)?o.replace(/[\?!"]/g,(function(e){return t[e]})):o);var o}}}}),require_charwise=__commonJS({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/index.js"(e){var t=require_number(),r=require_object();e.flip=function(e){var t=e.toString(),r="";for(var n in t)r+="."==t[n]?".":9-+t[n];return r},e.number=t,e.string={encode:function(e){return/\x00|\x01/.test(e)?"J"+e.replace(/\x01/g,"").replace(/\x00/g,""):"J"+e},decode:function(e){if("J"===e[0])return e.substring(1)}},e.encode=function(t){return e[typeof t].encode(t)},e.decode=function(e){if(""===e)return e;if(!n[e[0]])throw new Error("no decoder for:"+JSON.stringify(e));return n[e[0]](e)},e.object=r.factory(e),e.boolean={encode:function(e){return e?"C":"B"},decode:function(e){return"C"===e}},e.undefined={encode:function(e){return"L"},decode:function(){}};var n={A:e.object.decode,B:e.boolean.decode,C:e.boolean.decode,D:e.number.decode,F:e.number.decode,J:e.string.decode,K:e.object.decode,L:e.undefined.decode};e.buffer=!1,e.type="charwise"}}),require_aspromise=__commonJS({"../../node_modules/.pnpm/@protobufjs+aspromise@1.1.2/node_modules/@protobufjs/aspromise/index.js"(e,t){t.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,o=2,i=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise((function(o,s){r[n]=function(e){if(i)if(i=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];o.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,s(e))}}))}}}),require_base64=__commonJS({"../../node_modules/.pnpm/@protobufjs+base64@1.1.2/node_modules/@protobufjs/base64/index.js"(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};var r,n=new Array(64),o=new Array(123);for(r=0;r<64;)o[n[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,r){for(var o,i=null,s=[],a=0,c=0;t<r;){var u=e[t++];switch(c){case 0:s[a++]=n[u>>2],o=(3&u)<<4,c=1;break;case 1:s[a++]=n[o|u>>4],o=(15&u)<<2,c=2;break;case 2:s[a++]=n[o|u>>6],s[a++]=n[63&u],c=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=n[o],s[a++]=61,1===c&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var i="invalid encoding";t.decode=function(e,t,r){for(var n,s=r,a=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61===u&&a>1)break;if(void 0===(u=o[u]))throw Error(i);switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error(i);return r-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}}),require_eventemitter=__commonJS({"../../node_modules/.pnpm/@protobufjs+eventemitter@1.1.0/node_modules/@protobufjs/eventemitter/index.js"(e,t){function r(){this._listeners={}}t.exports=r,r.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}}}),require_float=__commonJS({"../../node_modules/.pnpm/@protobufjs+float@1.0.2/node_modules/@protobufjs/float/index.js"(e,t){function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3]}function i(e,n,o){t[0]=e,n[o]=r[3],n[o+1]=r[2],n[o+2]=r[1],n[o+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?o:i,e.writeFloatBE=n?i:o,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),o=2*(n>>31)+1,i=n>>>23&255,s=8388607&n;return 255===i?s?NaN:o*(1/0):0===i?1401298464324817e-60*o*s:o*Math.pow(2,i-150)*(s+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,i),e.readFloatBE=r.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3],n[o+4]=r[4],n[o+5]=r[5],n[o+6]=r[6],n[o+7]=r[7]}function i(e,n,o){t[0]=e,n[o]=r[7],n[o+1]=r[6],n[o+2]=r[5],n[o+3]=r[4],n[o+4]=r[3],n[o+5]=r[2],n[o+6]=r[1],n[o+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?o:i,e.writeDoubleBE=n?i:o,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,o,i){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,o,i+t),e(1/n>0?0:2147483648,o,i+r);else if(isNaN(n))e(0,o,i+t),e(2146959360,o,i+r);else if(n>17976931348623157e292)e(0,o,i+t),e((s<<31|2146435072)>>>0,o,i+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,o,i+t),e((s<<31|a/4294967296)>>>0,o,i+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=n*Math.pow(2,-c))>>>0,o,i+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,o,i+r)}}}function r(e,t,r,n,o){var i=e(n,o+t),s=e(n,o+r),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+i;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,i,0,4),e.readDoubleBE=r.bind(null,s,4,0)}(),e}function n(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=r(r)}}),require_inquire=__commonJS({"../../node_modules/.pnpm/@protobufjs+inquire@1.1.0/node_modules/@protobufjs/inquire/index.js"(exports,module){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire}}),require_utf8=__commonJS({"../../node_modules/.pnpm/@protobufjs+utf8@1.1.0/node_modules/@protobufjs/utf8/index.js"(e){var t=e;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,i=[],s=0;t<r;)(n=e[t++])<128?i[s++]=n:n>191&&n<224?i[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(n>>10),i[s++]=56320+(1023&n)):i[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))},t.write=function(e,t,r){for(var n,o,i=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&o),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-i}}}),require_pool=__commonJS({"../../node_modules/.pnpm/@protobufjs+pool@1.1.0/node_modules/@protobufjs/pool/index.js"(e,t){t.exports=function(e,t,r){var n=r||8192,o=n>>>1,i=null,s=n;return function(r){if(r<1||r>o)return e(r);s+r>n&&(i=e(n),s=0);var a=t.call(i,s,s+=r);return 7&s&&(s=1+(7|s)),a}}}}),require_longbits=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/util/longbits.js"(e,t){t.exports=n;var r=require_minimal();function n(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=n.zero=new n(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var i=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new n(r,i)},n.from=function(e){if("number"==typeof e)return n.fromNumber(e);if(r.isString(e)){if(!r.Long)return n.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new n(e.low>>>0,e.high>>>0):o},n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;n.fromHash=function(e){return e===i?o:new n((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},n.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}}}),require_minimal=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/util/minimal.js"(e){var t=e;function r(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=require_aspromise(),t.base64=require_base64(),t.EventEmitter=require_eventemitter(),t.float=require_float(),t.inquire=require_inquire(),t.utf8=require_utf8(),t.pool=require_pool(),t.LongBits=require_longbits(),t.isNode=Boolean(void 0!==__webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.process&&__webpack_require__.g.process.versions&&__webpack_require__.g.process.versions.node),t.global=t.isNode&&__webpack_require__.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||e,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}}),require_writer=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/writer.js"(e,t){t.exports=d;var r,n=require_minimal(),o=n.LongBits,i=n.base64,s=n.utf8;function a(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new a(c,0,0),this.tail=this.head,this.states=null}var l=function(){return n.Buffer?function(){return(d.create=function(){return new r})()}:function(){return new d}};function h(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function p(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=l(),d.alloc=function(e){return new n.Array(e)},n.Array!==Array&&(d.alloc=n.pool(d.alloc,n.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new a(e,t,r),this.len+=t,this},f.prototype=Object.create(a.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(p,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=o.from(e);return this._push(p,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(p,t.length(),t)},d.prototype.bool=function(e){return this._push(h,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=o.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(n.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(n.float.writeDoubleLE,8,e)};var m=n.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(n.isString(e)){var r=d.alloc(t=i.length(e));i.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(h,1,0)},d.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new a(c,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(c,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){r=e,d.create=l(),r._configure()}}}),require_writer_buffer=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/writer_buffer.js"(e,t){t.exports=o;var r=require_writer();(o.prototype=Object.create(r.prototype)).constructor=o;var n=require_minimal();function o(){r.call(this)}function i(e,t,r){e.length<40?n.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o._configure=function(){o.alloc=n._Buffer_allocUnsafe,o.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&"set"===n.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){n.isString(e)&&(e=n._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=n.Buffer.byteLength(e);return this.uint32(t),t&&this._push(i,t,e),this},o._configure()}}),require_reader=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/reader.js"(e,t){t.exports=a;var r,n=require_minimal(),o=n.LongBits,i=n.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function a(e){this.buf=e,this.pos=0,this.len=e.length}var c,u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new a(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new a(e);throw Error("illegal buffer")},d=function(){return n.Buffer?function(e){return(a.create=function(e){return n.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function l(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}a.create=d(),a.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,a.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return c}),a.prototype.int32=function(){return 0|this.uint32()},a.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},a.prototype.bool=function(){return 0!==this.uint32()},a.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},a.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},a.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},a.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},a.prototype.string=function(){var e=this.bytes();return i.read(e,0,e.length)},a.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},a.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},a._configure=function(e){r=e,a.create=d(),r._configure();var t=n.Long?"toLong":"toNumber";n.merge(a.prototype,{int64:function(){return l.call(this)[t](!1)},uint64:function(){return l.call(this)[t](!0)},sint64:function(){return l.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}}}),require_reader_buffer=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/reader_buffer.js"(e,t){t.exports=o;var r=require_reader();(o.prototype=Object.create(r.prototype)).constructor=o;var n=require_minimal();function o(e){r.call(this,e)}o._configure=function(){n.Buffer&&(o.prototype._slice=n.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()}}),require_service=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/rpc/service.js"(e,t){t.exports=n;var r=require_minimal();function n(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(n.prototype=Object.create(r.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function e(t,n,o,i,s){if(!i)throw TypeError("request must be specified");var a=this;if(!s)return r.asPromise(e,a,t,n,o,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof o))try{r=o[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},n.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}}}),require_rpc=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/rpc.js"(e){e.Service=require_service()}}),require_roots=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/roots.js"(e,t){t.exports={}}}),require_index_minimal=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/index-minimal.js"(e){var t=e;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=require_writer(),t.BufferWriter=require_writer_buffer(),t.Reader=require_reader(),t.BufferReader=require_reader_buffer(),t.util=require_minimal(),t.rpc=require_rpc(),t.roots=require_roots(),t.configure=r,r()}}),require_minimal2=__commonJS({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/minimal.js"(e,t){t.exports=require_index_minimal()}}),require_murmurHash3js=__commonJS({"../../node_modules/.pnpm/murmurhash3js-revisited@3.0.0/node_modules/murmurhash3js-revisited/lib/murmurHash3js.js"(e,t){!function(r,n){var o={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function s(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function c(e){return e=s(e^=e>>>16,2246822507),(e=s(e^=e>>>13,3266489909))^e>>>16}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function l(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function h(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=f(e,[0,e[0]>>>1]),e=f(e=d(e,[4283543511,3981806797]),[0,e[0]>>>1]),f(e=d(e,[3301882366,444984403]),[0,e[0]>>>1])}o.x86.hash32=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%4,u=e.length-r,d=t,l=0,h=3432918353,f=461845907,p=0;p<u;p+=4)l=s(l=e[p]|e[p+1]<<8|e[p+2]<<16|e[p+3]<<24,h),l=s(l=a(l,15),f),d=s(d=a(d^=l,13),5)+3864292196;switch(l=0,r){case 3:l^=e[p+2]<<16;case 2:l^=e[p+1]<<8;case 1:l=s(l^=e[p],h),d^=l=s(l=a(l,15),f)}return(d=c(d^=e.length))>>>0},o.x86.hash128=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,u=e.length-r,d=t,l=t,h=t,f=t,p=0,y=0,m=0,g=0,w=597399067,b=2869860233,_=951274213,v=2716044179,k=0;k<u;k+=16)p=e[k]|e[k+1]<<8|e[k+2]<<16|e[k+3]<<24,y=e[k+4]|e[k+5]<<8|e[k+6]<<16|e[k+7]<<24,m=e[k+8]|e[k+9]<<8|e[k+10]<<16|e[k+11]<<24,g=e[k+12]|e[k+13]<<8|e[k+14]<<16|e[k+15]<<24,p=a(p=s(p,w),15),d=a(d^=p=s(p,b),19),d=s(d+=l,5)+1444728091,y=a(y=s(y,b),16),l=a(l^=y=s(y,_),17),l=s(l+=h,5)+197830471,m=a(m=s(m,_),17),h=a(h^=m=s(m,v),15),h=s(h+=f,5)+2530024501,g=a(g=s(g,v),18),f=a(f^=g=s(g,w),13),f=s(f+=d,5)+850148119;switch(p=0,y=0,m=0,g=0,r){case 15:g^=e[k+14]<<16;case 14:g^=e[k+13]<<8;case 13:g=s(g^=e[k+12],v),f^=g=s(g=a(g,18),w);case 12:m^=e[k+11]<<24;case 11:m^=e[k+10]<<16;case 10:m^=e[k+9]<<8;case 9:m=s(m^=e[k+8],_),h^=m=s(m=a(m,17),v);case 8:y^=e[k+7]<<24;case 7:y^=e[k+6]<<16;case 6:y^=e[k+5]<<8;case 5:y=s(y^=e[k+4],b),l^=y=s(y=a(y,16),_);case 4:p^=e[k+3]<<24;case 3:p^=e[k+2]<<16;case 2:p^=e[k+1]<<8;case 1:p=s(p^=e[k],w),d^=p=s(p=a(p,15),b)}return d^=e.length,d+=l^=e.length,d+=h^=e.length,l+=d+=f^=e.length,h+=d,f+=d,d=c(d),d+=l=c(l),d+=h=c(h),l+=d+=f=c(f),h+=d,f+=d,("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(l>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)},o.x64.hash128=function(e,t){if(o.inputValidation&&!i(e))return n;t=t||0;for(var r=e.length%16,s=e.length-r,a=[0,t],c=[0,t],y=[0,0],m=[0,0],g=[2277735313,289559509],w=[1291169091,658871167],b=0;b<s;b+=16)y=[e[b+4]|e[b+5]<<8|e[b+6]<<16|e[b+7]<<24,e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24],m=[e[b+12]|e[b+13]<<8|e[b+14]<<16|e[b+15]<<24,e[b+8]|e[b+9]<<8|e[b+10]<<16|e[b+11]<<24],y=l(y=d(y,g),31),a=u(a=l(a=f(a,y=d(y,w)),27),c),a=u(d(a,[0,5]),[0,1390208809]),m=l(m=d(m,w),33),c=u(c=l(c=f(c,m=d(m,g)),31),a),c=u(d(c,[0,5]),[0,944331445]);switch(y=[0,0],m=[0,0],r){case 15:m=f(m,h([0,e[b+14]],48));case 14:m=f(m,h([0,e[b+13]],40));case 13:m=f(m,h([0,e[b+12]],32));case 12:m=f(m,h([0,e[b+11]],24));case 11:m=f(m,h([0,e[b+10]],16));case 10:m=f(m,h([0,e[b+9]],8));case 9:m=d(m=f(m,[0,e[b+8]]),w),c=f(c,m=d(m=l(m,33),g));case 8:y=f(y,h([0,e[b+7]],56));case 7:y=f(y,h([0,e[b+6]],48));case 6:y=f(y,h([0,e[b+5]],40));case 5:y=f(y,h([0,e[b+4]],32));case 4:y=f(y,h([0,e[b+3]],24));case 3:y=f(y,h([0,e[b+2]],16));case 2:y=f(y,h([0,e[b+1]],8));case 1:y=d(y=f(y,[0,e[b]]),g),a=f(a,y=d(y=l(y,31),w))}return a=u(a=f(a,[0,e.length]),c=f(c,[0,e.length])),c=u(c,a),a=u(a=p(a),c=p(c)),c=u(c,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},void 0!==e?(void 0!==t&&t.exports&&(e=t.exports=o),e.murmurHash3=o):void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return o}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__=[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}}),require_murmurhash3js_revisited=__commonJS({"../../node_modules/.pnpm/murmurhash3js-revisited@3.0.0/node_modules/murmurhash3js-revisited/index.js"(e,t){t.exports=require_murmurHash3js()}}),require_err_code=__commonJS({"../../node_modules/.pnpm/err-code@3.0.1/node_modules/err-code/index.js"(e,t){function r(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}t.exports=function(e,t,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return r(e,n)}catch(t){n.message=e.message,n.stack=e.stack;const o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(e)),r(new o,n)}}}}),require_sparse_array=__commonJS({"../../node_modules/.pnpm/sparse-array@1.3.2/node_modules/sparse-array/index.js"(e,t){function r(e,t){return e+n(t)}function n(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function o(e,t){return e[0]-t[0]}function i(e){return e[1]}t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let r=this._internalPositionFor(e,!1);if(void 0===t)-1!==r&&(this._unsetInternalPos(r),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let n=!1;-1===r?(r=this._data.length,this._setBit(e),this._changedData=!0):n=!0,this._setInternalPos(r,e,t,n),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,r=new Array(this.length);for(;t<this.length;)r[t]=e(this.get(t),t,this),t++;return r}reduce(e,t){let r=0,n=t;for(;r<this.length;)n=e(n,this.get(r),r),r++;return n}find(e){let t,r,n=0;for(;n<this.length&&!t;)r=this.get(n),t=e(r),n++;return t?r:void 0}_internalPositionFor(e,t){const o=this._bytePosFor(e,t);if(o>=this._bitArrays.length)return-1;const i=this._bitArrays[o],s=e-7*o;return(i&1<<s)>0?this._bitArrays.slice(0,o).reduce(r,0)+n(i&~(4294967295<<s+1))-1:-1}_bytePosFor(e,t){const r=Math.floor(e/7),n=r+1;for(;!t&&this._bitArrays.length<n;)this._bitArrays.push(0);return r}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,r,n){const o=this._data,i=[t,r];if(n)this._sortData(),o[e]=i;else{if(o.length)if(o[o.length-1][0]>=t)o.push(i);else if(o[0][0]<=t)o.unshift(i);else{const e=Math.round(o.length/2);this._data=o.slice(0,e).concat(i).concat(o.slice(e))}else this._data.push(i);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(o),this._changedData=!1}bitField(){const e=[];let t,r=8,n=0,o=0;const i=this._bitArrays.slice();for(;i.length||n;){0===n&&(t=i.shift(),n=7);const s=Math.min(n,r);o|=(t&~(255<<s))<<8-r,t>>>=s,n-=s,r-=s,r&&(n||i.length)||(e.push(o),o=0,r=8)}for(var s=e.length-1;s>0&&0===e[s];s--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(i)}}}}),require_eventemitter3=__commonJS({"../../node_modules/.pnpm/eventemitter3@4.0.7/node_modules/eventemitter3/index.js"(e,t){var r=Object.prototype.hasOwnProperty,n="~";function o(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,t,o=[];if(0===this._eventsCount)return o;for(t in e=this._events)r.call(e,t)&&o.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},c.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},c.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,o,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,u,d=this._events[a],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,o),!0;case 5:return d.fn.call(d.context,t,r,o,i),!0;case 6:return d.fn.call(d.context,t,r,o,i,s),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var h,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,r);break;case 4:d[u].fn.call(d[u].context,t,r,o);break;default:if(!c)for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];d[u].fn.apply(d[u].context,c)}}return!0},c.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||r&&s.context!==r||a(this,i);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||o&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[i]=1===u.length?u[0]:u:a(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,void 0!==t&&(t.exports=c)}}),fireproof_exports={};__export(fireproof_exports,{DataStore:()=>DataStore,Database:()=>Database,Index:()=>Index,Loader:()=>Loader,MetaStore:()=>MetaStore,STORAGE_VERSION:()=>STORAGE_VERSION,cidListIncludes:()=>cidListIncludes,encodeCarFile:()=>encodeCarFile,encodeCarHeader:()=>encodeCarHeader,fireproof:()=>fireproof,index:()=>index,parseCarFile:()=>parseCarFile,toHexString:()=>toHexString,uniqueCids:()=>uniqueCids}),module.exports=__toCommonJS(fireproof_exports);var DIGITS="0123456789abcdef",UUID=class e{constructor(e){this.bytes=e}static ofInner(t){if(16!==t.length)throw new TypeError("not 128-bit length");return new e(t)}static fromFieldsV7(t,r,n,o){if(!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(n)||!Number.isInteger(o)||t<0||r<0||n<0||o<0||t>0xffffffffffff||r>4095||n>1073741823||o>4294967295)throw new RangeError("invalid field value");const i=new Uint8Array(16);return i[0]=t/2**40,i[1]=t/2**32,i[2]=t/2**24,i[3]=t/65536,i[4]=t/256,i[5]=t,i[6]=112|r>>>8,i[7]=r,i[8]=128|n>>>24,i[9]=n>>>16,i[10]=n>>>8,i[11]=n,i[12]=o>>>24,i[13]=o>>>16,i[14]=o>>>8,i[15]=o,new e(i)}static parse(t){var r,n,o,i;let s;switch(t.length){case 32:s=null===(r=/^[0-9a-f]{32}$/i.exec(t))||void 0===r?void 0:r[0];break;case 36:s=null===(n=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))||void 0===n?void 0:n.slice(1,6).join("");break;case 38:s=null===(o=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(t))||void 0===o?void 0:o.slice(1,6).join("");break;case 45:s=null===(i=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))||void 0===i?void 0:i.slice(1,6).join("")}if(s){const t=new Uint8Array(16);for(let e=0;e<16;e+=4){const r=parseInt(s.substring(2*e,2*e+8),16);t[e+0]=r>>>24,t[e+1]=r>>>16,t[e+2]=r>>>8,t[e+3]=r}return new e(t)}throw new SyntaxError("could not parse UUID string")}toString(){let e="";for(let t=0;t<this.bytes.length;t++)e+=DIGITS.charAt(this.bytes[t]>>>4),e+=DIGITS.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");return e}toHex(){let e="";for(let t=0;t<this.bytes.length;t++)e+=DIGITS.charAt(this.bytes[t]>>>4),e+=DIGITS.charAt(15&this.bytes[t]);return e}toJSON(){return this.toString()}getVariant(){const e=this.bytes[8]>>>4;if(e<0)throw new Error("unreachable");if(e<=7)return this.bytes.every((e=>0===e))?"NIL":"VAR_0";if(e<=11)return"VAR_10";if(e<=13)return"VAR_110";if(e<=15)return this.bytes.every((e=>255===e))?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return"VAR_10"===this.getVariant()?this.bytes[6]>>>4:void 0}clone(){return new e(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(let t=0;t<16;t++){const r=this.bytes[t]-e.bytes[t];if(0!==r)return Math.sign(r)}return 0}},V7Generator=class{constructor(e){this.timestamp=0,this.counter=0,this.random=null!=e?e:getDefaultRandom()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(e,t){let r=this.generateOrAbortCore(e,t);return void 0===r&&(this.timestamp=0,r=this.generateOrAbortCore(e,t)),r}generateOrAbortCore(e,t){if(!Number.isInteger(e)||e<1||e>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit positive integer");if(t<0||t>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+t>=this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return UUID.fromFieldsV7(this.timestamp,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}generateV4(){const e=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return e[6]=64|e[6]>>>4,e[8]=128|e[8]>>>2,UUID.ofInner(e)}},getDefaultRandom=()=>{if("undefined"!=typeof crypto&&void 0!==crypto.getRandomValues)return new BufferedCryptoRandom;if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");return{nextUint32:()=>65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random())}},BufferedCryptoRandom=class{constructor(){this.buffer=new Uint32Array(8),this.cursor=65535}nextUint32(){return this.cursor>=this.buffer.length&&(crypto.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}},defaultGenerator,uuidv7=()=>uuidv7obj().toString(),uuidv7obj=()=>(defaultGenerator||(defaultGenerator=new V7Generator)).generate();function writeQueue(e,t=1/0,r=!1){const n=[];let o=!1;async function i(){if(o||0===n.length)return;o=!0;const s=n.splice(0,t),a=s.map((e=>e.task));if(r){const t=a.map((async(t,r)=>{try{const n=await e([t]);s[r].resolve(n)}catch(e){s[r].reject(e)}}));await Promise.all(t)}else try{const t=await e(a);s.forEach((e=>e.resolve(t)))}catch(e){s.forEach((t=>t.reject(e)))}o=!1,i()}return{push:e=>new Promise(((t,r)=>{n.push({task:e,resolve:t,reject:r}),i()}))}}var encode_1=encode,MSB=128,REST=127,MSBALL=~REST,INT=Math.pow(2,31);function encode(e,t,r){t=t||[];for(var n=r=r||0;e>=INT;)t[r++]=255&e|MSB,e/=128;for(;e&MSBALL;)t[r++]=255&e|MSB,e>>>=7;return t[r]=0|e,encode.bytes=r-n+1,t}var decode=read,MSB$1=128,REST$1=127;function read(e,t){var r,n=0,o=0,i=t=t||0,s=e.length;do{if(i>=s)throw read.bytes=0,new RangeError("Could not decode varint");r=e[i++],n+=o<28?(r&REST$1)<<o:(r&REST$1)*Math.pow(2,o),o+=7}while(r>=MSB$1);return read.bytes=i-t,n}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length=function(e){return e<N1?1:e<N2?2:e<N3?3:e<N4?4:e<N5?5:e<N6?6:e<N7?7:e<N8?8:e<N9?9:10},varint={encode:encode_1,decode,encodingLength:length},_brrp_varint=varint,varint_default=_brrp_varint,decode2=(e,t=0)=>[varint_default.decode(e,t),varint_default.decode.bytes],encodeTo=(e,t,r=0)=>(varint_default.encode(e,t,r),t),encodingLength=e=>varint_default.encodingLength(e),empty=new Uint8Array(0),equals=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},coerce=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},fromString=e=>(new TextEncoder).encode(e),toString=e=>(new TextDecoder).decode(e),create=(e,t)=>{const r=t.byteLength,n=encodingLength(e),o=n+encodingLength(r),i=new Uint8Array(o+r);return encodeTo(e,i,0),encodeTo(r,i,n),i.set(t,o),new Digest(e,r,t,i)},decode3=e=>{const t=coerce(e),[r,n]=decode2(t),[o,i]=decode2(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Digest(r,o,s,t)},equals2=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&equals(e.bytes,r.bytes)}},Digest=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}},base58_exports={};function base(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(255!==r[s])throw new TypeError(i+" is ambiguous");r[s]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*u+1>>>0,s=new Uint8Array(i);e[t];){var d=r[e.charCodeAt(t)];if(255===d)return;for(var l=0,h=i-1;(0!==d||l<o)&&-1!==h;h--,l++)d+=a*s[h]>>>0,s[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");o=l,t++}if(" "!==e[t]){for(var f=i-o;f!==i&&0===s[f];)f++;for(var p=new Uint8Array(n+(i-f)),y=n;f!==i;)p[y++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var s=(i-o)*d+1>>>0,u=new Uint8Array(s);o!==i;){for(var l=t[o],h=0,f=s-1;(0!==l||h<n)&&-1!==f;f--,h++)l+=256*u[f]>>>0,u[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=h,o++}for(var p=s-n;p!==s&&0===u[p];)p++;for(var y=c.repeat(r);p<s;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}}__export(base58_exports,{base58btc:()=>base58btc,base58flickr:()=>base58flickr});var src=base,_brrp__multiformats_scope_baseX=src,base_x_default=_brrp__multiformats_scope_baseX,Encoder=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder=class{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return or(this,e)}},ComposedDecoder=class{constructor(e){this.decoders=e}or(e){return or(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},or=(e,t)=>new ComposedDecoder({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),Codec=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Encoder(e,t,r),this.decoder=new Decoder(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},from=({name:e,prefix:t,encode:r,decode:n})=>new Codec(e,t,r,n),baseX=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=base_x_default(r,t);return from({prefix:e,name:t,encode:n,decode:e=>coerce(o(e))})},decode4=(e,t,r,n)=>{const o={};for(let e=0;e<t.length;++e)o[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let a=0,c=0,u=0;for(let t=0;t<i;++t){const i=o[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},encode2=(e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&a>>s];if(s&&(i+=t[o&a<<r-s]),n)for(;i.length*r&7;)i+="=";return i},rfc4648=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>from({prefix:t,name:e,encode:e=>encode2(e,n,r),decode:t=>decode4(t,n,r,e)}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base32_exports={};__export(base32_exports,{base32:()=>base32,base32hex:()=>base32hex,base32hexpad:()=>base32hexpad,base32hexpadupper:()=>base32hexpadupper,base32hexupper:()=>base32hexupper,base32pad:()=>base32pad,base32padupper:()=>base32padupper,base32upper:()=>base32upper,base32z:()=>base32z});var base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),format=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?toStringV0(r,baseCache(e),t||base58btc.encoder):toStringV1(r,baseCache(e),t||base32.encoder)},cache=new WeakMap,baseCache=e=>{const t=cache.get(e);if(null==t){const t=new Map;return cache.set(e,t),t}return t},CID=class e{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:r}=this;if(t!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:r}=this.multihash,n=create(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&equals2(e.multihash,r.multihash)}toString(e){return format(this,e)}toJSON(){return{"/":format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;const r=t;if(r instanceof e)return r;if(null!=r["/"]&&r["/"]===r.bytes||r.asCID===r){const{version:t,code:n,multihash:o,bytes:i}=r;return new e(t,n,o,i||encodeCID(t,n,o.bytes))}if(!0===r[cidSymbol]){const{version:t,multihash:n,code:o}=r,i=decode3(n);return e.create(t,o,i)}return null}static create(t,r,n){if("number"!=typeof r)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:if(r!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new e(t,r,n,n.bytes);case 1:{const o=encodeCID(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,DAG_PB_CODE,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){const[r,n]=e.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){const r=e.inspectBytes(t),n=r.size-r.multihashSize,o=coerce(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");const i=o.subarray(r.multihashSize-r.digestSize),s=new Digest(r.multihashCode,r.digestSize,i,o);return[0===r.version?e.createV0(s):e.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=decode2(e.subarray(t));return t+=n,r};let n=r(),o=DAG_PB_CODE;if(18===n?(n=0,t=0):o=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,s=r(),a=r(),c=t+a;return{version:n,codec:o,multihashCode:s,digestSize:a,multihashSize:c-i,size:c}}static parse(t,r){const[n,o]=parseCIDtoBytes(t,r),i=e.decode(o);if(0===i.version&&"Q"!==t[0])throw Error("Version 0 CID string must not include multibase prefix");return baseCache(i).set(n,t),i}},parseCIDtoBytes=(e,t)=>{switch(e[0]){case"Q":{const r=t||base58btc;return[base58btc.prefix,r.decode(`${base58btc.prefix}${e}`)]}case base58btc.prefix:{const r=t||base58btc;return[base58btc.prefix,r.decode(e)]}case base32.prefix:{const r=t||base32;return[base32.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},toStringV0=(e,t,r)=>{const{prefix:n}=r;if(n!==base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=t.get(n);if(null==o){const o=r.encode(e).slice(1);return t.set(n,o),o}return o},toStringV1=(e,t,r)=>{const{prefix:n}=r,o=t.get(n);if(null==o){const o=r.encode(e);return t.set(n,o),o}return o},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(e,t,r)=>{const n=encodingLength(e),o=n+encodingLength(t),i=new Uint8Array(o+r.byteLength);return encodeTo(e,i,0),encodeTo(t,i,n),i.set(r,o),i},cidSymbol=Symbol.for("@ipld/js-cid/CID"),parse=(e,t)=>CID.parse(e,t),_blocks,MemoryBlockstore=class{constructor(e){__privateAdd(this,_blocks,new Map),e&&__privateSet(this,_blocks,new Map(e.map((e=>[e.cid.toString(),e.bytes]))))}async get(e){const t=__privateGet(this,_blocks).get(e.toString());if(t)return{cid:e,bytes:t}}async put(e,t){__privateGet(this,_blocks).set(e.toString(),t)}putSync(e,t){__privateGet(this,_blocks).set(e.toString(),t)}async delete(e){__privateGet(this,_blocks).delete(e.toString())}deleteSync(e){__privateGet(this,_blocks).delete(e.toString())}*entries(){for(const[e,t]of __privateGet(this,_blocks))yield{cid:parse(e),bytes:t}}},_fetchers;_blocks=new WeakMap;var MultiBlockFetcher=class{constructor(...e){__privateAdd(this,_fetchers,void 0),__privateSet(this,_fetchers,e)}async get(e){for(const t of __privateGet(this,_fetchers)){const r=await t.get(e);if(r)return r}}};_fetchers=new WeakMap;var Node=class{constructor(e){__publicField(this,"value"),__publicField(this,"next"),this.value=e}},_head,_tail,_size,Queue=class{constructor(){__privateAdd(this,_head,void 0),__privateAdd(this,_tail,void 0),__privateAdd(this,_size,void 0),this.clear()}enqueue(e){const t=new Node(e);__privateGet(this,_head)?(__privateGet(this,_tail).next=t,__privateSet(this,_tail,t)):(__privateSet(this,_head,t),__privateSet(this,_tail,t)),__privateWrapper(this,_size)._++}dequeue(){const e=__privateGet(this,_head);if(e)return __privateSet(this,_head,__privateGet(this,_head).next),__privateWrapper(this,_size)._--,e.value}clear(){__privateSet(this,_head,void 0),__privateSet(this,_tail,void 0),__privateSet(this,_size,0)}get size(){return __privateGet(this,_size)}*[Symbol.iterator](){let e=__privateGet(this,_head);for(;e;)yield e.value,e=e.next}};function pLimit(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new Queue;let r=0;const n=async(e,n,o)=>{r++;const i=(async()=>e(...o))();n(i);try{await i}catch{}r--,t.size>0&&t.dequeue()()},o=(o,...i)=>new Promise((s=>{((o,i,s)=>{t.enqueue(n.bind(void 0,o,i,s)),(async()=>{await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()})()})(o,s,i)}));return Object.defineProperties(o,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),o}_head=new WeakMap,_tail=new WeakMap,_size=new WeakMap;var src_exports={};__export(src_exports,{code:()=>code,decode:()=>decode10,encode:()=>encode6,name:()=>name});var typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(typeofs.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(isBuffer(e))return"Buffer";return getObjectType(e)||"Object"}function isBuffer(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function getObjectType(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(objectTypeNames.includes(t))return t}var Type=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};Type.uint=new Type(0,"uint",!0),Type.negint=new Type(1,"negint",!0),Type.bytes=new Type(2,"bytes",!0),Type.string=new Type(3,"string",!0),Type.array=new Type(4,"array",!1),Type.map=new Type(5,"map",!1),Type.tag=new Type(6,"tag",!1),Type.float=new Type(7,"float",!0),Type.false=new Type(7,"false",!0),Type.true=new Type(7,"true",!0),Type.null=new Type(7,"null",!0),Type.undefined=new Type(7,"undefined",!0),Type.break=new Type(7,"break",!0);var Token=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,textDecoder=new TextDecoder,textEncoder=new TextEncoder;function isBuffer2(e){return useBuffer&&globalThis.Buffer.isBuffer(e)}function asU8A(e){return e instanceof Uint8Array?isBuffer2(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var toString2=useBuffer?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):utf8Slice(e,t,r):(e,t,r)=>r-t>64?textDecoder.decode(e.subarray(t,r)):utf8Slice(e,t,r),fromString2=useBuffer?e=>e.length>64?globalThis.Buffer.from(e):utf8ToBytes(e):e=>e.length>64?textEncoder.encode(e):utf8ToBytes(e),fromArray=e=>Uint8Array.from(e),slice=useBuffer?(e,t,r)=>isBuffer2(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),concat=useBuffer?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),asU8A(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},alloc=useBuffer?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function compare(e,t){if(isBuffer2(e)&&isBuffer2(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function utf8ToBytes(e,t=1/0){let r;const n=e.length;let o=null;const i=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function utf8Slice(e,t,r){const n=[];for(;t<r;){const o=e[t];let i=null,s=o>239?4:o>223?3:o>191?2:1;if(t+s<=r){let r,n,a,c;switch(s){case 1:o<128&&(i=o);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&o)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&o)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&o)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=s}return decodeCodePointsArray(n)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){const t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}var defaultChunkSize=256,Bl=class{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=slice(r,0,this.cursor)}else t=concat(this.chunks,this.cursor);return e&&this.reset(),t}},decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:",uintMinorPrefixBytes=[];function assertEnoughData(e,t,r){if(e.length-t<r)throw new Error(`${decodeErrPrefix} not enough data for type`)}uintMinorPrefixBytes[23]=1,uintMinorPrefixBytes[24]=2,uintMinorPrefixBytes[25]=3,uintMinorPrefixBytes[26]=5,uintMinorPrefixBytes[27]=9;var uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(e,t,r){assertEnoughData(e,t,1);const n=e[t];if(!0===r.strict&&n<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint16(e,t,r){assertEnoughData(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint32(e,t,r){assertEnoughData(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint64(e,t,r){assertEnoughData(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&i<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(e,t,r,n){return new Token(Type.uint,readUint8(e,t+1,n),2)}function decodeUint16(e,t,r,n){return new Token(Type.uint,readUint16(e,t+1,n),3)}function decodeUint32(e,t,r,n){return new Token(Type.uint,readUint32(e,t+1,n),5)}function decodeUint64(e,t,r,n){return new Token(Type.uint,readUint64(e,t+1,n),9)}function encodeUint(e,t){return encodeUintValue(e,0,t.value)}function encodeUintValue(e,t,r){if(r<uintBoundaries[0]){const n=Number(r);e.push([t|n])}else if(r<uintBoundaries[1]){const n=Number(r);e.push([24|t,n])}else if(r<uintBoundaries[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<uintBoundaries[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<uintBoundaries[4]))throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&o,o>>=8,r[7]=255&o,o>>=8,r[6]=255&o,o>>=8,r[5]=255&o,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}function decodeNegint8(e,t,r,n){return new Token(Type.negint,-1-readUint8(e,t+1,n),2)}function decodeNegint16(e,t,r,n){return new Token(Type.negint,-1-readUint16(e,t+1,n),3)}function decodeNegint32(e,t,r,n){return new Token(Type.negint,-1-readUint32(e,t+1,n),5)}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9},encodeUint.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};var neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"!=typeof o){const e=-1-o;if(e>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(o),9)}function encodeNegint(e,t){const r=t.value,n="bigint"==typeof r?r*neg1b-pos1b:-1*r-1;encodeUintValue(e,t.type.majorEncoded,n)}function toToken(e,t,r,n){assertEnoughData(e,t,r+n);const o=slice(e,t+r,t+r+n);return new Token(Type.bytes,o,r+n)}function decodeBytesCompact(e,t,r,n){return toToken(e,t,1,r)}function decodeBytes8(e,t,r,n){return toToken(e,t,2,readUint8(e,t+1,n))}function decodeBytes16(e,t,r,n){return toToken(e,t,3,readUint16(e,t+1,n))}function decodeBytes32(e,t,r,n){return toToken(e,t,5,readUint32(e,t+1,n))}function decodeBytes64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken(e,t,9,o)}function tokenBytes(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===Type.string?fromString2(e.value):e.value),e.encodedBytes}function encodeBytes(e,t){const r=tokenBytes(t);encodeUintValue(e,t.type.majorEncoded,r.length),e.push(r)}function compareBytes(e,t){return e.length<t.length?-1:e.length>t.length?1:compare(e,t)}function toToken2(e,t,r,n,o){const i=r+n;assertEnoughData(e,t,i);const s=new Token(Type.string,toString2(e,t+r,t+i),i);return!0===o.retainStringBytes&&(s.byteValue=slice(e,t+r,t+i)),s}function decodeStringCompact(e,t,r,n){return toToken2(e,t,1,r,n)}function decodeString8(e,t,r,n){return toToken2(e,t,2,readUint8(e,t+1,n),n)}function decodeString16(e,t,r,n){return toToken2(e,t,3,readUint16(e,t+1,n),n)}function decodeString32(e,t,r,n){return toToken2(e,t,5,readUint32(e,t+1,n),n)}function decodeString64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken2(e,t,9,o,n)}encodeNegint.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*neg1b-pos1b:-1*t-1;return r<uintBoundaries[0]?1:r<uintBoundaries[1]?2:r<uintBoundaries[2]?3:r<uintBoundaries[3]?5:9},encodeNegint.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},encodeBytes.encodedSize=function(e){const t=tokenBytes(e);return encodeUintValue.encodedSize(t.length)+t.length},encodeBytes.compareTokens=function(e,t){return compareBytes(tokenBytes(e),tokenBytes(t))};var encodeString=encodeBytes;function toToken3(e,t,r,n){return new Token(Type.array,n,r)}function decodeArrayCompact(e,t,r,n){return toToken3(e,t,1,r)}function decodeArray8(e,t,r,n){return toToken3(e,t,2,readUint8(e,t+1,n))}function decodeArray16(e,t,r,n){return toToken3(e,t,3,readUint16(e,t+1,n))}function decodeArray32(e,t,r,n){return toToken3(e,t,5,readUint32(e,t+1,n))}function decodeArray64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken3(e,t,9,o)}function decodeArrayIndefinite(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken3(e,t,1,1/0)}function encodeArray(e,t){encodeUintValue(e,Type.array.majorEncoded,t.value)}function toToken4(e,t,r,n){return new Token(Type.map,n,r)}function decodeMapCompact(e,t,r,n){return toToken4(e,t,1,r)}function decodeMap8(e,t,r,n){return toToken4(e,t,2,readUint8(e,t+1,n))}function decodeMap16(e,t,r,n){return toToken4(e,t,3,readUint16(e,t+1,n))}function decodeMap32(e,t,r,n){return toToken4(e,t,5,readUint32(e,t+1,n))}function decodeMap64(e,t,r,n){const o=readUint64(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken4(e,t,9,o)}function decodeMapIndefinite(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken4(e,t,1,1/0)}function encodeMap(e,t){encodeUintValue(e,Type.map.majorEncoded,t.value)}function decodeTagCompact(e,t,r,n){return new Token(Type.tag,r,1)}function decodeTag8(e,t,r,n){return new Token(Type.tag,readUint8(e,t+1,n),2)}function decodeTag16(e,t,r,n){return new Token(Type.tag,readUint16(e,t+1,n),3)}function decodeTag32(e,t,r,n){return new Token(Type.tag,readUint32(e,t+1,n),5)}function decodeTag64(e,t,r,n){return new Token(Type.tag,readUint64(e,t+1,n),9)}function encodeTag(e,t){encodeUintValue(e,Type.tag.majorEncoded,t.value)}encodeArray.compareTokens=encodeUint.compareTokens,encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeMap.compareTokens=encodeUint.compareTokens,encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)},encodeTag.compareTokens=encodeUint.compareTokens,encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};var MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,e,t)}function decodeFloat16(e,t,r,n){return createToken(readFloat16(e,t+1),3,n)}function decodeFloat32(e,t,r,n){return createToken(readFloat32(e,t+1),5,n)}function decodeFloat64(e,t,r,n){return createToken(readFloat64(e,t+1),9,n)}function encodeFloat(e,t,r){const n=t.value;if(!1===n)e.push([Type.float.majorEncoded|MINOR_FALSE]);else if(!0===n)e.push([Type.float.majorEncoded|MINOR_TRUE]);else if(null===n)e.push([Type.float.majorEncoded|MINOR_NULL]);else if(void 0===n)e.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let t,o=!1;r&&!0===r.float64||(encodeFloat16(n),t=readFloat16(ui8a,1),n===t||Number.isNaN(n)?(ui8a[0]=249,e.push(ui8a.slice(0,3)),o=!0):(encodeFloat32(n),t=readFloat32(ui8a,1),n===t&&(ui8a[0]=250,e.push(ui8a.slice(0,5)),o=!0))),o||(encodeFloat64(n),t=readFloat64(ui8a,1),ui8a[0]=251,e.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){encodeFloat16(r);let e=readFloat16(ui8a,1);if(r===e||Number.isNaN(r))return 3;if(encodeFloat32(r),e=readFloat32(ui8a,1),r===e)return 5}return 9};var buffer=new ArrayBuffer(9),dataView=new DataView(buffer,1),ui8a=new Uint8Array(buffer,0);function encodeFloat16(e){if(e===1/0)dataView.setUint16(0,31744,!1);else if(e===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(e))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,e);const t=dataView.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)dataView.setUint16(0,31744,!1);else if(0===r)dataView.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?dataView.setUint16(0,0):e<-14?dataView.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):dataView.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function readFloat16(e,t){if(e.length-t<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,o=1023&r;let i;return i=0===n?o*2**-24:31!==n?(o+1024)*2**(n-25):0===o?1/0:NaN,32768&r?-i:i}function encodeFloat32(e){dataView.setFloat32(0,e,!1)}function readFloat32(e,t){if(e.length-t<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function encodeFloat64(e){dataView.setFloat64(0,e,!1)}function readFloat64(e,t){if(e.length-t<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function invalidMinor(e,t,r){throw new Error(`${decodeErrPrefix} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function errorer(e){return()=>{throw new Error(`${decodeErrPrefix} ${e}`)}}encodeFloat.compareTokens=encodeUint.compareTokens;var jump=[];for(let e=0;e<=23;e++)jump[e]=invalidMinor;jump[24]=decodeUint8,jump[25]=decodeUint16,jump[26]=decodeUint32,jump[27]=decodeUint64,jump[28]=invalidMinor,jump[29]=invalidMinor,jump[30]=invalidMinor,jump[31]=invalidMinor;for(let e=32;e<=55;e++)jump[e]=invalidMinor;jump[56]=decodeNegint8,jump[57]=decodeNegint16,jump[58]=decodeNegint32,jump[59]=decodeNegint64,jump[60]=invalidMinor,jump[61]=invalidMinor,jump[62]=invalidMinor,jump[63]=invalidMinor;for(let e=64;e<=87;e++)jump[e]=decodeBytesCompact;jump[88]=decodeBytes8,jump[89]=decodeBytes16,jump[90]=decodeBytes32,jump[91]=decodeBytes64,jump[92]=invalidMinor,jump[93]=invalidMinor,jump[94]=invalidMinor,jump[95]=errorer("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)jump[e]=decodeStringCompact;jump[120]=decodeString8,jump[121]=decodeString16,jump[122]=decodeString32,jump[123]=decodeString64,jump[124]=invalidMinor,jump[125]=invalidMinor,jump[126]=invalidMinor,jump[127]=errorer("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)jump[e]=decodeArrayCompact;jump[152]=decodeArray8,jump[153]=decodeArray16,jump[154]=decodeArray32,jump[155]=decodeArray64,jump[156]=invalidMinor,jump[157]=invalidMinor,jump[158]=invalidMinor,jump[159]=decodeArrayIndefinite;for(let e=160;e<=183;e++)jump[e]=decodeMapCompact;jump[184]=decodeMap8,jump[185]=decodeMap16,jump[186]=decodeMap32,jump[187]=decodeMap64,jump[188]=invalidMinor,jump[189]=invalidMinor,jump[190]=invalidMinor,jump[191]=decodeMapIndefinite;for(let e=192;e<=215;e++)jump[e]=decodeTagCompact;jump[216]=decodeTag8,jump[217]=decodeTag16,jump[218]=decodeTag32,jump[219]=decodeTag64,jump[220]=invalidMinor,jump[221]=invalidMinor,jump[222]=invalidMinor,jump[223]=invalidMinor;for(let e=224;e<=243;e++)jump[e]=errorer("simple values are not supported");jump[244]=invalidMinor,jump[245]=invalidMinor,jump[246]=invalidMinor,jump[247]=decodeUndefined,jump[248]=errorer("simple values are not supported"),jump[249]=decodeFloat16,jump[250]=decodeFloat32,jump[251]=decodeFloat64,jump[252]=invalidMinor,jump[253]=invalidMinor,jump[254]=invalidMinor,jump[255]=decodeBreak;var quick=[];for(let e=0;e<24;e++)quick[e]=new Token(Type.uint,e,1);for(let e=-1;e>=-24;e--)quick[31-e]=new Token(Type.negint,e,1);function quickEncodeToken(e){switch(e.type){case Type.false:return fromArray([244]);case Type.true:return fromArray([245]);case Type.null:return fromArray([246]);case Type.bytes:return e.value.length?void 0:fromArray([64]);case Type.string:return""===e.value?fromArray([96]):void 0;case Type.array:return 0===e.value?fromArray([128]):void 0;case Type.map:return 0===e.value?fromArray([160]):void 0;case Type.uint:return e.value<24?fromArray([Number(e.value)]):void 0;case Type.negint:if(e.value>=-24)return fromArray([31-Number(e.value)])}}quick[64]=new Token(Type.bytes,new Uint8Array(0),1),quick[96]=new Token(Type.string,"",1),quick[128]=new Token(Type.array,0,1),quick[160]=new Token(Type.map,0,1),quick[244]=new Token(Type.false,!1,1),quick[245]=new Token(Type.true,!0,1),quick[246]=new Token(Type.null,null,1);var defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const e=[];return e[Type.uint.major]=encodeUint,e[Type.negint.major]=encodeNegint,e[Type.bytes.major]=encodeBytes,e[Type.string.major]=encodeString,e[Type.array.major]=encodeArray,e[Type.map.major]=encodeMap,e[Type.tag.major]=encodeTag,e[Type.float.major]=encodeFloat,e}var cborEncoders=makeCborEncoders(),buf=new Bl,Ref=class e{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${encodeErrPrefix} object contains circular references`);return new e(r,t)}},simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new Token(e>=0?Type.uint:Type.negint,e):new Token(Type.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new Token(Type.uint,e):new Token(Type.negint,e),Uint8Array:(e,t,r,n)=>new Token(Type.bytes,e),string:(e,t,r,n)=>new Token(Type.string,e),boolean:(e,t,r,n)=>e?simpleTokens.true:simpleTokens.false,null:(e,t,r,n)=>simpleTokens.null,undefined:(e,t,r,n)=>simpleTokens.undefined,ArrayBuffer:(e,t,r,n)=>new Token(Type.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new Token(Type.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;n=Ref.createCheck(n,e);const o=[];let i=0;for(const t of e)o[i++]=objectToTokens(t,r,n);return r.addBreakTokens?[new Token(Type.array,e.length),o,new Token(Type.break)]:[new Token(Type.array,e.length),o]},Object(e,t,r,n){const o="Object"!==t,i=o?e.keys():Object.keys(e),s=o?e.size:i.length;if(!s)return!0===r.addBreakTokens?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;n=Ref.createCheck(n,e);const a=[];let c=0;for(const t of i)a[c++]=[objectToTokens(t,r,n),objectToTokens(o?e.get(t):e[t],r,n)];return sortMapEntries(a,r),r.addBreakTokens?[new Token(Type.map,s),a,new Token(Type.break)]:[new Token(Type.map,s),a]}};typeEncoders.Map=typeEncoders.Object,typeEncoders.Buffer=typeEncoders.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${e}Array`]=typeEncoders.DataView;function objectToTokens(e,t={},r){const n=is(e),o=t&&t.typeEncoders&&t.typeEncoders[n]||typeEncoders[n];if("function"==typeof o){const i=o(e,n,t,r);if(null!=i)return i}const i=typeEncoders[n];if(!i)throw new Error(`${encodeErrPrefix} unsupported type: ${n}`);return i(e,n,t,r)}function sortMapEntries(e,t){t.mapSorter&&e.sort(t.mapSorter)}function mapSorter(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const o=r.type.major,i=cborEncoders[o].compareTokens(r,n);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function tokensToEncoded(e,t,r,n){if(Array.isArray(t))for(const o of t)tokensToEncoded(e,o,r,n);else r[t.type.major](e,t,n)}function encodeCustom(e,t,r){const n=objectToTokens(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const o=t[n.type.major];if(o.encodedSize){const e=o.encodedSize(n,r),t=new Bl(e);if(o(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return asU8A(t.chunks[0])}}return buf.reset(),tokensToEncoded(buf,n,t,r),buf.toBytes(!0)}function encode3(e,t){return t=Object.assign({},defaultEncodeOptions,t),encodeCustom(e,cborEncoders,t)}var defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Tokeniser=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=quick[e];if(void 0===t){const r=jump[e];if(!r)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}},DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(e,t,r){const n=[];for(let o=0;o<e.value;o++){const i=tokensToObject(t,r);if(i===BREAK){if(e.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(i===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${o}, expected ${e.value})`);n[o]=i}return n}function tokenToMap(e,t,r){const n=!0===r.useMaps,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<e.value;s++){const a=tokensToObject(t,r);if(a===BREAK){if(e.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(a===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${s} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(n&&i.has(a)||!n&&a in o))throw new Error(`${decodeErrPrefix} found repeat map key "${a}"`);const c=tokensToObject(t,r);if(c===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${s} [no value], expected ${e.value})`);n?i.set(a,c):o[a]=c}return n?i:o}function tokensToObject(e,t){if(e.done())return DONE;const r=e.next();if(r.type===Type.break)return BREAK;if(r.type.terminal)return r.value;if(r.type===Type.array)return tokenToArray(r,e,t);if(r.type===Type.map)return tokenToMap(r,e,t);if(r.type===Type.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=tokensToObject(e,t);return t.tags[r.value](n)}throw new Error(`${decodeErrPrefix} tag not supported (${r.value})`)}throw new Error("unsupported")}function decode5(e,t){if(!(e instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);const r=(t=Object.assign({},defaultDecodeOptions,t)).tokenizer||new Tokeniser(e,t),n=tokensToObject(r,t);if(n===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(n===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);if(!r.done())throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return n}var encode_12=encode4,MSB2=128,REST2=127,MSBALL2=~REST2,INT2=Math.pow(2,31);function encode4(e,t,r){t=t||[];for(var n=r=r||0;e>=INT2;)t[r++]=255&e|MSB2,e/=128;for(;e&MSBALL2;)t[r++]=255&e|MSB2,e>>>=7;return t[r]=0|e,encode4.bytes=r-n+1,t}var decode6=read2,MSB$12=128,REST$12=127;function read2(e,t){var r,n=0,o=0,i=t=t||0,s=e.length;do{if(i>=s)throw read2.bytes=0,new RangeError("Could not decode varint");r=e[i++],n+=o<28?(r&REST$12)<<o:(r&REST$12)*Math.pow(2,o),o+=7}while(r>=MSB$12);return read2.bytes=i-t,n}var N12=Math.pow(2,7),N22=Math.pow(2,14),N32=Math.pow(2,21),N42=Math.pow(2,28),N52=Math.pow(2,35),N62=Math.pow(2,42),N72=Math.pow(2,49),N82=Math.pow(2,56),N92=Math.pow(2,63),length2=function(e){return e<N12?1:e<N22?2:e<N32?3:e<N42?4:e<N52?5:e<N62?6:e<N72?7:e<N82?8:e<N92?9:10},varint2={encode:encode_12,decode:decode6,encodingLength:length2},_brrp_varint2=varint2,varint_default2=_brrp_varint2,decode7=(e,t=0)=>[varint_default2.decode(e,t),varint_default2.decode.bytes],encodeTo2=(e,t,r=0)=>(varint_default2.encode(e,t,r),t),encodingLength2=e=>varint_default2.encodingLength(e),bytes_exports2={};__export(bytes_exports2,{coerce:()=>coerce2,empty:()=>empty2,equals:()=>equals3,fromHex:()=>fromHex,fromString:()=>fromString3,isBinary:()=>isBinary,toHex:()=>toHex,toString:()=>toString3});var empty2=new Uint8Array(0),toHex=e=>e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),fromHex=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):empty2},equals3=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},coerce2=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},isBinary=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),fromString3=e=>(new TextEncoder).encode(e),toString3=e=>(new TextDecoder).decode(e),create2=(e,t)=>{const r=t.byteLength,n=encodingLength2(e),o=n+encodingLength2(r),i=new Uint8Array(o+r);return encodeTo2(e,i,0),encodeTo2(r,i,n),i.set(t,o),new Digest2(e,r,t,i)},decode8=e=>{const t=coerce2(e),[r,n]=decode7(t),[o,i]=decode7(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Digest2(r,o,s,t)},equals4=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&equals3(e.bytes,r.bytes)}},Digest2=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function base2(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(255!==r[s])throw new TypeError(i+" is ambiguous");r[s]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*u+1>>>0,s=new Uint8Array(i);e[t];){var d=r[e.charCodeAt(t)];if(255===d)return;for(var l=0,h=i-1;(0!==d||l<o)&&-1!==h;h--,l++)d+=a*s[h]>>>0,s[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");o=l,t++}if(" "!==e[t]){for(var f=i-o;f!==i&&0===s[f];)f++;for(var p=new Uint8Array(n+(i-f)),y=n;f!==i;)p[y++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var s=(i-o)*d+1>>>0,u=new Uint8Array(s);o!==i;){for(var l=t[o],h=0,f=s-1;(0!==l||h<n)&&-1!==f;f--,h++)l+=256*u[f]>>>0,u[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=h,o++}for(var p=s-n;p!==s&&0===u[p];)p++;for(var y=c.repeat(r);p<s;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}}var src2=base2,_brrp__multiformats_scope_baseX2=src2,base_x_default2=_brrp__multiformats_scope_baseX2,Encoder2=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder2=class{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return or2(this,e)}},ComposedDecoder2=class{constructor(e){this.decoders=e}or(e){return or2(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},or2=(e,t)=>new ComposedDecoder2({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),Codec2=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Encoder2(e,t,r),this.decoder=new Decoder2(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},from2=({name:e,prefix:t,encode:r,decode:n})=>new Codec2(e,t,r,n),baseX2=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=base_x_default2(r,t);return from2({prefix:e,name:t,encode:n,decode:e=>coerce2(o(e))})},decode9=(e,t,r,n)=>{const o={};for(let e=0;e<t.length;++e)o[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let a=0,c=0,u=0;for(let t=0;t<i;++t){const i=o[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},encode5=(e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],s+=8;s>r;)s-=r,i+=t[o&a>>s];if(s&&(i+=t[o&a<<r-s]),n)for(;i.length*r&7;)i+="=";return i},rfc46482=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>from2({prefix:t,name:e,encode:e=>encode5(e,n,r),decode:t=>decode9(t,n,r,e)}),base58btc2=baseX2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr2=baseX2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base322=rfc46482({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper2=rfc46482({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad2=rfc46482({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper2=rfc46482({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex2=rfc46482({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper2=rfc46482({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad2=rfc46482({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper2=rfc46482({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z2=rfc46482({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),format2=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?toStringV02(r,baseCache2(e),t||base58btc2.encoder):toStringV12(r,baseCache2(e),t||base322.encoder)},cache2=new WeakMap,baseCache2=e=>{const t=cache2.get(e);if(null==t){const t=new Map;return cache2.set(e,t),t}return t},CID2=class e{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:r}=this;if(t!==DAG_PB_CODE2)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==SHA_256_CODE2)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:r}=this.multihash,n=create2(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&equals4(e.multihash,r.multihash)}toString(e){return format2(this,e)}toJSON(){return{"/":format2(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;const r=t;if(r instanceof e)return r;if(null!=r["/"]&&r["/"]===r.bytes||r.asCID===r){const{version:t,code:n,multihash:o,bytes:i}=r;return new e(t,n,o,i||encodeCID2(t,n,o.bytes))}if(!0===r[cidSymbol2]){const{version:t,multihash:n,code:o}=r,i=decode8(n);return e.create(t,o,i)}return null}static create(t,r,n){if("number"!=typeof r)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:if(r!==DAG_PB_CODE2)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE2}) block encoding`);return new e(t,r,n,n.bytes);case 1:{const o=encodeCID2(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,DAG_PB_CODE2,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){const[r,n]=e.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){const r=e.inspectBytes(t),n=r.size-r.multihashSize,o=coerce2(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");const i=o.subarray(r.multihashSize-r.digestSize),s=new Digest2(r.multihashCode,r.digestSize,i,o);return[0===r.version?e.createV0(s):e.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=decode7(e.subarray(t));return t+=n,r};let n=r(),o=DAG_PB_CODE2;if(18===n?(n=0,t=0):o=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,s=r(),a=r(),c=t+a;return{version:n,codec:o,multihashCode:s,digestSize:a,multihashSize:c-i,size:c}}static parse(t,r){const[n,o]=parseCIDtoBytes2(t,r),i=e.decode(o);if(0===i.version&&"Q"!==t[0])throw Error("Version 0 CID string must not include multibase prefix");return baseCache2(i).set(n,t),i}},parseCIDtoBytes2=(e,t)=>{switch(e[0]){case"Q":{const r=t||base58btc2;return[base58btc2.prefix,r.decode(`${base58btc2.prefix}${e}`)]}case base58btc2.prefix:{const r=t||base58btc2;return[base58btc2.prefix,r.decode(e)]}case base322.prefix:{const r=t||base322;return[base322.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},toStringV02=(e,t,r)=>{const{prefix:n}=r;if(n!==base58btc2.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=t.get(n);if(null==o){const o=r.encode(e).slice(1);return t.set(n,o),o}return o},toStringV12=(e,t,r)=>{const{prefix:n}=r,o=t.get(n);if(null==o){const o=r.encode(e);return t.set(n,o),o}return o},DAG_PB_CODE2=112,SHA_256_CODE2=18,encodeCID2=(e,t,r)=>{const n=encodingLength2(e),o=n+encodingLength2(t),i=new Uint8Array(o+r.byteLength);return encodeTo2(e,i,0),encodeTo2(t,i,n),i.set(r,o),i},cidSymbol2=Symbol.for("@ipld/js-cid/CID"),CID_CBOR_TAG=42;function cidEncoder(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=CID2.asCID(e);if(!t)return null;const r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,r)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};function cidDecoder(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID2.decode(e.subarray(1))}var decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;var name="dag-cbor",code=113,encode6=e=>encode3(e,encodeOptions),decode10=e=>decode5(e,decodeOptions),Kinds={Null:e=>null===e,Int:e=>Number.isInteger(e),Float:e=>"number"==typeof e&&Number.isFinite(e),String:e=>"string"==typeof e,Bool:e=>"boolean"==typeof e,Bytes:e=>e instanceof Uint8Array,Link:e=>!Kinds.Null(e)&&"object"==typeof e&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!Kinds.Null(e)&&"object"==typeof e&&e.asCID!==e&&!Kinds.List(e)&&!Kinds.Bytes(e)},Types={Int:Kinds.Int,"CarHeader > version":e=>Types.Int(e),"CarHeader > roots (anon) > valueType (anon)":Kinds.Link,"CarHeader > roots (anon)":e=>Kinds.List(e)&&Array.prototype.every.call(e,Types["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>Types["CarHeader > roots (anon)"](e),CarHeader:e=>{const t=e&&Object.keys(e);return Kinds.Map(e)&&["version"].every((e=>t.includes(e)))&&Object.entries(e).every((([e,t])=>Types["CarHeader > "+e]&&Types["CarHeader > "+e](t)))}},CarHeader=Types.CarHeader,import_varint3=__toESM(require_varint(),1),CIDV0_BYTES={SHA2_256:18,LENGTH:32,DAG_PB:112},V2_HEADER_LENGTH=40;function decodeVarint(e,t){if(!e.length)throw new Error("Unexpected end of data");const r=import_varint3.default.decode(e);return t.seek(import_varint3.default.decode.bytes),r}function decodeV2Header(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;return{version:2,characteristics:[t.getBigUint64(r,!0),t.getBigUint64(r+=8,!0)],dataOffset:Number(t.getBigUint64(r+=8,!0)),dataSize:Number(t.getBigUint64(r+=8,!0)),indexOffset:Number(t.getBigUint64(r+=8,!0))}}function getMultihashLength(e){import_varint3.default.decode(e);const t=import_varint3.default.decode.bytes,r=import_varint3.default.decode(e.subarray(import_varint3.default.decode.bytes));return t+import_varint3.default.decode.bytes+r}async function readHeader(e,t){const r=decodeVarint(await e.upTo(8),e);if(0===r)throw new Error("Invalid CAR header (zero length)");const n=await e.exactly(r,!0),o=decode10(n);if(!CarHeader(o))throw new Error("Invalid CAR header format");if(1!==o.version&&2!==o.version||void 0!==t&&o.version!==t)throw new Error(`Invalid CAR version: ${o.version}${void 0!==t?` (expected ${t})`:""}`);const i=Array.isArray(o.roots);if(1===o.version&&!i||2===o.version&&i)throw new Error("Invalid CAR header format");if(1===o.version)return o;const s=decodeV2Header(await e.exactly(V2_HEADER_LENGTH,!0));e.seek(s.dataOffset-e.pos);const a=await readHeader(e,1);return Object.assign(a,s)}async function readCid(e){const t=await e.exactly(2,!1);if(t[0]===CIDV0_BYTES.SHA2_256&&t[1]===CIDV0_BYTES.LENGTH){const t=await e.exactly(34,!0),r=decode3(t);return CID.create(0,CIDV0_BYTES.DAG_PB,r)}const r=decodeVarint(await e.upTo(8),e);if(1!==r)throw new Error(`Unexpected CID version (${r})`);const n=decodeVarint(await e.upTo(8),e),o=await e.exactly(getMultihashLength(await e.upTo(8)),!0),i=decode3(o);return CID.create(r,n,i)}async function readBlockHead(e){const t=e.pos;let r=decodeVarint(await e.upTo(8),e);if(0===r)throw new Error("Invalid CAR section (zero length)");return r+=e.pos-t,{cid:await readCid(e),length:r,blockLength:r-Number(e.pos-t)}}async function readBlock(e){const{cid:t,blockLength:r}=await readBlockHead(e);return{bytes:await e.exactly(r,!0),cid:t}}async function readBlockIndex(e){const t=e.pos,{cid:r,length:n,blockLength:o}=await readBlockHead(e),i={cid:r,length:n,blockLength:o,offset:t,blockOffset:e.pos};return e.seek(i.blockLength),i}function createDecoder(e){const t=(async()=>{const t=await readHeader(e);if(2===t.version){const r=e.pos-t.dataOffset;e=limitReader(e,t.dataSize-r)}return t})();return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await readBlock(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await readBlockIndex(e)}}}function bytesReader(e){let t=0;return{upTo:async r=>e.subarray(t,t+Math.min(r,e.length-t)),async exactly(r,n=!1){if(r>e.length-t)throw new Error("Unexpected end of data");const o=e.subarray(t,t+r);return n&&(t+=r),o},seek(e){t+=e},get pos(){return t}}}function chunkReader(e){let t=0,r=0,n=0,o=new Uint8Array(0);const i=async t=>{r=o.length-n;const i=[o.subarray(n)];for(;r<t;){const t=await e();if(null==t)break;r<0?t.length>r&&i.push(t.subarray(-r)):i.push(t),r+=t.length}o=new Uint8Array(i.reduce(((e,t)=>e+t.length),0));let s=0;for(const e of i)o.set(e,s),s+=e.length;n=0};return{upTo:async e=>(o.length-n<e&&await i(e),o.subarray(n,n+Math.min(o.length-n,e))),async exactly(e,r=!1){if(o.length-n<e&&await i(e),o.length-n<e)throw new Error("Unexpected end of data");const s=o.subarray(n,n+e);return r&&(t+=e,n+=e),s},seek(e){t+=e,n+=e},get pos(){return t}}}function asyncIterableReader(e){const t=e[Symbol.asyncIterator]();return chunkReader((async function(){const e=await t.next();return e.done?null:e.value}))}function limitReader(e,t){let r=0;return{async upTo(n){let o=await e.upTo(n);return o.length+r>t&&(o=o.subarray(0,t-r)),o},async exactly(n,o=!1){const i=await e.exactly(n,o);if(i.length+r>t)throw new Error("Unexpected end of data");return o&&(r+=n),i},seek(t){r+=t,e.seek(t)},get pos(){return e.pos}}}var CarReader=class{constructor(e,t){this._header=e,this._blocks=t,this._keys=t.map((e=>e.cid.toString()))}get version(){return this._header.version}async getRoots(){return this._header.roots}async has(e){return this._keys.indexOf(e.toString())>-1}async get(e){const t=this._keys.indexOf(e.toString());return t>-1?this._blocks[t]:void 0}async*blocks(){for(const e of this._blocks)yield e}async*cids(){for(const e of this._blocks)yield e.cid}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return decodeReaderComplete(bytesReader(e))}static async fromIterable(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return decodeReaderComplete(asyncIterableReader(e))}};async function decodeReaderComplete(e){const t=createDecoder(e),r=await t.header(),n=[];for await(const e of t.blocks())n.push(e);return new CarReader(r,n)}var CarIndexer=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterator=r}get version(){return this._version}async getRoots(){return this._roots}[Symbol.asyncIterator](){return this._iterator}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return decodeIndexerComplete(bytesReader(e))}static async fromIterable(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return decodeIndexerComplete(asyncIterableReader(e))}};async function decodeIndexerComplete(e){const t=createDecoder(e),{version:r,roots:n}=await t.header();return new CarIndexer(r,n,t.blocksIndex())}var CarIteratorBase=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterable=r,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},CarBlockIterator=class e extends CarIteratorBase{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){const{version:r,roots:n,iterator:o}=await fromBytes2(t);return new e(r,n,o)}static async fromIterable(t){const{version:r,roots:n,iterator:o}=await fromIterable(t);return new e(r,n,o)}},CarCIDIterator=class e extends CarIteratorBase{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const e=this._iterable[Symbol.asyncIterator]();return{async next(){const t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(t){const{version:r,roots:n,iterator:o}=await fromBytes2(t);return new e(r,n,o)}static async fromIterable(t){const{version:r,roots:n,iterator:o}=await fromIterable(t);return new e(r,n,o)}};async function fromBytes2(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return decodeIterator(bytesReader(e))}async function fromIterable(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return decodeIterator(asyncIterableReader(e))}async function decodeIterator(e){const t=createDecoder(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}var import_varint4=__toESM(require_varint(),1),CarWriterOut=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}},import_varint5=__toESM(require_varint(),1),typeofs2=["string","number","bigint","symbol"],objectTypeNames2=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is2(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(typeofs2.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(isBuffer3(e))return"Buffer";return getObjectType2(e)||"Object"}function isBuffer3(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function getObjectType2(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(objectTypeNames2.includes(t))return t}var Type2=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};Type2.uint=new Type2(0,"uint",!0),Type2.negint=new Type2(1,"negint",!0),Type2.bytes=new Type2(2,"bytes",!0),Type2.string=new Type2(3,"string",!0),Type2.array=new Type2(4,"array",!1),Type2.map=new Type2(5,"map",!1),Type2.tag=new Type2(6,"tag",!1),Type2.float=new Type2(7,"float",!0),Type2.false=new Type2(7,"false",!0),Type2.true=new Type2(7,"true",!0),Type2.null=new Type2(7,"null",!0),Type2.undefined=new Type2(7,"undefined",!0),Type2.break=new Type2(7,"break",!0);var Token2=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},useBuffer2=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,textDecoder2=new TextDecoder,textEncoder2=new TextEncoder;function isBuffer4(e){return useBuffer2&&globalThis.Buffer.isBuffer(e)}function asU8A2(e){return e instanceof Uint8Array?isBuffer4(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var toString4=useBuffer2?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):utf8Slice2(e,t,r):(e,t,r)=>r-t>64?textDecoder2.decode(e.subarray(t,r)):utf8Slice2(e,t,r),fromString4=useBuffer2?e=>e.length>64?globalThis.Buffer.from(e):utf8ToBytes2(e):e=>e.length>64?textEncoder2.encode(e):utf8ToBytes2(e),fromArray2=e=>Uint8Array.from(e),slice2=useBuffer2?(e,t,r)=>isBuffer4(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),concat2=useBuffer2?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),asU8A2(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},alloc2=useBuffer2?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function compare2(e,t){if(isBuffer4(e)&&isBuffer4(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function utf8ToBytes2(e,t=1/0){let r;const n=e.length;let o=null;const i=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function utf8Slice2(e,t,r){const n=[];for(;t<r;){const o=e[t];let i=null,s=o>239?4:o>223?3:o>191?2:1;if(t+s<=r){let r,n,a,c;switch(s){case 1:o<128&&(i=o);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&o)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&o)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&o)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=s}return decodeCodePointsArray2(n)}var MAX_ARGUMENTS_LENGTH2=4096;function decodeCodePointsArray2(e){const t=e.length;if(t<=MAX_ARGUMENTS_LENGTH2)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH2));return r}var defaultChunkSize2=256,Bl2=class{constructor(e=defaultChunkSize2){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=alloc2(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=slice2(r,0,this.cursor)}else t=concat2(this.chunks,this.cursor);return e&&this.reset(),t}},decodeErrPrefix2="CBOR decode error:",encodeErrPrefix2="CBOR encode error:",uintMinorPrefixBytes2=[];function assertEnoughData2(e,t,r){if(e.length-t<r)throw new Error(`${decodeErrPrefix2} not enough data for type`)}uintMinorPrefixBytes2[23]=1,uintMinorPrefixBytes2[24]=2,uintMinorPrefixBytes2[25]=3,uintMinorPrefixBytes2[26]=5,uintMinorPrefixBytes2[27]=9;var uintBoundaries2=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint82(e,t,r){assertEnoughData2(e,t,1);const n=e[t];if(!0===r.strict&&n<uintBoundaries2[0])throw new Error(`${decodeErrPrefix2} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint162(e,t,r){assertEnoughData2(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<uintBoundaries2[1])throw new Error(`${decodeErrPrefix2} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint322(e,t,r){assertEnoughData2(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<uintBoundaries2[2])throw new Error(`${decodeErrPrefix2} integer encoded in more bytes than necessary (strict decode)`);return n}function readUint642(e,t,r){assertEnoughData2(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&i<uintBoundaries2[3])throw new Error(`${decodeErrPrefix2} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error(`${decodeErrPrefix2} integers outside of the safe integer range are not supported`)}function decodeUint82(e,t,r,n){return new Token2(Type2.uint,readUint82(e,t+1,n),2)}function decodeUint162(e,t,r,n){return new Token2(Type2.uint,readUint162(e,t+1,n),3)}function decodeUint322(e,t,r,n){return new Token2(Type2.uint,readUint322(e,t+1,n),5)}function decodeUint642(e,t,r,n){return new Token2(Type2.uint,readUint642(e,t+1,n),9)}function encodeUint2(e,t){return encodeUintValue2(e,0,t.value)}function encodeUintValue2(e,t,r){if(r<uintBoundaries2[0]){const n=Number(r);e.push([t|n])}else if(r<uintBoundaries2[1]){const n=Number(r);e.push([24|t,n])}else if(r<uintBoundaries2[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<uintBoundaries2[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<uintBoundaries2[4]))throw new Error(`${decodeErrPrefix2} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&o,o>>=8,r[7]=255&o,o>>=8,r[6]=255&o,o>>=8,r[5]=255&o,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}function decodeNegint82(e,t,r,n){return new Token2(Type2.negint,-1-readUint82(e,t+1,n),2)}function decodeNegint162(e,t,r,n){return new Token2(Type2.negint,-1-readUint162(e,t+1,n),3)}function decodeNegint322(e,t,r,n){return new Token2(Type2.negint,-1-readUint322(e,t+1,n),5)}encodeUint2.encodedSize=function(e){return encodeUintValue2.encodedSize(e.value)},encodeUintValue2.encodedSize=function(e){return e<uintBoundaries2[0]?1:e<uintBoundaries2[1]?2:e<uintBoundaries2[2]?3:e<uintBoundaries2[3]?5:9},encodeUint2.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};var neg1b2=BigInt(-1),pos1b2=BigInt(1);function decodeNegint642(e,t,r,n){const o=readUint642(e,t+1,n);if("bigint"!=typeof o){const e=-1-o;if(e>=Number.MIN_SAFE_INTEGER)return new Token2(Type2.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${decodeErrPrefix2} integers outside of the safe integer range are not supported`);return new Token2(Type2.negint,neg1b2-BigInt(o),9)}function encodeNegint2(e,t){const r=t.value,n="bigint"==typeof r?r*neg1b2-pos1b2:-1*r-1;encodeUintValue2(e,t.type.majorEncoded,n)}function toToken5(e,t,r,n){assertEnoughData2(e,t,r+n);const o=slice2(e,t+r,t+r+n);return new Token2(Type2.bytes,o,r+n)}function decodeBytesCompact2(e,t,r,n){return toToken5(e,t,1,r)}function decodeBytes82(e,t,r,n){return toToken5(e,t,2,readUint82(e,t+1,n))}function decodeBytes162(e,t,r,n){return toToken5(e,t,3,readUint162(e,t+1,n))}function decodeBytes322(e,t,r,n){return toToken5(e,t,5,readUint322(e,t+1,n))}function decodeBytes642(e,t,r,n){const o=readUint642(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix2} 64-bit integer bytes lengths not supported`);return toToken5(e,t,9,o)}function tokenBytes2(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===Type2.string?fromString4(e.value):e.value),e.encodedBytes}function encodeBytes2(e,t){const r=tokenBytes2(t);encodeUintValue2(e,t.type.majorEncoded,r.length),e.push(r)}function compareBytes2(e,t){return e.length<t.length?-1:e.length>t.length?1:compare2(e,t)}function toToken6(e,t,r,n,o){const i=r+n;assertEnoughData2(e,t,i);const s=new Token2(Type2.string,toString4(e,t+r,t+i),i);return!0===o.retainStringBytes&&(s.byteValue=slice2(e,t+r,t+i)),s}function decodeStringCompact2(e,t,r,n){return toToken6(e,t,1,r,n)}function decodeString82(e,t,r,n){return toToken6(e,t,2,readUint82(e,t+1,n),n)}function decodeString162(e,t,r,n){return toToken6(e,t,3,readUint162(e,t+1,n),n)}function decodeString322(e,t,r,n){return toToken6(e,t,5,readUint322(e,t+1,n),n)}function decodeString642(e,t,r,n){const o=readUint642(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix2} 64-bit integer string lengths not supported`);return toToken6(e,t,9,o,n)}encodeNegint2.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*neg1b2-pos1b2:-1*t-1;return r<uintBoundaries2[0]?1:r<uintBoundaries2[1]?2:r<uintBoundaries2[2]?3:r<uintBoundaries2[3]?5:9},encodeNegint2.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},encodeBytes2.encodedSize=function(e){const t=tokenBytes2(e);return encodeUintValue2.encodedSize(t.length)+t.length},encodeBytes2.compareTokens=function(e,t){return compareBytes2(tokenBytes2(e),tokenBytes2(t))};var encodeString2=encodeBytes2;function toToken7(e,t,r,n){return new Token2(Type2.array,n,r)}function decodeArrayCompact2(e,t,r,n){return toToken7(e,t,1,r)}function decodeArray82(e,t,r,n){return toToken7(e,t,2,readUint82(e,t+1,n))}function decodeArray162(e,t,r,n){return toToken7(e,t,3,readUint162(e,t+1,n))}function decodeArray322(e,t,r,n){return toToken7(e,t,5,readUint322(e,t+1,n))}function decodeArray642(e,t,r,n){const o=readUint642(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix2} 64-bit integer array lengths not supported`);return toToken7(e,t,9,o)}function decodeArrayIndefinite2(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix2} indefinite length items not allowed`);return toToken7(e,t,1,1/0)}function encodeArray2(e,t){encodeUintValue2(e,Type2.array.majorEncoded,t.value)}function toToken8(e,t,r,n){return new Token2(Type2.map,n,r)}function decodeMapCompact2(e,t,r,n){return toToken8(e,t,1,r)}function decodeMap82(e,t,r,n){return toToken8(e,t,2,readUint82(e,t+1,n))}function decodeMap162(e,t,r,n){return toToken8(e,t,3,readUint162(e,t+1,n))}function decodeMap322(e,t,r,n){return toToken8(e,t,5,readUint322(e,t+1,n))}function decodeMap642(e,t,r,n){const o=readUint642(e,t+1,n);if("bigint"==typeof o)throw new Error(`${decodeErrPrefix2} 64-bit integer map lengths not supported`);return toToken8(e,t,9,o)}function decodeMapIndefinite2(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix2} indefinite length items not allowed`);return toToken8(e,t,1,1/0)}function encodeMap2(e,t){encodeUintValue2(e,Type2.map.majorEncoded,t.value)}function decodeTagCompact2(e,t,r,n){return new Token2(Type2.tag,r,1)}function decodeTag82(e,t,r,n){return new Token2(Type2.tag,readUint82(e,t+1,n),2)}function decodeTag162(e,t,r,n){return new Token2(Type2.tag,readUint162(e,t+1,n),3)}function decodeTag322(e,t,r,n){return new Token2(Type2.tag,readUint322(e,t+1,n),5)}function decodeTag642(e,t,r,n){return new Token2(Type2.tag,readUint642(e,t+1,n),9)}function encodeTag2(e,t){encodeUintValue2(e,Type2.tag.majorEncoded,t.value)}encodeArray2.compareTokens=encodeUint2.compareTokens,encodeArray2.encodedSize=function(e){return encodeUintValue2.encodedSize(e.value)},encodeMap2.compareTokens=encodeUint2.compareTokens,encodeMap2.encodedSize=function(e){return encodeUintValue2.encodedSize(e.value)},encodeTag2.compareTokens=encodeUint2.compareTokens,encodeTag2.encodedSize=function(e){return encodeUintValue2.encodedSize(e.value)};var MINOR_FALSE2=20,MINOR_TRUE2=21,MINOR_NULL2=22,MINOR_UNDEFINED2=23;function decodeUndefined2(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${decodeErrPrefix2} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new Token2(Type2.null,null,1):new Token2(Type2.undefined,void 0,1)}function decodeBreak2(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${decodeErrPrefix2} indefinite length items not allowed`);return new Token2(Type2.break,void 0,1)}function createToken2(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${decodeErrPrefix2} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${decodeErrPrefix2} Infinity values are not supported`)}return new Token2(Type2.float,e,t)}function decodeFloat162(e,t,r,n){return createToken2(readFloat162(e,t+1),3,n)}function decodeFloat322(e,t,r,n){return createToken2(readFloat322(e,t+1),5,n)}function decodeFloat642(e,t,r,n){return createToken2(readFloat642(e,t+1),9,n)}function encodeFloat2(e,t,r){const n=t.value;if(!1===n)e.push([Type2.float.majorEncoded|MINOR_FALSE2]);else if(!0===n)e.push([Type2.float.majorEncoded|MINOR_TRUE2]);else if(null===n)e.push([Type2.float.majorEncoded|MINOR_NULL2]);else if(void 0===n)e.push([Type2.float.majorEncoded|MINOR_UNDEFINED2]);else{let t,o=!1;r&&!0===r.float64||(encodeFloat162(n),t=readFloat162(ui8a2,1),n===t||Number.isNaN(n)?(ui8a2[0]=249,e.push(ui8a2.slice(0,3)),o=!0):(encodeFloat322(n),t=readFloat322(ui8a2,1),n===t&&(ui8a2[0]=250,e.push(ui8a2.slice(0,5)),o=!0))),o||(encodeFloat642(n),t=readFloat642(ui8a2,1),ui8a2[0]=251,e.push(ui8a2.slice(0,9)))}}encodeFloat2.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){encodeFloat162(r);let e=readFloat162(ui8a2,1);if(r===e||Number.isNaN(r))return 3;if(encodeFloat322(r),e=readFloat322(ui8a2,1),r===e)return 5}return 9};var buffer2=new ArrayBuffer(9),dataView2=new DataView(buffer2,1),ui8a2=new Uint8Array(buffer2,0);function encodeFloat162(e){if(e===1/0)dataView2.setUint16(0,31744,!1);else if(e===-1/0)dataView2.setUint16(0,64512,!1);else if(Number.isNaN(e))dataView2.setUint16(0,32256,!1);else{dataView2.setFloat32(0,e);const t=dataView2.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)dataView2.setUint16(0,31744,!1);else if(0===r)dataView2.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?dataView2.setUint16(0,0):e<-14?dataView2.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):dataView2.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function readFloat162(e,t){if(e.length-t<2)throw new Error(`${decodeErrPrefix2} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,o=1023&r;let i;return i=0===n?o*2**-24:31!==n?(o+1024)*2**(n-25):0===o?1/0:NaN,32768&r?-i:i}function encodeFloat322(e){dataView2.setFloat32(0,e,!1)}function readFloat322(e,t){if(e.length-t<4)throw new Error(`${decodeErrPrefix2} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function encodeFloat642(e){dataView2.setFloat64(0,e,!1)}function readFloat642(e,t){if(e.length-t<8)throw new Error(`${decodeErrPrefix2} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function invalidMinor2(e,t,r){throw new Error(`${decodeErrPrefix2} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function errorer2(e){return()=>{throw new Error(`${decodeErrPrefix2} ${e}`)}}encodeFloat2.compareTokens=encodeUint2.compareTokens;var jump2=[];for(let e=0;e<=23;e++)jump2[e]=invalidMinor2;jump2[24]=decodeUint82,jump2[25]=decodeUint162,jump2[26]=decodeUint322,jump2[27]=decodeUint642,jump2[28]=invalidMinor2,jump2[29]=invalidMinor2,jump2[30]=invalidMinor2,jump2[31]=invalidMinor2;for(let e=32;e<=55;e++)jump2[e]=invalidMinor2;jump2[56]=decodeNegint82,jump2[57]=decodeNegint162,jump2[58]=decodeNegint322,jump2[59]=decodeNegint642,jump2[60]=invalidMinor2,jump2[61]=invalidMinor2,jump2[62]=invalidMinor2,jump2[63]=invalidMinor2;for(let e=64;e<=87;e++)jump2[e]=decodeBytesCompact2;jump2[88]=decodeBytes82,jump2[89]=decodeBytes162,jump2[90]=decodeBytes322,jump2[91]=decodeBytes642,jump2[92]=invalidMinor2,jump2[93]=invalidMinor2,jump2[94]=invalidMinor2,jump2[95]=errorer2("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)jump2[e]=decodeStringCompact2;jump2[120]=decodeString82,jump2[121]=decodeString162,jump2[122]=decodeString322,jump2[123]=decodeString642,jump2[124]=invalidMinor2,jump2[125]=invalidMinor2,jump2[126]=invalidMinor2,jump2[127]=errorer2("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)jump2[e]=decodeArrayCompact2;jump2[152]=decodeArray82,jump2[153]=decodeArray162,jump2[154]=decodeArray322,jump2[155]=decodeArray642,jump2[156]=invalidMinor2,jump2[157]=invalidMinor2,jump2[158]=invalidMinor2,jump2[159]=decodeArrayIndefinite2;for(let e=160;e<=183;e++)jump2[e]=decodeMapCompact2;jump2[184]=decodeMap82,jump2[185]=decodeMap162,jump2[186]=decodeMap322,jump2[187]=decodeMap642,jump2[188]=invalidMinor2,jump2[189]=invalidMinor2,jump2[190]=invalidMinor2,jump2[191]=decodeMapIndefinite2;for(let e=192;e<=215;e++)jump2[e]=decodeTagCompact2;jump2[216]=decodeTag82,jump2[217]=decodeTag162,jump2[218]=decodeTag322,jump2[219]=decodeTag642,jump2[220]=invalidMinor2,jump2[221]=invalidMinor2,jump2[222]=invalidMinor2,jump2[223]=invalidMinor2;for(let e=224;e<=243;e++)jump2[e]=errorer2("simple values are not supported");jump2[244]=invalidMinor2,jump2[245]=invalidMinor2,jump2[246]=invalidMinor2,jump2[247]=decodeUndefined2,jump2[248]=errorer2("simple values are not supported"),jump2[249]=decodeFloat162,jump2[250]=decodeFloat322,jump2[251]=decodeFloat642,jump2[252]=invalidMinor2,jump2[253]=invalidMinor2,jump2[254]=invalidMinor2,jump2[255]=decodeBreak2;var quick2=[];for(let e=0;e<24;e++)quick2[e]=new Token2(Type2.uint,e,1);for(let e=-1;e>=-24;e--)quick2[31-e]=new Token2(Type2.negint,e,1);function quickEncodeToken2(e){switch(e.type){case Type2.false:return fromArray2([244]);case Type2.true:return fromArray2([245]);case Type2.null:return fromArray2([246]);case Type2.bytes:return e.value.length?void 0:fromArray2([64]);case Type2.string:return""===e.value?fromArray2([96]):void 0;case Type2.array:return 0===e.value?fromArray2([128]):void 0;case Type2.map:return 0===e.value?fromArray2([160]):void 0;case Type2.uint:return e.value<24?fromArray2([Number(e.value)]):void 0;case Type2.negint:if(e.value>=-24)return fromArray2([31-Number(e.value)])}}function makeCborEncoders2(){const e=[];return e[Type2.uint.major]=encodeUint2,e[Type2.negint.major]=encodeNegint2,e[Type2.bytes.major]=encodeBytes2,e[Type2.string.major]=encodeString2,e[Type2.array.major]=encodeArray2,e[Type2.map.major]=encodeMap2,e[Type2.tag.major]=encodeTag2,e[Type2.float.major]=encodeFloat2,e}quick2[64]=new Token2(Type2.bytes,new Uint8Array(0),1),quick2[96]=new Token2(Type2.string,"",1),quick2[128]=new Token2(Type2.array,0,1),quick2[160]=new Token2(Type2.map,0,1),quick2[244]=new Token2(Type2.false,!1,1),quick2[245]=new Token2(Type2.true,!0,1),quick2[246]=new Token2(Type2.null,null,1);var cborEncoders2=makeCborEncoders2(),buf2=new Bl2,Ref2=class e{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${encodeErrPrefix2} object contains circular references`);return new e(r,t)}},simpleTokens2={null:new Token2(Type2.null,null),undefined:new Token2(Type2.undefined,void 0),true:new Token2(Type2.true,!0),false:new Token2(Type2.false,!1),emptyArray:new Token2(Type2.array,0),emptyMap:new Token2(Type2.map,0)},typeEncoders2={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new Token2(e>=0?Type2.uint:Type2.negint,e):new Token2(Type2.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new Token2(Type2.uint,e):new Token2(Type2.negint,e),Uint8Array:(e,t,r,n)=>new Token2(Type2.bytes,e),string:(e,t,r,n)=>new Token2(Type2.string,e),boolean:(e,t,r,n)=>e?simpleTokens2.true:simpleTokens2.false,null:(e,t,r,n)=>simpleTokens2.null,undefined:(e,t,r,n)=>simpleTokens2.undefined,ArrayBuffer:(e,t,r,n)=>new Token2(Type2.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new Token2(Type2.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[simpleTokens2.emptyArray,new Token2(Type2.break)]:simpleTokens2.emptyArray;n=Ref2.createCheck(n,e);const o=[];let i=0;for(const t of e)o[i++]=objectToTokens2(t,r,n);return r.addBreakTokens?[new Token2(Type2.array,e.length),o,new Token2(Type2.break)]:[new Token2(Type2.array,e.length),o]},Object(e,t,r,n){const o="Object"!==t,i=o?e.keys():Object.keys(e),s=o?e.size:i.length;if(!s)return!0===r.addBreakTokens?[simpleTokens2.emptyMap,new Token2(Type2.break)]:simpleTokens2.emptyMap;n=Ref2.createCheck(n,e);const a=[];let c=0;for(const t of i)a[c++]=[objectToTokens2(t,r,n),objectToTokens2(o?e.get(t):e[t],r,n)];return sortMapEntries2(a,r),r.addBreakTokens?[new Token2(Type2.map,s),a,new Token2(Type2.break)]:[new Token2(Type2.map,s),a]}};typeEncoders2.Map=typeEncoders2.Object,typeEncoders2.Buffer=typeEncoders2.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders2[`${e}Array`]=typeEncoders2.DataView;function objectToTokens2(e,t={},r){const n=is2(e),o=t&&t.typeEncoders&&t.typeEncoders[n]||typeEncoders2[n];if("function"==typeof o){const i=o(e,n,t,r);if(null!=i)return i}const i=typeEncoders2[n];if(!i)throw new Error(`${encodeErrPrefix2} unsupported type: ${n}`);return i(e,n,t,r)}function sortMapEntries2(e,t){t.mapSorter&&e.sort(t.mapSorter)}var DONE2=Symbol.for("DONE"),BREAK2=Symbol.for("BREAK"),cborEncoders3=makeCborEncoders2(),defaultEncodeOptions2={float64:!1,quickEncodeToken:quickEncodeToken2};function tokensToLength(e,t=cborEncoders3,r=defaultEncodeOptions2){if(Array.isArray(e)){let n=0;for(const o of e)n+=tokensToLength(o,t,r);return n}{const n=t[e.type.major];if(void 0===n.encodedSize||"function"!=typeof n.encodedSize)throw new Error(`Encoder for ${e.type.name} does not have an encodedSize()`);return n.encodedSize(e,r)}}var CarBufferWriter=class{constructor(e,t){this.bytes=e,this.byteOffset=t,this.roots=[],this.headerSize=t}addRoot(e,t){return addRoot(this,e,t),this}write(e){return addBlock(this,e),this}close(e){return close(this,e)}},addRoot=(e,t,r={})=>{const{resize:n=!1}=r,{bytes:o,headerSize:i,byteOffset:s,roots:a}=e;e.roots.push(t);const c=headerLength(e);if(c>i){if(!(c-i+s<o.byteLength))throw a.pop(),new RangeError(`Buffer has no capacity for a new root ${t}`);if(!n)throw a.pop(),new RangeError(`Header of size ${i} has no capacity for new root ${t}.\n  However there is a space in the buffer and you could call addRoot(root, { resize: root }) to resize header to make a space for this root.`);resizeHeader(e,c)}},blockLength=({cid:e,bytes:t})=>{const r=e.bytes.byteLength+t.byteLength;return import_varint5.default.encodingLength(r)+r},addBlock=(e,{cid:t,bytes:r})=>{const n=t.bytes.byteLength+r.byteLength,o=import_varint5.default.encode(n);if(e.byteOffset+o.length+n>e.bytes.byteLength)throw new RangeError("Buffer has no capacity for this block");writeBytes(e,o),writeBytes(e,t.bytes),writeBytes(e,r)},close=(e,t={})=>{const{resize:r=!1}=t,{roots:n,bytes:o,byteOffset:i,headerSize:s}=e,a=encode6({version:1,roots:n}),c=import_varint5.default.encode(a.length),u=c.length+a.byteLength;if(0==s-u)return writeHeader(e,c,a),o.subarray(0,i);if(r)return resizeHeader(e,u),writeHeader(e,c,a),o.subarray(0,e.byteOffset);throw new RangeError("Header size was overestimated.\nYou can use close({ resize: true }) to resize header")},resizeHeader=(e,t)=>{const{bytes:r,headerSize:n}=e;r.set(r.subarray(n,e.byteOffset),t),e.byteOffset+=t-n,e.headerSize=t},writeBytes=(e,t)=>{e.bytes.set(t,e.byteOffset),e.byteOffset+=t.length},writeHeader=({bytes:e},t,r)=>{e.set(t),e.set(r,t.length)},headerPreludeTokens=[new Token2(Type2.map,2),new Token2(Type2.string,"version"),new Token2(Type2.uint,1),new Token2(Type2.string,"roots")],CID_TAG=new Token2(Type2.tag,42),calculateHeaderLength=e=>{const t=[...headerPreludeTokens];t.push(new Token2(Type2.array,e.length));for(const r of e)t.push(CID_TAG),t.push(new Token2(Type2.bytes,{length:r+1}));const r=tokensToLength(t);return import_varint5.default.encodingLength(r)+r},headerLength=({roots:e})=>calculateHeaderLength(e.map((e=>e.bytes.byteLength))),createWriter=(e,t={})=>{const{roots:r=[],byteOffset:n=0,byteLength:o=e.byteLength,headerSize:i=headerLength({roots:r})}=t,s=new Uint8Array(e,n,o),a=new CarBufferWriter(s,i);for(const e of r)a.addRoot(e);return a},from3=({name:e,code:t,encode:r})=>new Hasher(e,t,r),Hasher=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create2(this.code,t):t.then((e=>create2(this.code,e)))}throw Error("Unknown type, must be binary type")}};function readonly({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*linksWithin(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r],o=CID2.asCID(n);o?yield[t.join("/"),o]:"object"==typeof n&&(yield*links(n,t))}else{const r=CID2.asCID(t);r?yield[e.join("/"),r]:yield*links(t,e)}}function*links(e,t){if(null==e||e instanceof Uint8Array)return;const r=CID2.asCID(e);r&&(yield[t.join("/"),r]);for(const[r,n]of Object.entries(e)){const e=[...t,r];yield*linksWithin(e,n)}}function*treeWithin(e,t){if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r];yield t.join("/"),"object"!=typeof n||CID2.asCID(n)||(yield*tree(n,t))}else yield*tree(t,e)}function*tree(e,t){if(null!=e&&"object"==typeof e)for(const[r,n]of Object.entries(e)){const e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||CID2.asCID(n)||(yield*treeWithin(e,n))}}function get(e,t){let r=e;for(const[e,n]of t.entries()){if(r=r[n],null==r)throw new Error(`Object has no property at ${t.slice(0,e+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const o=CID2.asCID(r);if(o)return{value:o,remaining:t.slice(e+1).join("/")}}return{value:r}}var Block=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get(this.value,e.split("/").filter(Boolean))}};async function encode8({value:e,codec:t,hasher:r}){if(void 0===e)throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");const n=t.encode(e),o=await r.digest(n),i=CID2.create(1,t.code,o);return new Block({value:e,bytes:n,cid:i})}async function decode12({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");const n=t.decode(e),o=await r.digest(e),i=CID2.create(1,t.code,o);return new Block({value:n,bytes:e,cid:i})}function createUnsafe({bytes:e,cid:t,value:r,codec:n}){const o=void 0!==r?r:n&&n.decode(e);if(void 0===o)throw new Error('Missing required argument, must either provide "value" or "codec"');return new Block({cid:t,bytes:e,value:o})}async function create4({bytes:e,cid:t,hasher:r,codec:n}){if(!e)throw new Error('Missing required argument "bytes"');if(!r)throw new Error('Missing required argument "hasher"');const o=n.decode(e),i=await r.digest(e);if(!bytes_exports2.equals(t.multihash.bytes,i.bytes))throw new Error("CID hash does not match bytes");return createUnsafe({bytes:e,cid:t,value:o,codec:n})}var sha=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),sha256=from3({name:"sha2-256",code:18,encode:sha("SHA-256")}),sha512=from3({name:"sha2-512",code:19,encode:sha("SHA-512")}),raw_exports={};__export(raw_exports,{code:()=>code2,decode:()=>decode13,encode:()=>encode9,name:()=>name2});var name2="raw",code2=85,encode9=e=>coerce2(e),decode13=e=>coerce2(e);async function encodeCarFile(e,t){let r=0;const n=headerLength({roots:e});r+=n;for(const{cid:e,bytes:n}of t.entries())r+=blockLength({cid:e,bytes:n});const o=new Uint8Array(r),i=createWriter(o,{headerSize:n});for(const t of e)i.addRoot(t);for(const{cid:e,bytes:r}of t.entries())i.write({cid:e,bytes:r});return i.close(),await encode8({value:i.bytes,hasher:sha256,codec:raw_exports})}async function encodeCarHeader(e){return await encode8({value:{fp:e},hasher:sha256,codec:src_exports})}async function parseCarFile(e){const t=await e.getRoots(),r=await e.get(t[0]);if(!r)throw new Error("missing header block");const{value:n}=await decode12({bytes:r.bytes,hasher:sha256,codec:src_exports});if(n&&void 0===n.fp)throw new Error("missing fp");const{fp:o}=n;return o}var encrypted_block_exports={};function getCrypto(){try{return window.crypto&&window.crypto.subtle?window.crypto:new Crypto}catch(e){return null}}__export(encrypted_block_exports,{code:()=>code3,crypto:()=>cryptoFn,decode:()=>decode14,decrypt:()=>decrypt,encode:()=>encode10,encrypt:()=>encrypt,name:()=>name3});var crypto2=getCrypto();function randomBytes(e){const t=new Uint8Array(e);return e>0&&crypto2.getRandomValues(t),t}var enc32=e=>{e=+e;const t=new Uint8Array(4);return t[3]=e>>>24,t[2]=e>>>16,t[1]=e>>>8,t[0]=255&e,t},readUInt32LE=e=>{const t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]},concat3=e=>{const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),r=t.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(r);let o=0;for(const e of t)n.set(e,o),o+=e.length;return n},encode10=({iv:e,bytes:t})=>concat3([e,t]),decode14=e=>({iv:e.subarray(0,12),bytes:e=e.slice(12)}),code3=3147065;async function subtleKey(e){return await crypto2.subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}var decrypt=async({key:e,value:t})=>{let{bytes:r,iv:n}=t;const o=await subtleKey(e),i=await crypto2.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:128},o,r);r=new Uint8Array(i);const s=readUInt32LE(r.subarray(0,4)),a=CID2.decode(r.subarray(4,4+s));return r=r.subarray(4+s),{cid:a,bytes:r}},encrypt=async({key:e,cid:t,bytes:r})=>{const n=enc32(t.bytes.byteLength),o=randomBytes(12),i=concat3([n,t.bytes,r]);try{const t=await subtleKey(e),n=await crypto2.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:128},t,i);r=new Uint8Array(n)}catch(e){throw console.log("ee",e),e}return{value:{bytes:r,iv:o}}},cryptoFn=e=>({encrypt:t=>encrypt({key:e,...t}),decrypt:t=>decrypt({key:e,...t})}),name3="jchris@encrypted-block:aes-gcm",readUInt32LE2=e=>{const t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]},MAX_UINT32=4294967295,bf=e=>{const t=Math.floor(MAX_UINT32/e);return async e=>{const r=await e.identity();if("number"!=typeof r)throw new Error("Identity must be a number");return r<=t}},simpleCompare=(e,t)=>e===t?0:e>t?1:-1,binaryCompare=(e,t)=>{for(let r=0;r<e.byteLength;r++){if(t.byteLength===r)return 1;const n=e[r],o=t[r];if(n!==o)return n>o?1:-1}return t.byteLength>e.byteLength?-1:0},CIDCounter=class{constructor(){this._cids=new Set}add(e){if(!e.address)throw new Error("Cannot add node without address");if(e.address.then){const t=e.address.then((e=>this._cids.add(e.toString())));this._cids.add(t),t.then((()=>this._cids.delete(t)))}else this._cids.add(e.address.toString())}async all(){return await Promise.all([...this._cids]),this._cids}},Entry=class{constructor({key:e,address:t},r={}){this.key=e,this.address=t,this.codec=r.codec,this.hasher=r.hasher}get isEntry(){return!0}},EntryList=class{constructor({entries:e,closed:t}){if("boolean"!=typeof t)throw new Error('Missing required argument "closed"');this.entries=e,this.closed=t,this.startKey=e[0].key}find(e,t){const{entries:r}=this;for(let n=r.length-1;n>-1;n--){const o=r[n];if(t(e,o.key)>-1)return[n,o]}return null}findMany(e,t,r=!1,n=!1){const{entries:o}=this,i=new Map;e=r?[...e]:e.sort(t);for(let r=o.length-1;r>-1&&e.length;r--){const s=o[r],a=[];for(;e.length;){let r=e[e.length-1];r=r.key?r.key:r;const o=t(r,s.key);if(n)if(0===o)a.push(e.pop());else{if(!(o>0))break;e.pop()}else{if(!(o>-1))break;a.push(e.pop())}}a.length&&i.set(r,[s,a])}return i}findRange(e,t,r){const{entries:n}=this;let o,i=0;for(let e=n.length-1;e>-1;e--)if(r(t,n[e].key)>0){o=e;break}for(let t=0;t<n.length;t++){const o=r(e,n[t].key);if(0===o){i=t;break}if(o<0)break;i=t}return{first:i,last:o,entries:n.slice(i,o+1)}}},stringKey=e=>"string"==typeof e?e:JSON.stringify(e);function sortBulk(e,t){return e.sort((({key:e},{key:r})=>t.compare(e,r)))}async function filterLeftmostInserts(e,t,r){const n=[];for(const o of t){const{key:t,del:i}=o;if(!(r(t,e)<0))break;i||n.push(o)}return n}async function generateNewLeaves(e,t,{chunker:r,compare:n}){return await Node2.from({entries:e.map((e=>new t.LeafEntryClass(e,t))).sort(((e,t)=>n(e.key,t.key))),chunker:r,NodeClass:t.LeafClass,distance:0,opts:t})}async function generateBranchEntries(e,t,r,n){return await Promise.all(t.map((async t=>{const o=await t.encode();return r.blocks.push({block:o,node:t}),e.cache.set(t),new n.BranchEntryClass({key:t.key,address:await t.address},n)})))}async function processRoot(e,t,r,n){const o=t.root;t.blocks.push({block:await o.encode(),node:o}),e.cache.set(o);const i=n.opts,s=o.distance,a=o.entryList.startKey,c=await filterLeftmostInserts(a,r,e.compare);if(c.length){const r=await generateNewLeaves(c,i,e),a=await generateBranchEntries(e,r,t,i),u=[new i.BranchEntryClass({key:o.entryList.startKey,address:await o.address},i),...a].sort((({key:e},{key:t})=>i.compare(e,t)));let d=await Node2.from({...n,entries:u,chunker:e.chunker,NodeClass:i.BranchClass,distance:s+1}),l=[...d];for(;d.length>1;){const t=await Promise.all(d.map((async e=>new i.BranchEntryClass({key:e.key,address:await e.address},i))));d=await Node2.from({...n,entries:t.sort((({key:e},{key:t})=>i.compare(e,t))),chunker:e.chunker,NodeClass:i.BranchClass,distance:s+1}),l=[...l,...d]}await Promise.all(l.map((async r=>{const n=await r.encode();e.cache.set(r),t.blocks.push({block:n,node:r})}))),t.root=d[0],t.nodes=[...t.nodes,...l]}}var Node2=class e{constructor({entryList:e,chunker:t,distance:r,getNode:n,compare:o,cache:i}){this.entryList=e,this.chunker=t,this.distance=r,this.getNode=n,this.compare=o,this.cache=i}get closed(){return this.entryList.closed}get key(){return this.entryList.startKey}async getEntry(e,t=new CIDCounter){return{result:await this._getEntry(e,t),cids:t}}async _getEntry(e,t){t.add(this);let r=this;for(;!r.isLeaf;){const n=r.entryList.find(e,this.compare);if(null===n)throw new Error("Not found");const[,o]=n;r=await this.getNode(await o.address),t.add(r)}const n=r.entryList.find(e,this.compare);if(null===n||n[1].key.toString()!==e.toString())throw new Error("Not found");const[,o]=n;return o}async getAllEntries(e=new CIDCounter){return{result:await this._getAllEntries(e),cids:e}}_getAllEntries(e){if(e.add(this),this.isLeaf)return this.entryList.entries;{const{entries:t}=this.entryList,r=async t=>this.getNode(await t.address).then((t=>t._getAllEntries(e))).catch((async e=>{throw e}));return Promise.all(t.map(r)).then((e=>e.flat()))}}async*vis(e=new Set){const t=e=>e.toString().slice(0,4)+e.toString().slice(-4),r=async function*(e,n,o){const i=await e.address;if(!o.has(i)){o.add(i);const s=await(async e=>e.isLeaf?`Leaf [${e.entryList.entries.map((e=>`[${e.key},${JSON.stringify(e.value).replace(/"/g,"'")}]`)).join(", ")}]`:`Branch [${e.entryList.entries.map((e=>`[${e.key}]`)).join(", ")}]`)(e);yield`  node [shape=ellipse fontname="Courier"]; ${t(i)} [label="${s}"];`,yield`  ${t(n)} -> ${t(i)};`;for(const n of e.entryList.entries)if(n.address){const s=await n.address;try{const t=await e.getNode(s);yield*await r(t,i,o)}catch(e){yield`  ${t(i)} -> ${t(s)};`,yield`  node [shape=ellipse fontname="Courier"]; ${t(s)} [label="Error: ${e.message}"];`}}}};yield"digraph tree {",yield'  node [shape=ellipse fontname="Courier"]; rootnode;';for await(const t of r(this,"rootnode",e))yield t;yield"}"}async getEntries(e,t=!1,r=new CIDCounter){return{result:await this._getEntries(e,t,r),cids:r}}async _getEntries(e,t,r){r.add(this),t||(e=e.sort(this.compare));const n=this.entryList.findMany(e,this.compare,!0,this.isLeaf);if(this.isLeaf)return[...n.values()].map((([e])=>e));let o=[];for(const[e,t]of[...n.values()].reverse()){const n=this.getNode(await e.address);o.push(n.then((e=>e._getEntries(t.reverse(),!0,r))))}return o=await Promise.all(o),o.flat()}async getRangeEntries(e,t,r=new CIDCounter){return{result:await this._getRangeEntries(e,t,r),cids:r}}_getRangeEntries(e,t,r){r.add(this);const{entries:n}=this.entryList.findRange(e,t,this.compare);if(this.isLeaf)return n.filter((r=>{const n=this.compare(e,r.key),o=this.compare(t,r.key);return n<=0&&o>=0}));if(!n.length)return[];const o=async n=>this.getNode(await n.address).then((n=>n._getRangeEntries(e,t,r))),i=[o(n.shift())];if(!n.length)return i[0];const s=o(n.pop());for(;n.length;){const e=async e=>this.getNode(await e.address).then((async e=>e._getAllEntries(r)));i.push(e(n.shift()))}return i.push(s),Promise.all(i).then((e=>e.flat()))}async transaction(e,t={}){t={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...t};const r={chunker:this.chunker,opts:t},n=this.entryList.findMany(e,t.compare,!0,this.isLeaf);return this.isLeaf?await this.transactionLeaf(e,t,r,n):await this.transactionBranch(e,t,r,n)}async transactionLeaf(t,r,n,o){const{LeafClass:i,LeafEntryClass:s}=r,{entries:a,previous:c}=this.processLeafEntries(t,o,s,r),u={...n,entries:a,NodeClass:i,distance:0},d=await e.from(u);return{nodes:d,previous:c,blocks:await Promise.all(d.map((async e=>{const t=await e.encode();return this.cache.set(e),{block:t,node:e}}))),distance:0}}processLeafEntries(e,t,r,n){const o=[];let i=[];const s={},a=new Map;for(const{key:t,del:r,value:n}of e){const e=stringKey(t);r?void 0===s[e]&&a.set(e,null):(s[e]={key:t,value:n},a.delete(e))}i=[...this.entryList.entries];for(const[e,[c]]of t){o.push(c);const t=stringKey(c.key);a.has(t)?a.set(t,e):(i[e]=new r(s[t],n),delete s[t])}let c=0;for(const[,e]of a)null!==e&&i.splice(e-c++,1);const u=Object.values(s).map((e=>new r(e,n)));return i=i.concat(u).sort((({key:e},{key:t})=>n.compare(e,t))),{entries:i,previous:o}}async transactionBranch(t,r,n,o){const{BranchClass:i,BranchEntryClass:s}=r;let a=0;for(const[e,[t,n]]of o){const i=this.getNode(await t.address).then((e=>e.transaction(n.reverse(),{...r,sorted:!0}))).then((e=>({entry:t,keys:n,distance:a,...e})));o.set(e,i)}let c=[...this.entryList.entries];const u={previous:[],blocks:[],nodes:[]};for(const[e,t]of o){const{nodes:r,previous:n,blocks:o,distance:i}=await t;a=i,c[e]=r,n.length&&(u.previous=u.previous.concat(n)),o.length&&(u.blocks=u.blocks.concat(o)),r.length&&(u.nodes=u.nodes.concat(r))}c=c.flat();const d=await this.handlePrepend(c,r,n,u,a);a++,c=await Promise.all(d.map((async e=>{if(e.isEntry)return e;const t=await e.encode();return u.blocks.push({block:t,node:e}),this.cache.set(e),new s(e,r)})));const l={...n,entries:c,NodeClass:i,distance:a},h=await e.from(l);return await Promise.all(h.map((async e=>{const t=await e.encode();u.blocks.push({block:t,node:e}),this.cache.set(e)}))),u.nodes=h,{...u,distance:a}}async handlePrepend(t,r,n,o,i){const{BranchClass:s,LeafClass:a}=r;let c=[],u=null;for(const d of t)if(u){const t=await this.mergeFirstLeftEntries(d,u,n,o,i);u=null;const l=t[0].address?s:a,h={...n,entries:t.sort((({key:e},{key:t})=>r.compare(e,t))),NodeClass:l,distance:i},f=await e.from(h);f[f.length-1].closed||(u=f.pop()),f.length&&(c=c.concat(f))}else d.isEntry||d.closed?c.push(d):u=d;return u&&c.push(u),c}async getNodeFirstFromBlocks(e,t){for(const{block:r,node:n}of e)if(await r.cid===t)return n;return await this.getNode(t)}async mergeFirstLeftEntries(t,r,n,o,i){const s=n.opts,{LeafClass:a,BranchClass:c,BranchEntryClass:u}=s;if(t.isEntry){const e=await t.address;t=await this.getNodeFirstFromBlocks(o.blocks,e)}const d=t.entryList.entries;if(!d.length)throw new Error("unreachable no entries");const l=(e,t)=>e.concat(t),h=async(e,t,r)=>await Promise.all(e.map((async e=>(t.blocks.push({block:await e.encode(),node:e}),this.cache.set(e),new u({key:e.key,address:await e.address},r)))));if(d[0].constructor.name===r.entryList.entries[0].constructor.name)return await l(r.entryList.entries,d);{const t=d.shift();if(!t)throw new Error("unreachable no left entry");if(!t.address)throw new Error("unreachable existing leaf, no leftEntry.address");const u=await this.mergeFirstLeftEntries(t,r,n,o,i-1),f=d.shift();if(!f)return u;if(!f.address)throw new Error("unreachable existing leaf, no esf.address");const p=await this.getNodeFirstFromBlocks(o.blocks,await f.address);if(p.entryList.entries[0].address){if(u[0].address)return u.concat(p.entryList.entries);{const t=await e.from({...n,entries:u.sort((({key:e},{key:t})=>s.compare(e,t))),NodeClass:a,distance:i}),r=await h(t,o,s),l=await e.from({...n,entries:[...p.entryList.entries,...r,...d].sort((({key:e},{key:t})=>s.compare(e,t))),NodeClass:c,distance:i});return await h(l,o,s)}}{const t=await l(u,p.entryList.entries),r=await e.from({...n,entries:t.sort((({key:e},{key:t})=>s.compare(e,t))),NodeClass:a,distance:i}),c=await h(r,o,s);return await l(c,d)}}}async bulk(t,r={},n=!0){const{BranchClass:o}=r;(r={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...r}).sorted||(t=sortBulk(t,r),r.sorted=!0);const i={chunker:this.chunker,opts:r},s=await this.transaction(t,r);for(;s.nodes.length>1;){const t=s.nodes[0].distance+1,n=await Promise.all(s.nodes.map((async e=>{const t=await e.encode();return s.blocks.push({block:t,node:e}),this.cache.set(e),new r.BranchEntryClass(e,r)}))),a=await e.from({...i,entries:n,NodeClass:o,distance:t});await Promise.all(a.map((async e=>{const t=await e.encode();this.cache.set(e),s.blocks.push({block:t,node:e})}))),s.nodes=a}return s.root=s.nodes[0],n&&s.root&&await processRoot(this,s,t,i),s.blocks=s.blocks.map((({block:e})=>e)),s}static async from({entries:e,chunker:t,NodeClass:r,distance:n,opts:o}){if(!e.every((t=>t.constructor.name===e[0].constructor.name)))throw new Error("all entries must be of the same type");const i=[];let s=[];for(const r of e)s.push(r),await t(r,n)&&(i.push(new EntryList({entries:s,closed:!0})),s=[]);return s.length&&i.push(new EntryList({entries:s,closed:!1})),i.map((e=>new r({entryList:e,chunker:t,distance:n,...o})))}},IPLDNode=class extends Node2{constructor({codec:e,hasher:t,block:r,...n}){super(n),this.codec=e,this.hasher=t,r?(this.block=r,this.address=r.cid):(this.block=this.encode(),this.address=this.block.then((e=>e.cid)))}async get(e){const{result:t,cids:r}=await this.getEntry(e);return{result:t.key,cids:r}}async encode(){if(this.block)return this.block;const e=await this.encodeNode(),t={codec:this.codec,hasher:this.hasher,value:e};return this.block=await encode8(t),this.block}},IPLDBranch=class extends IPLDNode{async encodeNode(){const{entries:e}=this.entryList,t=await Promise.all(e.map((async e=>{if(!e.address)throw new Error("entry.address required");return[e.key,await e.address]})));return{branch:[this.distance,t],closed:this.closed}}get isBranch(){return!0}},IPLDLeaf=class extends IPLDNode{async encodeNode(){return{leaf:await Promise.all(this.entryList.entries.map((async e=>await e.encodeNode()))),closed:this.closed}}get isLeaf(){return!0}},create5=async function*(e){let{LeafClass:t,LeafEntryClass:r,BranchClass:n,BranchEntryClass:o,list:i,chunker:s,compare:a,...c}=e;i=i.map((e=>new r(e,c))),c.compare=a;let u=await Node2.from({entries:i,chunker:s,NodeClass:t,distance:0,opts:c});yield*u;let d=1;for(;u.length>1;){const e=async e=>new o({key:e.key,address:await e.address},c),t=await Promise.all(u.map(e));u=await Node2.from({entries:t,chunker:s,NodeClass:n,distance:d,opts:c}),yield*u,d++}},compare3=({bytes:e},{bytes:t})=>binaryCompare(e,t),CIDEntry=class extends Entry{constructor(e){super({address:e,key:e}),this.cid=e}encodeNode(){return this.cid}identity(){const e=this.cid.multihash.bytes;return readUInt32LE2(e)}},CIDNodeEntry=class extends Entry{async identity(){const{multihash:{bytes:e}}=await this.address;return readUInt32LE2(e)}},CIDSetBranch=class extends IPLDBranch{},CIDSetLeaf=class extends IPLDLeaf{},createGetNode=(e,t,r,n,o)=>{const i=s=>t.has(s)?t.get(s):e(s).then((e=>(e=>{const{value:s}=e,a={chunker:r,cache:t,block:e,getNode:i,codec:n,hasher:o,compare:compare3};let c,u;if(s.leaf)c=s.leaf.map((e=>new CIDEntry(e))),u=CIDSetLeaf;else{if(!s.branch)throw new Error("Unknown block data, does not match schema");{const[e,t]=s.branch;a.distance=e,c=t.map((([e,t])=>new CIDNodeEntry({key:e,address:t}))),u=CIDSetBranch}}const d=new u({entryList:new EntryList({entries:c,closed:s.closed}),...a});return t.set(d),d})(e)));return i},create6=({get:e,cache:t,chunker:r,list:n,codec:o,hasher:i,sorted:s})=>{s||(n=n.sort(compare3));const a=createGetNode(e,t,r,o,i);return create5({list:n,codec:o,hasher:i,chunker:r,getNode:a,sorted:s,compare:compare3,cache:t,LeafClass:CIDSetLeaf,LeafEntryClass:CIDEntry,BranchClass:CIDSetBranch,BranchEntryClass:CIDNodeEntry})},load=({cid:e,get:t,cache:r,chunker:n,codec:o,hasher:i,...s})=>createGetNode(t,r,n,o,i,s)(e),encrypt2=async function*({get:e,cids:t,hasher:r,key:n,cache:o,chunker:i,root:s}){const a=new Set;let c;for(const o of t){const t=await e(o);if(!t)throw new Error("missing cid: "+o.toString());const i=await encrypt({...t,key:n}),u=await encode8({...i,codec:encrypted_block_exports,hasher:r});yield u,a.add(u.cid.toString()),t.cid.equals(s)&&(c=u.cid)}if(!c)throw new Error("cids does not include root");const u=[...a].map((e=>CID2.parse(e)));let d;for await(const t of create6({list:u,get:e,cache:o,chunker:i,hasher:r,codec:src_exports})){const e=await t.block;yield e,d=e}if(!d)throw new Error("missing last block");const l=[c,d.cid],h=await encode8({value:l,codec:src_exports,hasher:r});yield h},decrypt2=async function*({root:e,get:t,key:r,cache:n,chunker:o,hasher:i}){const s=async e=>t(e).then((async e=>{if(e)return await decode12({...e,codec:src_exports,hasher:i})})),a=async e=>t(e).then((async e=>{if(e)return await decode12({...e,codec:encrypted_block_exports,hasher:i})})),c=await s(e);if(!c)throw new Error("missing root");if(!c.bytes)throw new Error("missing bytes");const{value:[u,d]}=c,l=await t(u);if(!l)throw new Error("missing root block");const h=await load({cid:d,get:s,cache:n,chunker:o,codec:encrypted_block_exports,hasher:i}),{result:f}=await h.getAllEntries(),p=async e=>{if(!e)throw new Error("missing block");e.value||(e=await decode12({...e,codec:encrypted_block_exports,hasher:i}));const{bytes:t,cid:n}=await decrypt({...e,key:r}).catch((e=>{throw e}));return await create4({cid:n,bytes:t,hasher:i,codec:encrypted_block_exports})},y=[];for(const{cid:e}of f)l.cid.equals(e)||y.push(a(e).then(p));yield*y,yield p(l)},nocache={has:()=>!1,get:()=>{throw new Error("Cannot ask for entries from nocache")},set:()=>{}},chunker=bf(30);function hexStringToUint8Array(e){const t=e.length,r=new Uint8Array(t/2);for(let n=0;n<t;n+=2)r[n/2]=parseInt(e.substring(n,n+2),16);return r}async function encryptedEncodeCarFile(e,t,r){const n=hexStringToUint8Array(e),o=n.buffer.slice(0,n.byteLength),i=new MemoryBlockstore,s=[];for(const{cid:e}of r.entries())if(s.push(e),!await r.get(e))throw new Error("missing cid block");let a=null;for await(const e of encrypt2({cids:s,get:r.get.bind(r),key:o,hasher:sha256,chunker,cache:nocache,root:t}))await i.put(e.cid,e.bytes),a=e;if(!a)throw new Error("no blocks encrypted");return await encodeCarFile([a.cid],i)}async function decodeEncryptedCar(e,t){const r=(await t.getRoots())[0];return await decodeCarBlocks(r,t.get.bind(t),e)}async function decodeCarBlocks(e,t,r){const n=hexStringToUint8Array(r),o=n.buffer.slice(0,n.byteLength),i=new MemoryBlockstore;let s=null;for await(const r of decrypt2({root:e,get:t,key:o,hasher:sha256,chunker,cache:nocache}))await i.put(r.cid,r.bytes),s=r;if(!s)throw new Error("no blocks decrypted");return{blocks:i,root:s.cid}}var JSONEncoder=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===Type.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===Type.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[Type.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[Type.negint.major](e,t){this[Type.uint.major](e,t)}[Type.bytes.major](e,t){throw new Error(`${encodeErrPrefix} unsupported type: Uint8Array`)}[Type.string.major](e,t){this.prefix(e);const r=fromString2(JSON.stringify(t.value));e.push(r.length>32?asU8A(r):r)}[Type.array.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.array,elements:0}),e.push([91])}[Type.map.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.map,elements:0}),e.push([123])}[Type.tag.major](e,t){}[Type.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===Type.array)e.push([93]);else{if(t.type!==Type.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${encodeErrPrefix} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),n=[];let o=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),o||46!==n[e]&&101!==n[e]&&69!==n[e]||(o=!0);o||(n.push(46),n.push(48)),e.push(n)}};function mapSorter2(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${encodeErrPrefix} complex map keys are not supported`);const r=e[0],n=t[0];if(r.type!==Type.string||n.type!==Type.string)throw new Error(`${encodeErrPrefix} non-string map keys are not supported`);if(r<n)return-1;if(r>n)return 1;throw new Error(`${encodeErrPrefix} unexpected duplicate map keys, this is not supported`)}var defaultEncodeOptions3={addBreakTokens:!0,mapSorter:mapSorter2};function encode11(e,t){return t=Object.assign({},defaultEncodeOptions3,t),encodeCustom(e,new JSONEncoder,t)}var Tokenizer=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${decodeErrPrefix} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,r=!1;const n=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new Token(Type.uint,0,this.pos-e);this.pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}`);r=!0,this.pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,n([48,49,50,51,52,53,54,55,56,57]));const o=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),i=parseFloat(o);return r?new Token(Type.float,i,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(i)?new Token(i>=0?Type.uint:Type.negint,i,this.pos-e):new Token(i>=0?Type.uint:Type.negint,BigInt(o),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new Token(Type.string,r,t)}}const e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${decodeErrPrefix} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${decodeErrPrefix} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},n=()=>{const e=this.ch();let r,n,o,i,s=null,a=e>239?4:e>223?3:e>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${decodeErrPrefix} unexpected unicode sequence at position ${this.pos}`);switch(a){case 1:e<128&&(s=e);break;case 2:r=this.data[this.pos+1],128==(192&r)&&(i=(31&e)<<6|63&r,i>127&&(s=i));break;case 3:r=this.data[this.pos+1],n=this.data[this.pos+2],128==(192&r)&&128==(192&n)&&(i=(15&e)<<12|(63&r)<<6|63&n,i>2047&&(i<55296||i>57343)&&(s=i));break;case 4:r=this.data[this.pos+1],n=this.data[this.pos+2],o=this.data[this.pos+3],128==(192&r)&&128==(192&n)&&128==(192&o)&&(i=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&o,i>65535&&i<1114112&&(s=i))}null===s?(s=65533,a=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|1023&s),t.push(s),this.pos+=a};for(;!this.done();){const o=this.ch();let i;switch(o){case 92:if(this.pos++,this.done())throw new Error(`${decodeErrPrefix} unexpected string termination at position ${this.pos}`);switch(i=this.ch(),this.pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${decodeErrPrefix} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new Token(Type.string,decodeCodePointsArray(t),this.pos-e);default:if(o<32)throw new Error(`${decodeErrPrefix} invalid control character at position ${this.pos}`);o<128?(t.push(o),this.pos++):n()}}throw new Error(`${decodeErrPrefix} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new Token(Type.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new Token(Type.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new Token(Type.null,null,4);case 102:return this.expect([102,97,108,115,101]),new Token(Type.false,!1,5);case 116:return this.expect([116,114,117,101]),new Token(Type.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(44!==this.ch())throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new Token(Type.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);if(44!==this.ch())throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new Token(Type.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${decodeErrPrefix} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function decode15(e,t){return decode5(e,t=Object.assign({tokenizer:new Tokenizer(e,t)},t))}var base64=rfc46482({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc46482({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc46482({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc46482({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function cidEncoder2(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=CID2.asCID(e);if(!t)return null;const r=t.toString();return[new Token(Type.map,1/0,1),new Token(Type.string,"/",1),new Token(Type.string,r,r.length),new Token(Type.break,void 0,1)]}function bytesEncoder(e){const t=base64.encode(e).slice(1);return[new Token(Type.map,1/0,1),new Token(Type.string,"/",1),new Token(Type.map,1/0,1),new Token(Type.string,"bytes",5),new Token(Type.string,t,t.length),new Token(Type.break,void 0,1),new Token(Type.break,void 0,1)]}function taBytesEncoder(e){return bytesEncoder(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function abBytesEncoder(e){return bytesEncoder(new Uint8Array(e))}function undefinedEncoder2(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder2(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var encodeOptions2={typeEncoders:{Object:cidEncoder2,Buffer:bytesEncoder,Uint8Array:bytesEncoder,Int8Array:taBytesEncoder,Uint16Array:taBytesEncoder,Int16Array:taBytesEncoder,Uint32Array:taBytesEncoder,Int32Array:taBytesEncoder,Float32Array:taBytesEncoder,Float64Array:taBytesEncoder,Uint8ClampedArray:taBytesEncoder,BigInt64Array:taBytesEncoder,BigUint64Array:taBytesEncoder,DataView:taBytesEncoder,ArrayBuffer:abBytesEncoder,undefined:undefinedEncoder2,number:numberEncoder2}},DagJsonTokenizer=class extends Tokenizer{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===Type.map){const e=this._next();if(e.type===Type.string&&"/"===e.value){const e=this._next();if(e.type===Type.string){if(this._next().type!==Type.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new Token(Type.tag,42,0)}if(e.type===Type.map){const e=this._next();if(e.type===Type.string&&"bytes"===e.value){const e=this._next();if(e.type===Type.string){for(let e=0;e<2;e++)if(this._next().type!==Type.break)throw new Error("Invalid encoded Bytes form");const t=base64.decode(`m${e.value}`);return new Token(Type.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}},decodeOptions2={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions2.tags[42]=CID2.parse;var encode12=e=>encode11(e,encodeOptions2),decode16=e=>decode15(e,Object.assign(decodeOptions2,{tokenizer:new DagJsonTokenizer(e,decodeOptions2)})),format3=e=>utf8Decoder.decode(encode12(e)),utf8Decoder=new TextDecoder,parse2=e=>decode16(utf8Encoder.encode(e)),utf8Encoder=new TextEncoder,instanceOfAny=(e,t)=>t.some((t=>e instanceof t)),idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(wrap(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&cursorRequestMap.set(t,e)})).catch((()=>{})),reverseTransformCache.set(t,e),t}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));transactionDoneMap.set(e,t)}var idbProxyTraps={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return transactionDoneMap.get(e);if("objectStoreNames"===t)return e.objectStoreNames||transactionStoreNamesMap.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return wrap(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap(cursorRequestMap.get(this))}:function(...t){return wrap(e.apply(unwrap(this),t))}:function(t,...r){const n=e.call(unwrap(this),t,...r);return transactionStoreNamesMap.set(n,t.sort?t.sort():[t]),wrap(n)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const t=transformCachableValue(e);return t!==e&&(transformCache.set(e,t),reverseTransformCache.set(t,e)),t}var unwrap=e=>reverseTransformCache.get(e);function openDB(e,t,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=wrap(s);return n&&s.addEventListener("upgradeneeded",(e=>{n(wrap(s.result),e.oldVersion,e.newVersion,wrap(s.transaction),e)})),r&&s.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}var readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(cachedMethods.get(t))return cachedMethods.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=writeMethods.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!readMethods.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return n&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),o&&i.done]))[0]};return cachedMethods.set(t,i),i}replaceTraps((e=>({...e,get:(t,r,n)=>getMethod(t,r)||e.get(t,r,n),has:(t,r)=>!!getMethod(t,r)||e.has(t,r)})));var PACKAGE_VERSION="0.14.2",match=PACKAGE_VERSION.match(/^([^.]*\.[^.]*)/);if(!match)throw new Error("invalid version: "+PACKAGE_VERSION);var STORAGE_VERSION=match[0],VersionedStore=class{constructor(e){__publicField(this,"STORAGE_VERSION",STORAGE_VERSION),__publicField(this,"name"),this.name=e}},MetaStore=class extends VersionedStore{constructor(){super(...arguments),__publicField(this,"tag","header-base")}makeHeader({car:e,key:t}){return format3({car:e,key:t})}parseHeader(e){return parse2(e)}},DataStore=class{constructor(e){__publicField(this,"tag","car-base"),__publicField(this,"STORAGE_VERSION",STORAGE_VERSION),__publicField(this,"loader"),this.loader=e}},CommitQueue=class{constructor(){__publicField(this,"queue",[]),__publicField(this,"processing",!1)}async enqueue(e){return new Promise(((t,r)=>{this.queue.push((async()=>{try{t(await e())}catch(e){r(e)}finally{this.processing=!1,this.processNext()}})),this.processing||this.processNext()}))}processNext(){if(this.queue.length>0&&!this.processing){this.processing=!0;const e=this.queue.shift();e&&e()}}},RemoteWAL=class{constructor(e){__publicField(this,"tag","rwal-base"),__publicField(this,"STORAGE_VERSION",STORAGE_VERSION),__publicField(this,"loader"),__publicField(this,"ready"),__publicField(this,"walState",{operations:[],noLoaderOps:[],fileOperations:[]}),__publicField(this,"processing"),__publicField(this,"processQueue",new CommitQueue),this.loader=e,this.ready=(async()=>{const e=await this.load().catch((e=>(console.error("error loading wal",e),null)));this.walState.operations=e?.operations||[],this.walState.fileOperations=e?.fileOperations||[]})()}async enqueue(e,t){await this.ready,t.noLoader?this.walState.noLoaderOps.push(e):this.walState.operations.push(e),await this.save(this.walState),this._process()}async enqueueFile(e,t=!1){await this.ready,this.walState.fileOperations.push({cid:e,public:t})}async _process(){await this.ready,this.loader.remoteCarStore&&await this.processQueue.enqueue((async()=>{await this._doProcess(),(this.walState.operations.length||this.walState.fileOperations.length||this.walState.noLoaderOps.length)&&setTimeout((()=>{this._process()}),0)}))}async _doProcess(){if(!this.loader.remoteCarStore)return;const e=(async()=>{const e=[...this.walState.operations],t=[...this.walState.fileOperations],r=[],n=[...this.walState.noLoaderOps],o=pLimit(5);if(e.length+t.length+n.length!==0){for(const e of n){const t=o((async()=>{const t=await this.loader.carStore.load(e.car).catch((()=>null));if(t)await this.loader.remoteCarStore.save(t);else if(cidListIncludes(this.loader.carLog,e.car))throw new Error(`missing car ${e.car.toString()}`);this.walState.noLoaderOps=this.walState.noLoaderOps.filter((t=>t!==e))}));r.push(t)}for(const t of e){const e=o((async()=>{const e=await this.loader.carStore.load(t.car).catch((()=>null));if(e)await this.loader.remoteCarStore.save(e);else if(cidListIncludes(this.loader.carLog,t.car))throw new Error(`missing car ${t.car.toString()}`);this.walState.operations=this.walState.operations.filter((e=>e!==t))}));r.push(e)}if(t.length){const e=this.loader;for(const{cid:n,public:i}of t){const t=o((async()=>{const t=await e.fileStore.load(n);await(e.remoteFileStore?.save(t,{public:i})),this.walState.fileOperations=this.walState.fileOperations.filter((e=>e.cid!==n))}));r.push(t)}}try{const t=(await Promise.allSettled(r)).filter((e=>"rejected"===e.status));if(t.length)throw console.error("error uploading",JSON.stringify(t)),t[0].reason;if(e.length){const t=e[e.length-1];await(this.loader.remoteMetaStore?.save(t).catch((e=>{throw console.error("error saving remote meta",e),this.walState.operations.push(t),e})))}}finally{await this.save(this.walState)}}})();this.loader.remoteMetaLoading=e,await e}},DataStore2=class extends DataStore{constructor(){super(...arguments),__publicField(this,"tag","car-browser-idb"),__publicField(this,"idb",null)}async _withDB(e){if(!this.idb){const e=`fp.${this.STORAGE_VERSION}.${this.loader.keyId}.${this.loader.name}`;this.idb=await openDB(e,1,{upgrade(e){e.createObjectStore("cars")}})}return await e(this.idb)}async load(e){return await this._withDB((async t=>{const r=t.transaction(["cars"],"readonly"),n=await r.objectStore("cars").get(e.toString());if(!n)throw new Error(`missing idb block ${e.toString()}`);return{cid:e,bytes:n}}))}async save(e){return await this._withDB((async t=>{const r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").put(e.bytes,e.cid.toString()),await r.done}))}async remove(e){return await this._withDB((async t=>{const r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").delete(e.toString()),await r.done}))}},RemoteWAL2=class extends RemoteWAL{constructor(){super(...arguments),__publicField(this,"tag","wal-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.wal.${this.loader.name}.${e}`}async load(e="main"){try{const t=localStorage.getItem(this.headerKey(e));return t?parse2(t):null}catch(e){return null}}async save(e,t="main"){try{const r=format3(e);localStorage.setItem(this.headerKey(t),r)}catch(e){throw console.error("error saving wal",e),e}}},MetaStore2=class extends MetaStore{constructor(){super(...arguments),__publicField(this,"tag","header-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.meta.${this.name}.${e}`}async load(e="main"){try{const t=localStorage.getItem(this.headerKey(e));return t?[this.parseHeader(t)]:null}catch(e){return null}}async save(e,t="main"){try{const r=this.headerKey(t),n=this.makeHeader(e);return localStorage.setItem(r,n),null}catch(e){return null}}};function cidListIncludes(e,t){return e.some((e=>e.equals(t)))}function uniqueCids(e,t=new Set){const r=new Map;for(const n of e)t.has(n.toString())||r.set(n.toString(),n);return[...r.values()]}function toHexString(e){return Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join("")}var Loader=class{constructor(e,t){__publicField(this,"name"),__publicField(this,"opts",{}),__publicField(this,"commitQueue",new CommitQueue),__publicField(this,"isCompacting",!1),__publicField(this,"isWriting",!1),__publicField(this,"remoteMetaLoading"),__publicField(this,"remoteMetaStore"),__publicField(this,"remoteCarStore"),__publicField(this,"remoteWAL"),__publicField(this,"metaStore"),__publicField(this,"carStore"),__publicField(this,"carLog",[]),__publicField(this,"carReaders",new Map),__publicField(this,"ready"),__publicField(this,"key"),__publicField(this,"keyId"),__publicField(this,"seenCompacted",new Set),__publicField(this,"getBlockCache",new Map),__publicField(this,"seenMeta",new Set),this.name=e,this.opts=t||this.opts,this.metaStore=new MetaStore2(this.name),this.carStore=new DataStore2(this),this.remoteWAL=new RemoteWAL2(this),this.ready=Promise.resolve().then((async()=>{if(!this.metaStore||!this.carStore||!this.remoteWAL)throw new Error("stores not initialized");const e=this.opts.meta?[this.opts.meta]:await this.metaStore.load("main");e&&await this.handleDbMetasFromStore(e)}))}async snapToCar(e){await this.ready,"string"==typeof e&&(e=CID2.parse(e));const t=await this.loadCarHeaderFromMeta({car:e,key:this.key||null});this.carLog=[e,...t.cars],await this.getMoreReaders(t.cars),await this._applyCarHeader(t,!0)}async _readyForMerge(){}async _setWaitForWrite(e){}async handleDbMetasFromStore(e){for(const t of e){const e=async()=>{this.isWriting=!0,await this.mergeDbMetaIntoClock(t),this.isWriting=!1};this._setWaitForWrite(e),await e()}}async mergeDbMetaIntoClock(e){if(await this.compacting,this.isCompacting)throw new Error("cannot merge while compacting");if(this.seenMeta.has(e.car.toString()))return;if(this.seenMeta.add(e.car.toString()),e.key&&await this.setKey(e.key),cidListIncludes(this.carLog,e.car))return;const t=await this.loadCarHeaderFromMeta(e);t.compact.map((e=>e.toString())).forEach(this.seenCompacted.add,this.seenCompacted),await this.getMoreReaders(t.cars),this.carLog=[...uniqueCids([e.car,...this.carLog,...t.cars],this.seenCompacted)],await this._applyCarHeader(t)}async ingestKeyFromMeta(e){const{key:t}=e;t&&await this.setKey(t)}async loadCarHeaderFromMeta({car:e}){const t=await this.loadCar(e);return await parseCarFile(t)}async _getKey(){return this.key||this.opts.public||(getCrypto()?await this.setKey(toHexString(randomBytes(32))):console.warn("missing crypto module, using public mode")),this.key}async commit(e,t,r={noLoader:!1,compact:!1}){return this.commitQueue.enqueue((()=>this._commitInternal(e,t,r)))}async _commitInternal(e,t,r={noLoader:!1,compact:!1}){await this.ready;const n=this.makeCarHeader(t,this.carLog,!!r.compact);let o=[];if(n.files)o=n.files;else{const t=await encodeCarHeader(n);await e.put(t.cid,t.bytes),o=[t.cid]}const i=r.public?null:await this._getKey(),{cid:s,bytes:a}=i?await encryptedEncodeCarFile(i,o[0],e):await encodeCarFile(o,e);if(isFileResult(t)){const e=this;return await e.fileStore.save({cid:s,bytes:a}),await this.remoteWAL.enqueueFile(s,r.public),s}await this.carStore.save({cid:s,bytes:a});const c={car:s,key:i||null};if(await this.remoteWAL.enqueue(c,r),await this.metaStore.save(c),r.compact){const e=n;e.compact.map((e=>e.toString())).forEach(this.seenCompacted.add,this.seenCompacted),this.carLog=[...uniqueCids([s,...this.carLog],this.seenCompacted)],setTimeout((async()=>{this.remoteMetaLoading&&await this.remoteMetaLoading;for(const t of e.compact)await this.carStore.remove(t)}),5e3)}else this.carLog.unshift(s);return s}async flushCars(){await this.ready;for(const e of this.carLog){const t={car:e,key:this.key||null};await this.remoteWAL.enqueue(t,{public:!1})}}async*entries(){await this.ready;for(const e of this.carLog){const t=await this.loadCar(e);if(!t)throw new Error(`missing car reader ${e.toString()}`);for await(const e of t.blocks())yield e}}async getBlock(e){await this.ready;const t=e.toString();if(this.getBlockCache.has(t))return this.getBlockCache.get(t);const r=await Promise.any(this.carLog.map((async t=>{const r=await this.loadCar(t);if(!r)throw new Error(`missing car reader ${t.toString()}`);const n=await r.get(e);if(n)return n;throw new Error(`block not in reader: ${e.toString()}`)}))).catch((()=>{}));return r&&this.getBlockCache.set(t,r),r}async loadCar(e){if(!this.carStore)throw new Error("car store not initialized");return await this.storesLoadCar(e,this.carStore,this.remoteCarStore)}async storesLoadCar(e,t,r,n){const o=e.toString();return this.carReaders.has(o)||this.carReaders.set(o,(async()=>{let i=null;try{i=await t.load(e)}catch(n){if(r){const n=await r.load(e);n&&(await t.save(n),i=n)}}if(!i)throw new Error(`missing car file ${o}`);const s=await CarReader.fromBytes(i.bytes),a=n?Promise.resolve(s):this.ensureDecryptedReader(s);return this.carReaders.set(o,a),a})().catch((e=>{throw this.carReaders.delete(o),e}))),this.carReaders.get(o)}async ensureDecryptedReader(e){const t=await this._getKey();if(!t)return e;const{blocks:r,root:n}=await decodeEncryptedCar(t,e);return{getRoots:()=>[n],get:r.get.bind(r),blocks:r.entries.bind(r)}}async setKey(e){if(this.key&&this.key!==e)throw new Error("key mismatch");this.key=e;const t=getCrypto();if(!t)throw new Error("missing crypto module");const r=t.subtle,n=(new TextEncoder).encode(e),o=await r.digest("SHA-256",n),i=Array.from(new Uint8Array(o));this.keyId=i.map((e=>e.toString(16).padStart(2,"0"))).join("")}async getMoreReaders(e){const t=pLimit(5),r=e.filter((e=>!this.carReaders.has(e.toString())));await Promise.all(r.map((e=>t((()=>this.loadCar(e))))))}};__publicField(Loader,"defaultHeader");var import_charwise=__toESM(require_charwise(),1),MapEntry=class extends Entry{async identity(){const e=await this.codec.encode(await this.encodeNode()),t=await this.hasher.encode(e);return readUInt32LE2(t)}},MapLeafEntry=class extends MapEntry{constructor(e,t){super(e,t),this.value=e.value}encodeNode(){return[this.key,this.value]}},MapBranchEntry=class extends MapEntry{constructor(e,t){if(!e.address)throw new Error("Cannot create MapBranchEntry without address");super(e,t)}async encodeNode(){return[this.key,await this.address]}},getValue=async(e,t)=>{const{result:r,cids:n}=await e.getEntry(t);return{result:r.value,cids:n}},getManyValues=async(e,t)=>{const{result:r,cids:n}=await e.getEntries(t);return{result:r.map((e=>e.value)),cids:n}},MapLeaf=class extends IPLDLeaf{get(e){return getValue(this,e)}getMany(e){return getManyValues(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...classes,...t},r)}},MapBranch=class extends IPLDBranch{get(e){return getValue(this,e)}getMany(e){return getManyValues(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...classes,...t},r)}},classes={LeafClass:MapLeaf,LeafEntryClass:MapLeafEntry,BranchClass:MapBranch,BranchEntryClass:MapBranchEntry},createGetNode2=(e,t,r,n,o,i,s)=>{const a=s.LeafClass||MapLeaf,c=s.LeafEntryClass||MapLeafEntry,u=s.BranchClass||MapBranch,d=s.BranchEntryClass||MapBranchEntry,l=async r=>t.has(r)?t.get(r):e(r).then((e=>h(e))),h=makeDecoder({chunker:r,cache:t,getNode:l,codec:n,hasher:o,compare:i,LeafEntryClass:c,LeafClass:a,BranchEntryClass:d,BranchClass:u});return l},create7=({get:e,cache:t,chunker:r,list:n,codec:o,hasher:i,sorted:s,compare:a,...c})=>{s||(n=n.sort((({key:e},{key:t})=>a(e,t))));const u={list:n,codec:o,hasher:i,chunker:r,getNode:createGetNode2(e,t,r,o,i,a,c),sorted:s,compare:a,cache:t,LeafClass:c.LeafClass||MapLeaf,LeafEntryClass:c.LeafEntryClass||MapLeafEntry,BranchClass:c.BranchClass||MapBranch,BranchEntryClass:c.BranchEntryClass||MapBranchEntry};return create5(u)},load2=({cid:e,get:t,cache:r,chunker:n,codec:o,hasher:i,compare:s,...a})=>createGetNode2(t,r,n,o,i,s,a)(e);function makeDecoder({chunker:e,cache:t,getNode:r,codec:n,hasher:o,compare:i,LeafEntryClass:s,LeafClass:a,BranchEntryClass:c,BranchClass:u}){const d={codec:n,hasher:o};return l=>{const{value:h}=l,f={chunker:e,cache:t,block:l,getNode:r,codec:n,hasher:o,compare:i};let p,y;if(h.leaf)p=h.leaf.map((([e,t])=>new s({key:e,value:t},d))),y=a;else{if(!h.branch)throw new Error("Unknown block data, does not match schema");{const[e,t]=h.branch;f.distance=e,p=t.map((([e,t])=>new c({key:e,address:t},d))),y=u}}const m=new y({entryList:new EntryList({entries:p,closed:h.closed}),...f});return t.set(m),m}}var compare4=(e,t)=>{const[r,n]=e,[o,i]=t,s=simpleCompare(r,o);return 0!==s?s:refCompare(n,i)},refCompare=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return Number.isFinite(e)?simpleCompare(e,t):1},getIndex=async(e,t)=>{const r=[t,NaN],n=[t,1/0],{result:o,cids:i}=await e.getRangeEntries(r,n);return{result:o.map((e=>{const[t,r]=e.key;return{id:r,key:t,row:e.value}})),cids:i}},getRange=async(e,t,r)=>{t=[t,NaN],r=[r,1/0];const{result:n,cids:o}=await e.getRangeEntries(t,r);return{result:n.map((e=>{const[t,r]=e.key;return{id:r,key:t,row:e.value}})),cids:o}},DBIndexLeaf=class extends MapLeaf{get(e){return getIndex(this,e)}range(e,t){return getRange(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...classes2,...t},r)}},DBIndexBranch=class extends MapBranch{get(e){return getIndex(this,e)}range(e,t){return getRange(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...classes2,...t},r)}},LeafClass=DBIndexLeaf,BranchClass=DBIndexBranch,classes2={LeafClass,BranchClass,LeafEntryClass:MapLeafEntry,BranchEntryClass:MapBranchEntry},defaults={...classes2,compare:compare4},create8=e=>(e={...defaults,...e},create7(e)),load3=e=>(e={...defaults,...e},load2(e)),IndexTree=class{constructor(){__publicField(this,"cid",null),__publicField(this,"root",null)}},refCompare2=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return e===1/0?1:simpleCompare(e,t)},compare5=(e,t)=>{const[r,n]=e,[o,i]=t,s=simpleCompare(r,o);return 0!==s?s:refCompare2(n,i)},byKeyOpts={cache:nocache,chunker:bf(30),codec:src_exports,hasher:sha256,compare:compare5},byIdOpts={cache:nocache,chunker:bf(30),codec:src_exports,hasher:sha256,compare:simpleCompare};function indexEntriesForChanges(e,t){const r=[];return e.forEach((({key:e,value:n,del:o})=>{if(o||!n)return;let i=!1;const s=t({_id:e,...n},((t,n)=>{i=!0,void 0!==t&&r.push({key:[import_charwise.default.encode(t),e],value:n||null})}));!i&&s&&r.push({key:[import_charwise.default.encode(s),e],value:null})})),r}function makeProllyGetBlock(e){return async t=>{const r=await e.get(t);if(!r)throw new Error(`Missing block ${t.toString()}`);const{cid:n,bytes:o}=r;return create4({cid:n,bytes:o,hasher:sha256,codec:src_exports})}}async function bulkIndex(e,t,r,n){if(!r.length)return t;if(!t.root){if(!t.cid){let t=null,o=null;for await(const i of await create8({get:makeProllyGetBlock(e),list:r,...n})){const r=await i.block;await e.put(r.cid,r.bytes),t=r,o=i}if(!o||!t)throw new Error("failed to create index");return{root:o,cid:t.cid}}t.root=await load3({cid:t.cid,get:makeProllyGetBlock(e),...n})}const{root:o,blocks:i}=await t.root.bulk(r);if(o){for await(const t of i)await e.put(t.cid,t.bytes);return{root:o,cid:(await o.block).cid}}return{root:null,cid:null}}async function loadIndex(e,t,r){return await load3({cid:t,get:makeProllyGetBlock(e),...r})}async function applyQuery(e,t,r){return r.descending&&(t.result=t.result.reverse()),r.limit&&(t.result=t.result.slice(0,r.limit)),r.includeDocs&&(t.result=await Promise.all(t.result.map((async t=>{const r=await e.get(t.id),n=r?{_id:t.id,...r.doc}:null;return{...t,doc:n}})))),{rows:t.result.map((e=>(e.key=import_charwise.default.decode(e.key),e.row&&!e.value&&(e.value=e.row,delete e.row),e)))}}function encodeRange(e){return e.map((e=>import_charwise.default.encode(e)))}function encodeKey(e){return import_charwise.default.encode(e)}function index({_crdt:e},t,r,n){if(r&&n)throw new Error("cannot provide both mapFn and meta");if(r&&"Function"!==r.constructor.name)throw new Error("mapFn must be a function");if(e.indexers.has(t))e.indexers.get(t).applyMapFn(t,r,n);else{const o=new Index(e,t,r,n);e.indexers.set(t,o)}return e.indexers.get(t)}var Index=class{constructor(e,t,r,n){if(__publicField(this,"blocks"),__publicField(this,"crdt"),__publicField(this,"name",null),__publicField(this,"mapFn",null),__publicField(this,"mapFnString",""),__publicField(this,"byKey",new IndexTree),__publicField(this,"byId",new IndexTree),__publicField(this,"indexHead"),__publicField(this,"includeDocsDefault",!1),__publicField(this,"initError",null),__publicField(this,"ready"),this.blocks=e.indexBlocks,this.crdt=e,this.applyMapFn(t,r,n),!this.mapFnString&&!this.initError)throw new Error("missing mapFnString");this.ready=this.blocks.ready.then((()=>{}))}applyMapFn(e,t,r){if(t&&r)throw new Error("cannot provide both mapFn and meta");if(this.name&&this.name!==e)throw new Error("cannot change name");this.name=e;try{if(r){if(this.indexHead&&this.indexHead.map((e=>e.toString())).join()!==r.head.map((e=>e.toString())).join())throw new Error("cannot apply meta to existing index");this.mapFnString?this.mapFnString!==r.map?console.log("cannot apply different mapFn meta: old mapFnString",this.mapFnString,"new mapFnString",r.map):(this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head):(this.mapFnString=r.map,this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head)}else if(this.mapFn){if(t&&this.mapFn.toString()!==t.toString())throw new Error("cannot apply different mapFn app2")}else{if(t||(t=makeMapFnFromName(e)),this.mapFnString){if(this.mapFnString!==t.toString())throw new Error("cannot apply different mapFn app")}else this.mapFnString=t.toString();this.mapFn=t}const n=/=>\s*(.*)/.test(this.mapFnString);this.includeDocsDefault=n}catch(e){this.initError=e}}async query(e={}){if(await this._updateIndex(),await this._hydrateIndex(),!this.byKey.root)return await applyQuery(this.crdt,{result:[]},e);if(this.includeDocsDefault&&void 0===e.includeDocs&&(e.includeDocs=!0),e.range){const{result:t,...r}=await this.byKey.root.range(...encodeRange(e.range));return await applyQuery(this.crdt,{result:t,...r},e)}if(e.key){const t=encodeKey(e.key);return await applyQuery(this.crdt,await this.byKey.root.get(t),e)}if(Array.isArray(e.keys))return{rows:(await Promise.all(e.keys.map((async t=>{const r=encodeKey(t);return(await applyQuery(this.crdt,await this.byKey.root.get(r),e)).rows})))).flat()};if(e.prefix){Array.isArray(e.prefix)||(e.prefix=[e.prefix]);const t=encodeRange([[...e.prefix,NaN],[...e.prefix,1/0]]);return await applyQuery(this.crdt,await this.byKey.root.range(...t),e)}const{result:t,...r}=await this.byKey.root.getAllEntries();return await applyQuery(this.crdt,{result:t.map((({key:[e,t],value:r})=>({key:e,id:t,value:r}))),...r},e)}_resetIndex(){this.byId=new IndexTree,this.byKey=new IndexTree,this.indexHead=void 0}async _hydrateIndex(){this.byId.root&&this.byKey.root||this.byId.cid&&this.byKey.cid&&(this.byId.root=await loadIndex(this.blocks,this.byId.cid,byIdOpts),this.byKey.root=await loadIndex(this.blocks,this.byKey.cid,byKeyOpts))}async _updateIndex(){if(await this.ready,this.initError)throw this.initError;if(!this.mapFn)throw new Error("No map function defined");let e,t;if(this.indexHead&&0!==this.indexHead.length?({result:e,head:t}=await this.crdt.changes(this.indexHead)):({result:e,head:t}=await this.crdt.allDocs()),0===e.length)return this.indexHead=t,{byId:this.byId,byKey:this.byKey};let r=[],n=[];if(this.byId.root){const t=e.map((({key:e})=>e)),{result:o}=await this.byId.root.getMany(t);r=o.map((e=>({key:e,del:!0}))),n=o.map((e=>({key:e[1],del:!0})))}const o=indexEntriesForChanges(e,this.mapFn),i=o.map((({key:e})=>({key:e[1],value:e}))),s=new Map;for(const[e,t]of this.crdt.indexers)t.indexHead&&s.set(e,{byId:t.byId.cid,byKey:t.byKey.cid,head:t.indexHead,map:t.mapFnString,name:t.name});return await this.blocks.transaction((async e=>(this.byId=await bulkIndex(e,this.byId,n.concat(i),byIdOpts),this.byKey=await bulkIndex(e,this.byKey,r.concat(o),byKeyOpts),this.indexHead=t,{byId:this.byId.cid,byKey:this.byKey.cid,head:t,map:this.mapFnString,name:this.name})),s)}};function makeMapFnFromName(e){return t=>{if(t[e])return t[e]}}var parse3=(e,t)=>CID2.parse(e,t),from4=({name:e,code:t,encode:r})=>new Hasher2(e,t,r),Hasher2=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?create(this.code,t):t.then((e=>create(this.code,e)))}throw Error("Unknown type, must be binary type")}};function readonly2({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*linksWithin2(e,t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r],o=CID.asCID(n);o?yield[t.join("/"),o]:"object"==typeof n&&(yield*links2(n,t))}else{const r=CID.asCID(t);r?yield[e.join("/"),r]:yield*links2(t,e)}}function*links2(e,t){if(null==e||e instanceof Uint8Array)return;const r=CID.asCID(e);r&&(yield[t.join("/"),r]);for(const[r,n]of Object.entries(e)){const e=[...t,r];yield*linksWithin2(e,n)}}function*treeWithin2(e,t){if(Array.isArray(t))for(const[r,n]of t.entries()){const t=[...e,r];yield t.join("/"),"object"!=typeof n||CID.asCID(n)||(yield*tree2(n,t))}else yield*tree2(t,e)}function*tree2(e,t){if(null!=e&&"object"==typeof e)for(const[r,n]of Object.entries(e)){const e=[...t,r];yield e.join("/"),null==n||n instanceof Uint8Array||"object"!=typeof n||CID.asCID(n)||(yield*treeWithin2(e,n))}}function get2(e,t){let r=e;for(const[e,n]of t.entries()){if(r=r[n],null==r)throw new Error(`Object has no property at ${t.slice(0,e+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const o=CID.asCID(r);if(o)return{value:o,remaining:t.slice(e+1).join("/")}}return{value:r}}var Block3=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:readonly2(),bytes:readonly2(),value:readonly2(),asBlock:readonly2()})}links(){return links2(this.value,[])}tree(){return tree2(this.value,[])}get(e="/"){return get2(this.value,e.split("/").filter(Boolean))}};async function encode13({value:e,codec:t,hasher:r}){if(void 0===e)throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");const n=t.encode(e),o=await r.digest(n),i=CID.create(1,t.code,o);return new Block3({value:e,bytes:n,cid:i})}async function decode17({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");const n=t.decode(e),o=await r.digest(e),i=CID.create(1,t.code,o);return new Block3({value:n,bytes:e,cid:i})}var sha2_browser_exports={};__export(sha2_browser_exports,{sha256:()=>sha2562,sha512:()=>sha5122});var sha2=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),sha2562=from4({name:"sha2-256",code:18,encode:sha2("SHA-256")}),sha5122=from4({name:"sha2-512",code:19,encode:sha2("SHA-512")});async function advance(e,t,r){const n=new EventFetcher(e),o=new Map(t.map((e=>[e.toString(),e])));if(o.has(r.toString()))return t;let i=!1;for(const e of t)await contains(n,r,e)&&(o.delete(e.toString()),o.set(r.toString(),r),i=!0);if(i)return[...o.values()];for(const e of t)if(await contains(n,e,r))return t;return t.concat(r)}var EventBlock=class extends Block3{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(e,t){return encodeEventBlock({data:e,parents:t??[]})}},EventFetcher=class{constructor(e){this._blocks=e}async get(e){const t=await this._blocks.get(e);if(!t)throw new Error(`missing block: ${e}`);return decodeEventBlock(t.bytes)}};async function encodeEventBlock(e){const{cid:t,bytes:r}=await encode13({value:e,codec:src_exports,hasher:sha2562});return new Block3({cid:t,value:e,bytes:r})}async function decodeEventBlock(e){const{cid:t,value:r}=await decode17({bytes:e,codec:src_exports,hasher:sha2562});return new Block3({cid:t,value:r,bytes:e})}async function contains(e,t,r){if(t.toString()===r.toString())return!0;const[{value:n},{value:o}]=await Promise.all([e.get(t),e.get(r)]),i=[...n.parents],s=new Set;for(;i.length;){const t=i.shift();if(!t)break;if(t.toString()===r.toString())return!0;if(o.parents.some((e=>t.toString()===e.toString())))continue;if(s.has(t.toString()))continue;s.add(t.toString());const{value:n}=await e.get(t);i.push(...n.parents)}return!1}async function*vis(e,t,r={}){const n=r.renderNodeLabel??(e=>shortLink(e.cid)),o=new EventFetcher(e);yield"digraph clock {",yield'  node [shape=point fontname="Courier"]; head;';const i=await Promise.all(t.map((e=>o.get(e)))),s=[],a=new Set;for(const e of i){a.add(e.cid.toString()),yield`  node [shape=oval fontname="Courier"]; ${e.cid} [label="${n(e)}"];`,yield`  head -> ${e.cid};`;for(const t of e.value.parents)yield`  ${e.cid} -> ${t};`;s.push(...e.value.parents)}for(;s.length;){const e=s.shift();if(!e)break;if(a.has(e.toString()))continue;a.add(e.toString());const t=await o.get(e);yield`  node [shape=oval]; ${e} [label="${n(t)}" fontname="Courier"];`;for(const r of t.value.parents)yield`  ${e} -> ${r};`;s.push(...t.value.parents)}yield"}"}var shortLink=e=>`${String(e).slice(0,4)}..${String(e).slice(-4)}`,ShardBlock=class extends Block3{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(){return encodeShardBlock([])}},decodeCache=new WeakMap;async function encodeShardBlock(e,t){const{cid:r,bytes:n}=await encode13({value:e,codec:src_exports,hasher:sha2562}),o=new ShardBlock({cid:r,value:e,bytes:n,prefix:t??""});return decodeCache.set(o.bytes,o),o}async function decodeShardBlock(e,t){const r=decodeCache.get(e);if(r)return r;const{cid:n,value:o}=await decode17({bytes:e,codec:src_exports,hasher:sha2562});if(!Array.isArray(o))throw new Error(`invalid shard: ${n}`);return new ShardBlock({cid:n,value:o,bytes:e,prefix:t??""})}var ShardFetcher=class{constructor(e){this._blocks=e}async get(e,t=""){const r=await this._blocks.get(e);if(!r)throw new Error(`missing block: ${e}`);return decodeShardBlock(r.bytes,t)}};function putEntry(e,t){if(!e.length)return[t];const r=[];for(const[n,[o,i]]of e.entries()){if(t[0]===o){if(Array.isArray(t[1]))Array.isArray(i)&&null!=i[1]&&null==t[1][1]?r.push([o,[t[1][0],i[1]]]):r.push(t);else{const e=Array.isArray(i)?[o,[i[0],t[1]]]:t;r.push(e)}for(let t=n+1;t<e.length;t++)r.push(e[t]);return r}if(0===n&&t[0]<o){r.push(t);for(let t=n;t<e.length;t++)r.push(e[t]);return r}if(n>0&&t[0]>e[n-1][0]&&t[0]<o){r.push(t);for(let t=n;t<e.length;t++)r.push(e[t]);return r}r.push([o,i])}return r.push(t),r}function findCommonPrefix(e,t){const r=e.findIndex((([e])=>t===e));if(-1===r)throw new Error(`key not found in shard: ${t}`);let n,o=r;for(;;){if(n=e[o][0].slice(0,-1),n.length)for(;;){const t=e.filter((e=>e[0].startsWith(n)));if(t.length>1)return{prefix:n,matches:t};if(n=n.slice(0,-1),!n.length)break}if(o++,o>=e.length&&(o=0),o===r)return}}var MaxKeyLength=64,MaxShardSize=524288;async function put(e,t,r,n,o={}){const i=new ShardFetcher(e),s=await i.get(t),a=await traverse(i,s,r),c=a[a.length-1],u=r.slice(c.prefix.length);let d=[u,n];const l=[];if(u.length>MaxKeyLength){const e=Array.from(Array(Math.ceil(u.length/MaxKeyLength)),((e,t)=>{const r=t*MaxKeyLength;return{prefix:c.prefix+u.slice(0,r),skey:u.slice(r,r+MaxKeyLength)}}));let t=await encodeShardBlock([[e[e.length-1].skey,n]],e[e.length-1].prefix);l.push(t);for(let r=e.length-2;r>0;r--)t=await encodeShardBlock([[e[r].skey,[t.cid]]],e[r].prefix),l.push(t);d=[e[0].skey,[t.cid]]}let h=putEntry(c.value,d),f=await encodeShardBlock(h,c.prefix);if(f.bytes.length>(o.maxShardSize??MaxShardSize)){const e=findCommonPrefix(h,d[0]);if(!e)throw new Error("shard limit reached");const{prefix:t,matches:r}=e,n=await encodeShardBlock(r.filter((([e])=>e!==t)).map((([e,r])=>[e.slice(t.length),r])),c.prefix+t);let o;l.push(n);const i=r.find((([e])=>e===t));if(i){if(Array.isArray(i[1]))throw new Error(`expected "${t}" to be a shard value but found a shard link`);o=[n.cid,i[1]]}else o=[n.cid];h=h.filter((e=>r.every((t=>e[0]!==t[0])))),h=putEntry(h,[t,o]),f=await encodeShardBlock(h,c.prefix)}l.push(f);for(let e=a.length-2;e>=0;e--){const t=a[e],r=f.prefix.slice(t.prefix.length),n=t.value.map((e=>{const[n,o]=e;if(n!==r)return e;if(!Array.isArray(o))throw new Error(`"${r}" is not a shard link in: ${t.cid}`);return null==o[1]?[n,[f.cid]]:[n,[f.cid,o[1]]]}));f=await encodeShardBlock(n,t.prefix),l.push(f)}return{root:l[l.length-1].cid,additions:l,removals:a}}async function get3(e,t,r){const n=new ShardFetcher(e),o=await n.get(t),i=await traverse(n,o,r),s=i[i.length-1],a=r.slice(s.prefix.length),c=s.value.find((([e])=>e===a));if(c)return Array.isArray(c[1])?c[1][1]:c[1]}async function del(e,t,r){const n=new ShardFetcher(e),o=await n.get(t),i=await traverse(n,o,r),s=i[i.length-1],a=r.slice(s.prefix.length),c=s.value.findIndex((([e])=>e===a));if(-1===c)return{root:t,additions:[],removals:[]};const u=s.value[c];if(Array.isArray(u[1])&&null==u[1][1])return{root:t,additions:[],removals:[]};const d=[],l=[...i];let h=[...s.value];if(Array.isArray(u[1]))h[c]=[u[0],[u[1][0]]];else for(h.splice(c,1);!h.length;){const e=i[i.length-1],t=i[i.length-2];if(!t)break;i.pop(),h=t.value.filter((t=>!Array.isArray(t[1])||t[1][0].toString()!==e.cid.toString()))}let f=await encodeShardBlock(h,i[i.length-1].prefix);d.push(f);for(let e=i.length-2;e>=0;e--){const t=i[e],r=f.prefix.slice(t.prefix.length),n=t.value.map((e=>{const[n,o]=e;if(n!==r)return e;if(!Array.isArray(o))throw new Error(`"${r}" is not a shard link in: ${t.cid}`);return null==o[1]?[n,[f.cid]]:[n,[f.cid,o[1]]]}));f=await encodeShardBlock(n,t.prefix),d.push(f)}return{root:d[d.length-1].cid,additions:d,removals:l}}async function*entries(e,t,r={}){const{prefix:n}=r,o=new ShardFetcher(e),i=await o.get(t);yield*async function*e(t){for(const r of t.value){const i=t.prefix+r[0];if(Array.isArray(r[1])){if(r[1][1]&&(!n||n&&i.startsWith(n))&&(yield[i,r[1][1]]),n){if(n.length<=i.length&&!i.startsWith(n))continue;if(n.length>i.length&&!n.startsWith(i))continue}yield*e(await o.get(r[1][0],i))}else{if(n&&!i.startsWith(n))continue;yield[i,r[1]]}}}(i)}async function traverse(e,t,r){for(const[n,o]of t.value){if(r===n)return[t];if(r.startsWith(n)&&Array.isArray(o))return[t,...await traverse(e,await e.get(o[0],t.prefix+n),r.slice(n.length))]}return[t]}async function put2(e,t,r,n,o){const i=new MemoryBlockstore;if(e=new MultiBlockFetcher(i,e),!t.length){const s=await ShardBlock.create();i.putSync(s.cid,s.bytes);const a=await put(e,s.cid,r,n,o),c={type:"put",root:a.root,key:r,value:n},u=await EventBlock.create(c,t);return t=await advance(e,t,u.cid),{root:a.root,additions:[s,...a.additions],removals:a.removals,head:t,event:u}}const s=new EventFetcher(e),a=await findCommonAncestor(s,t);if(!a)throw new Error("failed to find common ancestor event");const c=await s.get(a);let{root:u}=c.value.data;const d=await findSortedEvents(s,t,a),l=new Map,h=new Map;for(const{value:t}of d){if(!["put","del"].includes(t.data.type))throw new Error(`unknown event type: ${t.data.type}`);const r="put"===t.data.type?await put(e,u,t.data.key,t.data.value):await del(e,u,t.data.key);u=r.root;for(const e of r.additions)i.putSync(e.cid,e.bytes),l.set(e.cid.toString(),e);for(const e of r.removals)h.set(e.cid.toString(),e)}const f=await put(e,u,r,n,o);for(const e of f.additions)i.putSync(e.cid,e.bytes),l.set(e.cid.toString(),e);for(const e of f.removals)h.set(e.cid.toString(),e);const p={type:"put",root:f.root,key:r,value:n},y=await EventBlock.create(p,t);i.putSync(y.cid,y.bytes),t=await advance(e,t,y.cid);const m=f.root.toString();for(const e of h.keys())l.has(e)&&e!==m&&(l.delete(e),h.delete(e));return{root:f.root,additions:[...l.values()],removals:[...h.values()],head:t,event:y}}async function root(e,t){if(!t.length)throw new Error("cannot determine root of headless clock");const r=new MemoryBlockstore;e=new MultiBlockFetcher(r,e);const n=new EventFetcher(e);if(1===t.length){const e=await n.get(t[0]),{root:r}=e.value.data;return{root:r,additions:[],removals:[]}}const o=await findCommonAncestor(n,t);if(!o)throw new Error("failed to find common ancestor event");const i=await n.get(o);let{root:s}=i.value.data;const a=await findSortedEvents(n,t,o),c=new Map,u=new Map;for(const{value:t}of a){if(!["put","del"].includes(t.data.type))throw new Error(`unknown event type: ${t.data.type}`);const n="put"===t.data.type?await put(e,s,t.data.key,t.data.value):await del(e,s,t.data.key);s=n.root;for(const e of n.additions)r.putSync(e.cid,e.bytes),c.set(e.cid.toString(),e);for(const e of n.removals)u.set(e.cid.toString(),e)}const d=s.toString();for(const e of u.keys())c.has(e)&&e!==d&&(c.delete(e),u.delete(e));return{root:s,additions:[...c.values()],removals:[...u.values()]}}async function get4(e,t,r){if(!t.length)return;const n=await root(e,t);return n.additions.length&&(e=new MultiBlockFetcher(new MemoryBlockstore(n.additions),e)),get3(e,n.root,r)}async function*entries2(e,t,r){if(!t.length)return;const n=await root(e,t);n.additions.length&&(e=new MultiBlockFetcher(new MemoryBlockstore(n.additions),e)),yield*entries(e,n.root,r)}async function findCommonAncestor(e,t){if(!t.length)return;const r=t.map((e=>[e]));for(;;){let t=!1;for(const n of r){const o=await findAncestorCandidate(e,n[n.length-1]);if(!o)continue;t=!0,n.push(o);const i=findCommonString(r);if(i)return i}if(!t)return}}async function findAncestorCandidate(e,t){const{value:r}=await e.get(t);return r.parents.length?1===r.parents.length?r.parents[0]:findCommonAncestor(e,r.parents):t}function findCommonString(e){e=e.map((e=>[...e]));for(const t of e)for(const r of t){let n=!0;for(const o of e)if(t!==o&&(n=o.some((e=>String(e)===String(r))),!n))break;if(n)return r}}async function findSortedEvents(e,t,r){if(1===t.length&&String(t[0])===String(r))return[];const n=new Map,o=await Promise.all(t.map((t=>findEvents(e,t,r))));for(const e of o)for(const{event:t,depth:r}of e){const e=n.get(t.cid.toString());e?e.weight+=r:n.set(t.cid.toString(),{event:t,weight:r})}const i=new Map;for(const{event:e,weight:t}of n.values()){const r=i.get(t);r?r.push(e):i.set(t,[e])}return Array.from(i).sort(((e,t)=>t[0]-e[0])).flatMap((([,e])=>e.sort(((e,t)=>String(e.cid)<String(t.cid)?-1:1))))}async function findEvents(e,t,r,n=0){const o=await e.get(t),i=[{event:o,depth:n}],{parents:s}=o.value;if(1===s.length&&String(s[0])===String(r))return i;const a=await Promise.all(s.map((t=>findEvents(e,t,r,n+1))));return i.concat(...a)}var codec_exports={};__export(codec_exports,{DEFAULT_DIRECTORY_MODE:()=>DEFAULT_DIRECTORY_MODE,DEFAULT_FILE_MODE:()=>DEFAULT_FILE_MODE,NodeType:()=>NodeType,code:()=>code5,createAdvancedFile:()=>createAdvancedFile,createComplexFile:()=>createComplexFile,createDirectoryShard:()=>createDirectoryShard,createEmptyFile:()=>createEmptyFile,createFileChunk:()=>createFileChunk,createFileShard:()=>createFileShard,createFlatDirectory:()=>createFlatDirectory,createRaw:()=>createRaw,createShardedDirectory:()=>createShardedDirectory,createSimpleFile:()=>createSimpleFile,createSymlink:()=>createSymlink,cumulativeContentByteLength:()=>cumulativeContentByteLength,cumulativeDagByteLength:()=>cumulativeDagByteLength,decode:()=>decode19,decodeMetadata:()=>decodeMetadata,encode:()=>encode15,encodeAdvancedFile:()=>encodeAdvancedFile,encodeComplexFile:()=>encodeComplexFile,encodeDirectory:()=>encodeDirectory,encodeDirectoryMetadata:()=>encodeDirectoryMetadata,encodeFile:()=>encodeFile,encodeFileChunk:()=>encodeFileChunk,encodeFileShard:()=>encodeFileShard,encodeHAMTShard:()=>encodeHAMTShard,encodeLink:()=>encodeLink2,encodeMetadata:()=>encodeMetadata,encodeMode:()=>encodeMode,encodeRaw:()=>encodeRaw,encodeSimpleFile:()=>encodeSimpleFile,encodeSymlink:()=>encodeSymlink,filesize:()=>filesize,matchFile:()=>matchFile,name:()=>name4});var textDecoder3=new TextDecoder;function decodeVarint2(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const o=e[t++];if(r+=n<28?(127&o)<<n:(127&o)*2**n,o<128)break}return[r,t]}function decodeBytes(e,t){let r;[r,t]=decodeVarint2(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function decodeKey(e,t){let r;return[r,t]=decodeVarint2(e,t),[7&r,r>>3,t]}function decodeLink(e){const t={},r=e.length;let n=0;for(;n<r;){let r,o;if([r,o,n]=decodeKey(e,n),1===o){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=decodeBytes(e,n)}else if(2===o){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=decodeBytes(e,n),t.Name=textDecoder3.decode(o)}else{if(3!==o)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=decodeVarint2(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function decodeNode(e){const t=e.length;let r,n,o=0,i=!1;for(;o<t;){let t,s;if([t,s,o]=decodeKey(e,o),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===s){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,o]=decodeBytes(e,o),r&&(i=!0)}else{if(2!==s)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${s}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,o]=decodeBytes(e,o),r.push(decodeLink(t))}}}if(o>t)throw new Error("protobuf: (PBNode) unexpected end of data");const s={};return n&&(s.Data=n),s.Links=r||[],s}var textEncoder3=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=encodeVarint(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){const n=textEncoder3.encode(e.Name);r-=n.length,t.set(n,r),r=encodeVarint(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=encodeVarint(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function encodeNode(e){const t=sizeNode(e),r=new Uint8Array(t);let n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=encodeVarint(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){const o=encodeLink(e.Links[t],r.subarray(0,n));n-=o,n=encodeVarint(r,n,o)-1,r[n]=18}return r}function sizeLink(e){let t=0;if(e.Hash){const r=e.Hash.length;t+=1+r+sov(r)}if("string"==typeof e.Name){const r=textEncoder3.encode(e.Name).length;t+=1+r+sov(r)}return"number"==typeof e.Tsize&&(t+=1+sov(e.Tsize)),t}function sizeNode(e){let t=0;if(e.Data){const r=e.Data.length;t+=1+r+sov(r)}if(e.Links)for(const r of e.Links){const e=sizeLink(r);t+=1+e+sov(e)}return t}function encodeVarint(e,t,r){const n=t-=sov(r);for(;r>=maxUInt32;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function sov(e){return e%2==0&&e++,Math.floor((len64(e)+6)/7)}function len64(e){let t=0;return e>=maxInt32&&(e=Math.floor(e/maxInt32),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+len8tab[e]}var len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder4=new TextEncoder;function linkComparator(e,t){if(e===t)return 0;const r=e.Name?textEncoder4.encode(e.Name):[],n=t.Name?textEncoder4.encode(t.Name):[];let o=r.length,i=n.length;for(let e=0,t=Math.min(o,i);e<t;++e)if(r[e]!==n[e]){o=r[e],i=n[e];break}return o<i?-1:i<o?1:0}function hasOnlyProperties(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function asLink(e){if("object"==typeof e.asCID){const t=CID.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let r=CID.asCID(e.Hash);try{r||("string"==typeof e.Hash?r=CID.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=CID.decode(e.Hash)))}catch(e){throw new TypeError(`Invalid DAG-PB form: ${e.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function prepare(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=textEncoder4.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(asLink),t.Links.sort(linkComparator)}else t.Links=[];return t}function validate(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(e,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){const r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(r,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==r.Hash||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize){if("number"!=typeof r.Tsize||r.Tsize%1!=0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===linkComparator(r,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var code4=112;function encode14(e){validate(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),encodeNode(t)}function decode18(e){const t=decodeNode(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=CID.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}var import_minimal=__toESM(require_minimal2(),1),$Reader=import_minimal.default.Reader,$Writer=import_minimal.default.Writer,$util=import_minimal.default.util,$root=import_minimal.default.roots.unixfs||(import_minimal.default.roots.unixfs={}),Data=$root.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util.newBuffer([]),e.prototype.filesize=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=$util.emptyArray,e.prototype.hashType=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.fanout=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=$Writer.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var r=0;r<e.blocksizes.length;++r)t.uint32(32).uint64(e.blocksizes[r]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&$root.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Data;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;case 3:n.filesize=e.uint64();break;case 4:if(n.blocksizes&&n.blocksizes.length||(n.blocksizes=[]),2==(7&o))for(var i=e.uint32()+e.pos;e.pos<i;)n.blocksizes.push(e.uint64());else n.blocksizes.push(e.uint64());break;case 5:n.hashType=e.uint64();break;case 6:n.fanout=e.uint64();break;case 7:n.mode=e.uint32();break;case 8:n.mtime=$root.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&o)}}if(!n.hasOwnProperty("Type"))throw $util.ProtocolError("missing required 'Type'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root.Data)return e;var t=new $root.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?$util.base64.decode(e.Data,t.Data=$util.newBuffer($util.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&($util.Long?(t.filesize=$util.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new $util.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var r=0;r<e.blocksizes.length;++r)$util.Long?(t.blocksizes[r]=$util.Long.fromValue(e.blocksizes[r])).unsigned=!0:"string"==typeof e.blocksizes[r]?t.blocksizes[r]=parseInt(e.blocksizes[r],10):"number"==typeof e.blocksizes[r]?t.blocksizes[r]=e.blocksizes[r]:"object"==typeof e.blocksizes[r]&&(t.blocksizes[r]=new $util.LongBits(e.blocksizes[r].low>>>0,e.blocksizes[r].high>>>0).toNumber(!0))}if(null!=e.hashType&&($util.Long?(t.hashType=$util.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new $util.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&($util.Long?(t.fanout=$util.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new $util.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=$root.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.blocksizes=[]),t.defaults){if(r.Type=t.enums===String?"Raw":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util.newBuffer(r.Data))),$util.Long){var n=new $util.Long(0,0,!0);r.filesize=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.filesize=t.longs===String?"0":0;$util.Long?(n=new $util.Long(0,0,!0),r.hashType=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.hashType=t.longs===String?"0":0,$util.Long?(n=new $util.Long(0,0,!0),r.fanout=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.fanout=t.longs===String?"0":0,r.mode=0,r.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?r.filesize=t.longs===String?String(e.filesize):e.filesize:r.filesize=t.longs===String?$util.Long.prototype.toString.call(e.filesize):t.longs===Number?new $util.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){r.blocksizes=[];for(var o=0;o<e.blocksizes.length;++o)"number"==typeof e.blocksizes[o]?r.blocksizes[o]=t.longs===String?String(e.blocksizes[o]):e.blocksizes[o]:r.blocksizes[o]=t.longs===String?$util.Long.prototype.toString.call(e.blocksizes[o]):t.longs===Number?new $util.LongBits(e.blocksizes[o].low>>>0,e.blocksizes[o].high>>>0).toNumber(!0):e.blocksizes[o]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?r.hashType=t.longs===String?String(e.hashType):e.hashType:r.hashType=t.longs===String?$util.Long.prototype.toString.call(e.hashType):t.longs===Number?new $util.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?r.fanout=t.longs===String?String(e.fanout):e.fanout:r.fanout=t.longs===String?$util.Long.prototype.toString.call(e.fanout):t.longs===Number?new $util.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(r.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(r.mtime=$root.UnixTime.toObject(e.mtime,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,import_minimal.default.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),UnixTime=$root.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Seconds=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=$Writer.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.UnixTime;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&o)}}if(!n.hasOwnProperty("Seconds"))throw $util.ProtocolError("missing required 'Seconds'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root.UnixTime)return e;var t=new $root.UnixTime;return null!=e.Seconds&&($util.Long?(t.Seconds=$util.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new $util.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if($util.Long){var n=new $util.Long(0,0,!1);r.Seconds=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.Seconds=t.longs===String?"0":0;r.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?r.Seconds=t.longs===String?String(e.Seconds):e.Seconds:r.Seconds=t.longs===String?$util.Long.prototype.toString.call(e.Seconds):t.longs===Number?new $util.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(r.FractionalNanoseconds=e.FractionalNanoseconds),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,import_minimal.default.util.toJSONOptions)},e})(),Metadata=$root.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.Metadata;e.pos<r;){var o=e.uint32();o>>>3==1?n.MimeType=e.string():e.skipType(7&o)}return n},e.fromObject=function(e){if(e instanceof $root.Metadata)return e;var t=new $root.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(r.MimeType=e.MimeType),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,import_minimal.default.util.toJSONOptions)},e})(),NodeType=Data.DataType,EMPTY=Object.freeze([]),EMPTY_BUFFER=new Uint8Array(0),BLANK=Object.freeze({}),DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8),code5=code4,name4="UnixFS",encodePB=(e,t)=>(Object(globalThis).debug&&console.log({data:e,links:t}),encode14(prepare({Data:Data.encode(e).finish(),Links:t}))),createRaw=e=>({type:NodeType.Raw,content:e}),createEmptyFile=e=>createSimpleFile(EMPTY_BUFFER,e),createSimpleFile=(e,t)=>({type:NodeType.File,layout:"simple",content:e,metadata:decodeMetadata(t)}),createFileChunk=e=>({type:NodeType.File,layout:"simple",content:e}),createAdvancedFile=(e,t)=>({type:NodeType.File,layout:"advanced",parts:e,metadata:decodeMetadata(t)}),createFileShard=e=>({type:NodeType.File,layout:"advanced",parts:e}),createComplexFile=(e,t,r)=>({type:NodeType.File,layout:"complex",content:e,parts:t,metadata:decodeMetadata(r)}),createFlatDirectory=(e,t)=>({type:NodeType.Directory,metadata:decodeMetadata(t),entries:e}),createShardedDirectory=(e,t,r,n,o=BLANK)=>({type:NodeType.HAMTShard,bitfield:t,fanout:readFanout(r),hashType:readInt(n),entries:e,metadata:decodeMetadata(o)}),createDirectoryShard=(e,t,r,n)=>({type:NodeType.HAMTShard,bitfield:t,fanout:readFanout(r),hashType:readInt(n),entries:e}),encodeRaw=e=>encodePB({Type:NodeType.Raw,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:EMPTY},[]),encodeFile=(e,t=!1)=>{const r=t?BLANK:Object(e).metadata;switch(e.layout){case"simple":return encodeSimpleFile(e.content,r);case"advanced":return encodeAdvancedFile(e.parts,r);case"complex":return encodeComplexFile(e.content,e.parts,r);default:throw new TypeError(`File with unknown layout "${Object(e).layout}" was passed`)}},encodeFileChunk=e=>encodeSimpleFile(e,BLANK),encodeFileShard=e=>encodePB({Type:NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e)},e.map(encodeLink2)),encodeAdvancedFile=(e,t=BLANK)=>encodePB({Type:NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e),...encodeMetadata(t)},e.map(encodeLink2)),encodeLink2=e=>({Name:"",Tsize:e.dagByteLength,Hash:e.cid}),encodeSimpleFile=(e,t=BLANK)=>encodePB({Type:NodeType.File,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:[],...encodeMetadata(t)},[]),encodeComplexFile=(e,t,r=BLANK)=>encodePB({Type:NodeType.File,Data:e,filesize:e.byteLength+cumulativeContentByteLength(t),blocksizes:t.map(contentByteLength)},t.map(encodeLink2)),encodeDirectory=e=>encodePB({Type:e.type,...encodeDirectoryMetadata(e.metadata||BLANK)},e.entries.map(encodeNamedLink)),encodeHAMTShard=({bitfield:e,fanout:t,hashType:r,entries:n,metadata:o=BLANK})=>encodePB({Type:NodeType.HAMTShard,Data:e.byteLength>0?e:void 0,fanout:readFanout(t),hashType:readInt(r),...encodeDirectoryMetadata(o)},n.map(encodeNamedLink)),readFanout=e=>{if(Math.log2(e)%1==0)return e;throw new TypeError(`Expected hamt size to be a power of two instead got ${e}`)},readInt=e=>{if(Number.isInteger(e))return e;throw new TypeError(`Expected an integer value instead got ${e}`)},createSymlink=(e,t=BLANK)=>({type:NodeType.Symlink,content:e,metadata:decodeMetadata(t)}),encodeSymlink=(e,t=!1)=>{const r=t?BLANK:Object(e).metadata;return encodePB({Type:NodeType.Symlink,Data:e.content,...encodeMetadata(r||BLANK)},[])},encode15=(e,t=!0)=>{switch(e.type){case NodeType.Raw:return encodeRaw(e.content);case NodeType.File:return encodeFile(e);case NodeType.Directory:return encodeDirectory(e);case NodeType.HAMTShard:return encodeHAMTShard(e);case NodeType.Symlink:return encodeSymlink(e);default:throw new Error(`Unknown node type ${Object(e).type}`)}},decode19=e=>{const t=decode18(e),r=Data.decode(t.Data),{Type:n,Data:o,mtime:i,mode:s,blocksizes:a,...c}=Data.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),u={...s&&{mode:s},...decodeMtime(i)},d=t.Links;switch(r.Type){case NodeType.Raw:return createRaw(o);case NodeType.File:return 0===d.length?new SimpleFileView(o,u):0===o.byteLength?new AdvancedFileView(decodeFileLinks(c.blocksizes,d),u):new ComplexFileView(o,decodeFileLinks(c.blocksizes,d),u);case NodeType.Directory:return createFlatDirectory(decodeDirectoryLinks(d),u);case NodeType.HAMTShard:return createShardedDirectory(decodeDirectoryLinks(d),o||EMPTY_BUFFER,c.fanout,c.hashType,u);case NodeType.Symlink:return createSymlink(o,u);default:throw new TypeError(`Unsupported node type ${r.Type}`)}},decodeMtime=e=>null==e?void 0:{mtime:{secs:e.Seconds,nsecs:e.FractionalNanoseconds||0}},decodeFileLinks=(e,t)=>{const r=[],n=e.length;for(;0<n;)r.push({cid:t[0].Hash,dagByteLength:t[0].Tsize||0,contentByteLength:e[0]});return r},decodeDirectoryLinks=e=>e.map((e=>({cid:e.Hash,name:e.Name||"",dagByteLength:e.Tsize||0}))),cumulativeContentByteLength=e=>e.reduce(((e,t)=>e+t.contentByteLength),0),cumulativeDagByteLength=(e,t)=>t.reduce(((e,t)=>e+t.dagByteLength),e.byteLength),contentByteLength=e=>e.contentByteLength,encodeNamedLink=({name:e,dagByteLength:t,cid:r})=>({Name:e,Tsize:t,Hash:r}),encodeDirectoryMetadata=e=>encodeMetadata(e,DEFAULT_DIRECTORY_MODE),encodeMetadata=({mode:e,mtime:t},r=DEFAULT_FILE_MODE)=>({mode:null!=e?encodeMode(e,r):void 0,mtime:null!=t?encodeMTime(t):void 0}),decodeMetadata=e=>null==e?BLANK:{...null==e.mode?void 0:{mode:decodeMode(e.mode)},...null==e.mtime?void 0:{mtime:e.mtime}},encodeMTime=e=>null==e?void 0:0!==e.nsecs?{Seconds:e.secs,FractionalNanoseconds:e.nsecs}:{Seconds:e.secs},encodeMode=(e,t)=>{const r=null==e?void 0:decodeMode(e);return r===t||null==r?void 0:r},decodeMode=e=>4095&e|4294963200&e,matchFile=({content:e=EMPTY_BUFFER,parts:t=EMPTY,metadata:r=BLANK,...n})=>0===t.length?new SimpleFileView(e,r):0===e.byteLength?new AdvancedFileView(t,r):new ComplexFileView(e,t,r),SimpleFileView=class{constructor(e,t){this.content=e,this.metadata=t,this.layout="simple",this.type=NodeType.File}get filesize(){return this.content.byteLength}encode(){return encodeSimpleFile(this.content,this.metadata)}},AdvancedFileView=class{constructor(e,t){this.parts=e,this.metadata=t}get layout(){return"advanced"}get type(){return NodeType.File}get fileSize(){return cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeAdvancedFile(this.parts,this.metadata)}},ComplexFileView=class{constructor(e,t,r){this.content=e,this.parts=t,this.metadata=r}get layout(){return"complex"}get type(){return NodeType.File}get fileSize(){return this.content.byteLength+cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeComplexFile(this.content,this.parts,this.metadata)}},filesize=e=>{switch(e.type){case NodeType.Raw:case NodeType.Symlink:return e.content.byteLength;case NodeType.File:switch(e.layout){case"simple":return e.content.byteLength;case"advanced":return cumulativeContentByteLength(e.parts);case"complex":return e.content.byteLength+cumulativeContentByteLength(e.parts)}default:return 0}},effect=function*(e){const t=yield*e;yield*send(t)};function*current(){return yield CURRENT}var suspend=function*(){yield SUSPEND},wait=function*(e){const t=yield*current();if(isAsync(e)){let r,n=!1;if(e.then((e=>{n=!1,r=e,enqueue(t)}),(e=>{n=!0,r=e,enqueue(t)})),yield*suspend(),n)throw r;return r}return main(wake(t)),yield*suspend(),e};function*wake(e){enqueue(e)}var isAsync=e=>null!=e&&"function"==typeof e.then,send=function*(e){yield e},listen=function*(e){const t=[];for(const r of Object.entries(e)){const[e,n]=r;n!==NONE&&t.push(yield*fork(tag(n,e)))}yield*group(t)},effects=e=>e.length>0?batch(e.map(effect)):NONE;function*batch(e){const t=[];for(const r of e)t.push(yield*fork(r));yield*group(t)}var tag=(e,t)=>e===NONE?NONE:e instanceof Tagger?new Tagger([...e.tags,t],e.source):new Tagger([t],e),Tagger=class{constructor(e,t){this.tags=e,this.source=t,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case SUSPEND:case CURRENT:return e;default:{const t=e;let{value:r}=t;for(const e of this.tags)r=withTag(e,r);return t.value=r,t}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}},none=()=>NONE,withTag=(e,t)=>({type:e,[e]:t}),CURRENT=Symbol("current"),SUSPEND=Symbol("suspend"),Group=class e{static of(e){return e.group||MAIN}static enqueue(e,t){e.group=t,t.stack.active.push(e)}constructor(t,r=[],n=new Set,o=new Stack(r,n)){this.driver=t,this.parent=e.of(t),this.stack=o,this.id=++ID}},Main=class{constructor(){this.status=IDLE,this.stack=new Stack,this.id=0}},Stack=class{constructor(e=[],t=new Set){this.active=e,this.idle=t}static size({active:e,idle:t}){return e.length+t.size}},main=e=>enqueue(e[Symbol.iterator]()),enqueue=e=>{let t=Group.of(e);for(t.stack.active.push(e),t.stack.idle.delete(e);t.parent;){const{idle:e,active:r}=t.parent.stack;if(!e.has(t.driver))break;e.delete(t.driver),r.push(t.driver),t=t.parent}if(MAIN.status===IDLE)for(MAIN.status=ACTIVE;;)try{for(const e of step(MAIN));MAIN.status=IDLE;break}catch(e){MAIN.stack.active.shift()}},resume=e=>enqueue(e),step=function*(e){const{active:t}=e.stack;let r=t[0];for(e.stack.idle.delete(r);r;){let n=INIT;e:for(;!n.done&&r===t[0];){const t=n.value;switch(t){case SUSPEND:e.stack.idle.add(r);break e;case CURRENT:n=r.next(r);break;default:n=r.next(yield t)}}t.shift(),r=t[0],e.stack.idle.delete(r)}},fork=(e,t)=>new Fork(e,t),exit=(e,t)=>conclude(e,{ok:!0,value:t}),abort=(e,t)=>conclude(e,{ok:!1,error:t});function*conclude(e,t){try{const r=e,n=t.ok?r.return(t.value):r.throw(t.error);if(!n.done)if(n.value===SUSPEND){const{idle:e}=Group.of(r).stack;e.add(r)}else enqueue(r)}catch(e){}}function*group(e){if(0===e.length)return;const t=yield*current(),r=new Group(t);let n=null;for(const t of e){const{result:e}=t;e?e.ok||n||(n=e):move(t,r)}try{if(n)throw n.error;for(;yield*step(r),Stack.size(r.stack)>0;)yield*suspend()}catch(e){for(const t of r.stack.active)yield*abort(t,e);for(const t of r.stack.idle)yield*abort(t,e),enqueue(t);throw e}}var move=(e,t)=>{const r=Group.of(e);if(r!==t){const{active:n,idle:o}=r.stack,i=t.stack;if(e.group=t,o.has(e))o.delete(e),i.idle.add(e);else{const t=n.indexOf(e);t>=0&&(n.splice(t,1),i.active.push(e))}}};function*join(e){e.status===IDLE&&(yield*e),e.result||(yield*group([e]));const t=e.result;if(t.ok)return t.value;throw t.error}var Future=class{constructor(e){this.handler=e,this.result}get promise(){const{result:e}=this,t=null==e?new Promise(((e,t)=>{this.handler.onsuccess=e,this.handler.onfailure=t})):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:t}),t}then(e,t){return this.activate().promise.then(e,t)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}},Fork=class extends Future{constructor(e,t=BLANK2,r={},n=INIT){super(r),this.id=++ID,this.name=t.name||"",this.task=e,this.state=n,this.status=IDLE,this.result,this.handler=r,this.controller}*resume(){resume(this)}join(){return join(this)}abort(e){return abort(this,e)}exit(e){return exit(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=ACTIVE,enqueue(this),this}panic(e){this.result={ok:!1,error:e},this.status=FINISHED;const{handler:t}=this;throw t.onfailure&&t.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=FINISHED;const{handler:t}=this;t.onsuccess&&t.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(e){return this.panic(e)}}return(e){try{return this.step(this.controller.return(e))}catch(e){return this.panic(e)}}throw(e){try{return this.step(this.controller.throw(e))}catch(e){return this.panic(e)}}},loop=function*(e,t){const r=yield*current(),n=new Group(r);for(Group.enqueue(e[Symbol.iterator](),n);;){for(const e of step(n))Group.enqueue(t(e)[Symbol.iterator](),n);if(!(Stack.size(n.stack)>0))break;yield*suspend()}},ID=0,IDLE="idle",ACTIVE="active",FINISHED="finished",INIT={done:!1,value:CURRENT},BLANK2={},NONE=function*(){}(),MAIN=new Main;function Indexed(){}Object.defineProperties(Indexed,{prototype:{value:new Proxy(Object.prototype,{get:(e,t,r)=>"symbol"==typeof t?Reflect.get(e,t,r):r.get(t)})}});var empty3=()=>new BufferView,slice3=(e,t=0,r=e.byteLength)=>{const n=[],o=t<0?e.byteLength-t:t,i=r<0?e.byteLength-r:r;if(0===o&&i>=e.byteLength)return e;if(o>i||o>e.byteLength||i<=0)return empty3();let s=0,a=0;for(const t of e.segments){const e=a+t.byteLength;if(0===s){if(i<=e){const e=t.subarray(o-a,i-a);n.push(e),s=e.byteLength;break}if(o<e){const e=o===a?t:t.subarray(o-a);n.push(e),s=e.byteLength}}else{if(i<=e){const r=i===e?t:t.subarray(0,i-a);n.push(r),s+=r.byteLength;break}n.push(t),s+=t.byteLength}a=e}return new BufferView(n,e.byteOffset+o,s)},push=(e,t)=>t.byteLength>0?(e.segments.push(t),new BufferView(e.segments,e.byteOffset,e.byteLength+t.byteLength)):e,get5=(e,t)=>{if(t<e.byteLength){let r=0;for(const n of e.segments){if(t<r+n.byteLength)return n[t-r];r+=n.byteLength}}},copyTo=(e,t,r)=>{let n=r;for(const r of e.segments)t.set(r,n),n+=r.byteLength;return t};function*iterate(e){for(const t of e.segments)yield*t}var BufferView=class extends Indexed{constructor(e=[],t=0,r=0){super(),this.segments=e,this.byteLength=r,this.length=r,this.byteOffset=t}[Symbol.iterator](){return iterate(this)}slice(e,t){return slice3(this,e,t)}subarray(e,t){return slice3(this,e,t)}push(e){return push(this,e)}get(e){return get5(this,e)}copyTo(e,t){return copyTo(this,e,t)}},panic=e=>{throw new Error(e)},unreachable=(e,t,...r)=>panic(String.raw(e,JSON.stringify(t),...r)),EMPTY_BUFFER2=new Uint8Array(0),EMPTY2=[],open=e=>({config:e,buffer:empty3()}),write=(e,t)=>t.byteLength>0?split(e.config,e.buffer.push(t),!1):{...e,chunks:EMPTY2},close2=e=>split(e.config,e.buffer,!0),split=(e,t,r)=>{const n=e.chunker,o=[];let i=0;for(const e of n.cut(n.context,t,r))if(e>0){const r=t.subarray(i,i+e);o.push(r),i+=e}return{config:e,chunks:o,buffer:t.subarray(i)}},mutable=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:EMPTY3}),addNodes=(e,t)=>{let r=patch(t,{});for(const t of e){const{ready:e,has:n,wants:o}=collect(t.children,r.links);r=0===o.length?patch(r,{links:assign(void 0,n),linked:[{id:t.id,links:e}]}):patch(r,{needs:assign(t.id,o),nodes:{[t.id]:{children:t.children,count:o.length}}})}return r},addLink=(e,t,r)=>{const n=r.needs[e],o=r.nodes[n];if(null!=o){if(1===o.count){const{ready:i,has:s}=collect(o.children,{...r.links,[e]:t});return patch(r,{needs:{[e]:void 0},links:assign(void 0,s),nodes:{[n]:void 0},linked:[{id:n,links:i}]})}return patch(r,{needs:{[e]:void 0},links:{[e]:t},nodes:{[n]:{...o,count:o.count-1}}})}return patch(r,{links:{[e]:t}})},patch=(e,{needs:t,nodes:r,links:n,linked:o})=>{const i=e.mutable?e:{...e},s=e.mutable?BLANK3:void 0;return t&&(i.needs=patchDict(e.needs,t,s)),r&&(i.nodes=patchDict(e.nodes,r,s)),n&&(i.links=patchDict(e.links,n,s)),i.linked=o?append(e.linked||EMPTY3,o,EMPTY3):e.linked||[],i},assign=(e,t)=>{const r={};for(const n of t)r[n]=e;return r},patchDict=(e,t,r=e)=>{const n=e===r?{...e}:e;for(const e of Object.entries(t)){const[t,r]=e;null==r?delete n[t]:n[t]=r}return n},append=(e,t,r=e)=>{if(e===r)return[...e,...t];for(const r of t)e.push(r);return e},collect=(e,t)=>{const r=[],n=[],o=[];for(const i of e){const e=t[i];e?(r.push(i),o.push(e)):n.push(i)}return{has:r,wants:n,ready:o}},EMPTY3=Object.freeze([]),BLANK3=Object.freeze({}),update=(e,t)=>{switch(e.type){case"write":return write2(t,e.bytes);case"link":return link(t,e.link);case"block":case"end":return{state:t,effect:none()};case"close":return close3(t);default:return unreachable`File Writer got unknown message ${e}`}},init=(e,t,r)=>({status:"open",metadata:t,config:r,writer:e,chunker:open({chunker:r.chunker}),layout:r.fileLayout.open(),nodeQueue:mutable()}),write2=(e,t)=>{if("open"===e.status){const{chunks:r,...n}=write(e.chunker,t),{nodes:o,leaves:i,layout:s}=e.config.fileLayout.write(e.layout,r),{linked:a,...c}=addNodes(o,e.nodeQueue),u=[...encodeLeaves(i,e.config),...encodeBranches(a,e.config)];return{state:{...e,chunker:n,layout:s,nodeQueue:c},effect:listen({link:effects(u)})}}return panic("Unable to perform write on closed file")},link=(e,{id:t,link:r,block:n})=>{let{linked:o,...i}=addLink(t,r,e.nodeQueue);const s=encodeBranches(o,e.config),a="closed"===e.status&&t===e.rootID?{...e,status:"linked",link:r,nodeQueue:i}:{...e,nodeQueue:i},c="closed"===e.status&&t===e.rootID&&e.end?e.end.resume():none();return{state:a,effect:listen({link:effects(s),block:writeBlock(e.writer,n),end:c})}},close3=e=>{if("open"===e.status){const{chunks:t}=close2(e.chunker),{layout:r,...n}=e.config.fileLayout.write(e.layout,t),{root:o,...i}=e.config.fileLayout.close(r,e.metadata),[s,a]=isLeafNode(o)?[[...n.nodes,...i.nodes],[...n.leaves,...i.leaves,o]]:[[...n.nodes,...i.nodes,o],[...n.leaves,...i.leaves]],{linked:c,...u}=addNodes(s,e.nodeQueue),d=[...encodeLeaves(a,e.config),...encodeBranches(c,e.config)],l=fork(suspend());return{state:{...e,chunker:null,layout:null,rootID:o.id,status:"closed",end:l,nodeQueue:u},effect:listen({link:effects(d),end:join(l)})}}return{state:e,effect:none()}},encodeLeaves=(e,t)=>e.map((e=>encodeLeaf(t,e,t.fileChunkEncoder))),encodeLeaf=function*({hasher:e,linker:t},{id:r,content:n},o){const i=o.encode(n?asUint8Array(n):EMPTY_BUFFER2),s=yield*wait(e.digest(i)),a=t.createLink(o.code,s);return{id:r,block:{cid:a,bytes:i},link:{cid:a,contentByteLength:n?n.byteLength:0,dagByteLength:i.byteLength}}},encodeBranches=(e,t)=>e.map((e=>encodeBranch(t,e))),encodeBranch=function*(e,{id:t,links:r},n){const o=e.fileEncoder.encode({type:NodeType.File,layout:"advanced",parts:r,metadata:n}),i=yield*wait(Promise.resolve(e.hasher.digest(o))),s=e.linker.createLink(e.fileEncoder.code,i);return{id:t,block:{bytes:o,cid:s},link:{cid:s,contentByteLength:cumulativeContentByteLength(r),dagByteLength:cumulativeDagByteLength(o,r)}}},writeBlock=function*(e,t){(e.desiredSize||0)<=0&&(yield*wait(e.ready)),e.write(t)},asUint8Array=e=>e instanceof Uint8Array?e:e.copyTo(new Uint8Array(e.byteLength),0),isLeafNode=e=>null==e.children,fixed_exports={};__export(fixed_exports,{context:()=>context,cut:()=>cut,name:()=>name5,type:()=>type,withMaxChunkSize:()=>withMaxChunkSize});var name5="fixed",context={maxChunkSize:262144},type="Stateless",withMaxChunkSize=e=>({type:"Stateless",context:{maxChunkSize:e},name:name5,cut}),cut=({maxChunkSize:e},{byteLength:t},r)=>{const n=t/e|0,o=new Array(n).fill(e),i=r?t-n*e:0;return i>0&&o.push(i),o},Node3=class{constructor(e,t,r){this.id=e,this.children=t,this.metadata=r}},withWidth=e=>({open:()=>open2({width:e}),write:write3,close:close4}),defaults2={width:174},open2=({width:e}=defaults2)=>({width:e,head:null,leafIndex:[],nodeIndex:[],lastID:0}),write3=(e,t)=>{if(0===t.length)return{layout:e,nodes:EMPTY4,leaves:EMPTY4};{let{lastID:r}=e;const[n,o]=e.head?[null,(t.unshift(e.head),t)]:1===t.length&&0===e.leafIndex.length?[t[0],EMPTY4]:[null,t];if(0===o.length)return{layout:{...e,head:n},nodes:EMPTY4,leaves:EMPTY4};{const t=[...e.leafIndex],i=[];for(const e of o){const n={id:++r,content:e};i.push(n),t.push(n.id)}return t.length>=e.width?flush({...e,leafIndex:t,head:n,lastID:r},i):{layout:{...e,head:n,leafIndex:t,lastID:r},leaves:i,nodes:EMPTY4}}}},flush=(e,t=EMPTY4,r=[],n=!1)=>{let{lastID:o}=e;const i=e.nodeIndex.map((e=>[...e])),s=[...e.leafIndex],{width:a}=e;for(;s.length>=a||s.length>0&&n;){grow(i,1);const e=new Node3(++o,s.splice(0,a));i[0].push(e.id),r.push(e)}let c=0;for(;c<i.length;){const e=i[c];for(c++;e.length>=a||e.length>0&&n&&c<i.length;){const t=new Node3(++o,e.splice(0,a));grow(i,c+1),i[c].push(t.id),r.push(t)}}return{layout:{...e,lastID:o,leafIndex:s,nodeIndex:i},leaves:t,nodes:r}},close4=(e,t)=>{const r=e;if(e.head)return{root:{id:1,content:e.head,metadata:t},leaves:EMPTY4,nodes:EMPTY4};if(0===e.leafIndex.length)return{root:{id:1,metadata:t},leaves:EMPTY4,nodes:EMPTY4};{const{nodes:e,layout:n}=flush(r,EMPTY4,[],!0),{nodeIndex:o}=n,i=o[o.length-1];if(1===i.length){const t=e[e.length-1];return e.length=e.length-1,{root:t,nodes:e,leaves:EMPTY4}}return{root:new Node3(n.lastID+1,i,t),nodes:e,leaves:EMPTY4}}},grow=(e,t)=>{for(;e.length<t;)e.push([]);return e},EMPTY4=[],defaults3=()=>({chunker:fixed_exports,fileChunkEncoder:UnixFSLeaf,smallFileEncoder:UnixFSLeaf,fileEncoder:codec_exports,fileLayout:withWidth(174),hasher:sha2562,linker:{createLink:CID.createV1}}),configure=e=>({...defaults3(),...e}),UnixFSLeaf={code:code5,name:name4,encode:encodeFileChunk},create9=({writer:e,metadata:t={},settings:r=defaults3()})=>new FileWriterView(init(e,t,configure(r))),write4=async(e,t)=>(await perform(e,send({type:"write",bytes:t})),e),close5=async(e,{releaseLock:t=!1,closeWriter:r=!1}={})=>{await perform(e,send({type:"close"}));const{state:n}=e;if("linked"===n.status)return r?await e.state.writer.close():t&&e.state.writer.releaseLock(),n.link;panic(`Expected writer to be in 'linked' state after close, but it is in "${n.status}" instead`)},perform=(e,t)=>fork(loop(t,(t=>{const{state:r,effect:n}=update(t,e.state);return e.state=r,n}))),FileWriterView=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return write4(this,e)}close(e){return close5(this,e)}},defaults4=defaults3,create10=({writer:e,settings:t=defaults4(),metadata:r={}})=>new DirectoryWriter({writer:e,metadata:r,settings:t,entries:new Map,closed:!1}),set=(e,t,r,{overwrite:n=!1}={})=>{const o=asWritable(e.state);if(t.includes("/"))throw new Error(`Directory entry name "${t}" contains forbidden "/" character`);if(!n&&o.entries.has(t))throw new Error(`Directory already contains entry with name "${t}"`);return o.entries.set(t,r),e},remove=(e,t)=>(asWritable(e.state).entries.delete(t),e),asWritable=e=>{if(e.closed)throw new Error("Can not change written directory, but you can .fork() and make changes to it");return e},close6=async(e,{closeWriter:t=!1,releaseLock:r=!1}={})=>{const{writer:n,settings:o,metadata:i}=asWritable(e.state);e.state.closed=!0;const s=[...links3(e)],a=createFlatDirectory(s,i),c=encodeDirectory(a),u=await o.hasher.digest(c),d=o.linker.createLink(code5,u);return(n.desiredSize||0)<=0&&await n.ready,n.write({cid:d,bytes:c}),t?await n.close():r&&n.releaseLock(),{cid:d,dagByteLength:cumulativeDagByteLength(c,s)}},links3=function*({state:e}){for(const[t,{dagByteLength:r,cid:n}]of e.entries)yield{name:t,dagByteLength:r,cid:n}},fork2=({state:e},{writer:t=e.writer,metadata:r=e.metadata,settings:n=e.settings}={})=>new DirectoryWriter({writer:t,metadata:r,settings:n,entries:new Map(e.entries.entries()),closed:!1}),DirectoryWriter=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}links(){return links3(this)}set(e,t,r){return set(this,e,t,r)}remove(e){return remove(this,e)}fork(e){return fork2(this,e)}close(e){return close6(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}},Uint32_exports={};__export(Uint32_exports,{API:()=>api_exports,and:()=>and,bitCount:()=>bitCount,empty:()=>empty4,from:()=>from5,fromBytes:()=>fromBytes3,get:()=>get6,or:()=>or3,popcount:()=>popcount,set:()=>set2,size:()=>size,toBytes:()=>toBytes,unset:()=>unset});var api_exports={},empty4=(e=32)=>{if(32!==e)throw new Error(`Uint32 BitField does not support size: ${e}`);return 0},from5=(e,t)=>{let r=empty4(t);for(const t of e)r=set2(r,t);return r},size=e=>32,mask=(e,t)=>e>>>t&31,offset=(e,t)=>1<<mask(e,t),popcount=(e,t=31)=>bitCount(e&offset(t,0)-1),set2=(e,t)=>e|1<<t,unset=(e,t)=>e&(255^1<<t),get6=(e,t)=>0!=(e>>t&1),bitCount=e=>{const t=e-(e>>1&1431655765),r=(858993459&t)+(t>>2&858993459);return 16843009*(r+(r>>4)&252645135)>>24},and=(e,t)=>e&t,or3=(e,t)=>e|t,toBytes=e=>Uint8Array.of(e>>24&255,e>>16&255,e>>8&255,255&e),fromBytes3=e=>{if(4!==e.length)throw new Error(`Expected 4 bytes instead got ${e.length}`);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]},import_murmurhash3js_revisited=__toESM(require_murmurhash3js_revisited(),1),utf8=new TextEncoder,hash32=import_murmurhash3js_revisited.default.x64.hash126,configure2=({bitWidth:e=5,hash:t=hash32})=>{if(e>32)throw new RangeError(`Can not use bitWidth ${e} which exceeds the hashSize 4`);const r=4294967295>>>32-e;return{at:(t,n)=>t>>>n*e&r,from:e=>t(utf8.encode(e)),size:Math.ceil(32/e)}},BitmapIndexedNode=class{constructor(e,t,r,n,o){this.edit=e,this.config=o,this.datamap=t,this.nodemap=r,this.children=n}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return create11(this.config)}lookup(e,t,r,n){return lookup(this,e,t,r,n)}associate(e,t,r,n,o,i){return associate(this,e,t,r,n,o,i)}dissociate(e,t,r,n,o){return dissociate(this,e,t,r,n,o)}fork(e=null){return fork3(this,e)}entries(){return entries3(this)}keys(){return keys(this)}values(){return values(this)}},HashCollisionNode=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.children=r,this.config=n}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,t,r,n){return lookupCollision(this,r,n)}associate(e,t,r,n,o,i){return associateCollision(this,e,r,n,o,i)}dissociate(e,t,r,n,o){return dissociateCollision(this,e,r,n,o)}fork(e=null){return forkCollision(this,e)}entries(){return entries3(this)}keys(){return keys(this)}values(){return values(this)}},lookupCollision=(e,t,r)=>{const{children:n,count:o}=e,i=findHashCollisionNodeIndex(n,o,t);return n[i]===t?n[i+1]:r},associateCollision=(e,t,r,n,o,i)=>{const{children:s,count:a}=e,c=findHashCollisionNodeIndex(s,a,n);if(s[c]!==n){const n=e.fork(t);return i.value=!0,n.count+=1,n.children.splice(c,r,o),n}if(s[c+1]!==o){const r=e.fork(t);return r.children[c+1]=o,r}return e},dissociateCollision=(e,t,r,n,o)=>{const{children:i,count:s,config:a}=e,c=findHashCollisionNodeIndex(i,s,n);if(i[c]!==n)return e;if(o.value=!0,2===s){const e=0===c?2:0;return associate(create11(a),t,0,r,i[e],i[e+1],o)}{const r=e.fork(t);return r.children.splice(c,2),r.count-=1,r}},forkCollision=(e,t=null)=>canEdit(e.edit,t)?e:new HashCollisionNode(t,e.count,e.children.slice(),e.config),findHashCollisionNodeIndex=(e,t,r)=>{let n=0;for(;n<t&&e[n]>r;)n+=2;return n},create11=(e,t=null)=>new BitmapIndexedNode(t,e.BitField.empty(Math.pow(2,e.bitWidth)),e.BitField.empty(Math.pow(2,e.bitWidth)),[],e),get7=(e,t,r)=>lookup(e,0,e.config.Path.from(t),t,r),lookup=(e,t,r,n,o)=>{const{datamap:i,nodemap:s,config:a}=e,{Path:c,BitField:u}=a,d=c.at(r,t);if(u.get(i,d)){const t=u.popcount(i,d);return keyAt(e,t)===n?valueAt(e,t):o}return u.get(s,d)?resolveNode(e,d).lookup(t+1,r,n,o):o},set3=(e,t,r,n,o)=>associate(e,t,0,e.config.Path.from(r),r,n,o),associate=(e,t,r,n,o,i,s)=>{const{datamap:a,nodemap:c,config:u}=e,{Path:d,BitField:l}=u,h=d.at(n,r);if(l.get(a,h)){const c=l.popcount(a,h),f=keyAt(e,c);if(o===f)return valueAt(e,c)===i?e:forkAndSet(e,t,c,i);{const a=mergeTwoLeaves(u,t,r+1,d.from(f),f,valueAt(e,c),n,o,i);return s.value=!0,migrateLeafToBranch(e,t,h,a)}}if(l.get(c,h)){const a=resolveNode(e,h),c=a.associate(t,r+1,n,o,i,s);return a===c?e:copyAndSetChild(e,t,h,c)}{const r=l.popcount(a,h);s.value=!0;const n=e.fork(t);return n.datamap=l.set(a,h),n.children.splice(keyPosition(r),0,o,i),n}},remove2=(e,t,r,n)=>dissociate(e,t,0,e.config.Path.from(r),r,n),dissociate=(e,t,r,n,o,i)=>{const{datamap:s,nodemap:a,config:c}=e,{BitField:u,Path:d}=c,l=d.at(n,r);if(u.get(s,l)){const r=u.popcount(s,l);if(o===keyAt(e,r)){i.value=!0;const n=fork3(e,t);return n.datamap=u.unset(e.datamap,l),n.children.splice(keyPosition(r),2),n}return e}if(u.get(a,l)){const s=resolveNode(e,l),a=s.dissociate(t,r+1,n,o,i);return hasSingleLeaf(a)?hasSingleNode(e)?a:inlineChild(e,t,l,a):s===a?e:copyAndSetChild(e,t,l,a)}return e},entries3=function*({children:e}){let t=0;const r=e.length;for(;t<r;){const r=e[t];if("string"!=typeof r)break;{t+=1;const n=e[t];yield[r,n],t+=1}}for(;t<r;){const r=e[t];yield*r.entries(),t+=1}},fork3=(e,t)=>canEdit(e.edit,t)?e:new BitmapIndexedNode(t,e.datamap,e.nodemap,e.children.slice(),e.config),keys=function*({children:e}){let t=0;const r=e.length;for(;t<r;){const r=e[t];if("string"!=typeof r)break;yield r,t+=2}for(;t<r;){const r=e[t];yield*r.keys(),t+=1}},values=function*({children:e}){let t=0;const r=e.length;for(;t<r&&"string"==typeof e[t];)t+=1,yield e[t],t+=1;for(;t<r;){const r=e[t];yield*r.values(),t+=1}},forkAndSet=(e,t,r,n)=>{const o=e.fork(t);return o.children[valuePosition(r)]=n,o},inlineChild=(e,t,r,n)=>{const{datamap:o,nodemap:i,config:s}=e,{BitField:a}=s,c=fork3(e,t);return c.children.splice(nodePosition(e,r),1),c.children.splice(keyPosition(a.popcount(o,r)),0,n.children[0],n.children[1]),c.datamap=a.set(o,r),c.nodemap=a.unset(i,r),c},copyAndSetChild=(e,t,r,n)=>{const o=fork3(e,t);return o.children[nodePosition(e,r)]=n,o},migrateLeafToBranch=(e,t,r,n)=>{const{nodemap:o,datamap:i,config:s}=e,{BitField:a}=s,c=a.popcount(i,r),u=keyPosition(c),d=nodePosition(e,r),l=fork3(e,t);return l.datamap=a.unset(i,r),l.children.splice(u,2),l.nodemap=a.set(o,r),l.children.splice(d-1,0,n),l},mergeTwoLeaves=(e,t,r,n,o,i,s,a,c)=>{const{BitField:u,Path:d}=e;if(d.size<r)return new HashCollisionNode(t,2,[o,i,a,c],e);{const l=d.at(n,r),h=d.at(s,r);return l===h?new BitmapIndexedNode(t,u.empty(Math.pow(2,e.bitWidth)),u.from([l],Math.pow(2,e.bitWidth)),[mergeTwoLeaves(e,t,r+1,n,o,i,s,a,c)],e):new BitmapIndexedNode(t,u.from([l,h],Math.pow(2,e.bitWidth)),u.empty(Math.pow(2,e.bitWidth)),l<h?[o,i,a,c]:[a,c,o,i],e)}},keyAt=({children:e},t)=>e[keyPosition(t)],keyPosition=e=>2*e,valueAt=({children:e},t)=>e[valuePosition(t)],valuePosition=e=>2*e+1,resolveNode=(e,t)=>e.children[nodePosition(e,t)],nodePosition=({children:e,nodemap:t,config:r},n)=>e.length-1-r.BitField.popcount(t,n),canEdit=(e,t)=>null!=e&&e===t,hasSingleLeaf=e=>0===e.nodeArity&&1===e.dataArity,hasSingleNode=({config:{BitField:e},datamap:t,nodemap:r})=>0===e.popcount(t)&&1===e.popcount(r),import_murmurhash3js_revisited2=__toESM(require_murmurhash3js_revisited(),1);function fromNumberTo32BitBuf(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}var murmur332=from3({name:"murmur3-32",code:35,encode:e=>fromNumberTo32BitBuf(import_murmurhash3js_revisited2.default.x86.hash32(e))}),murmur3128=from3({name:"murmur3-128",code:34,encode:e=>bytes_exports2.fromHex(import_murmurhash3js_revisited2.default.x64.hash128(e))}),murmur364=from3({name:"murmur3-x64-64",code:34,encode:e=>bytes_exports2.fromHex(import_murmurhash3js_revisited2.default.x64.hash128(e)).subarray(0,8)}),utf82=new TextEncoder,hash64=e=>murmur364.encode(e),configure3=({bitWidth:e=8,hash:t=hash64}={})=>{const r=t(new Uint8Array).byteLength;return{from:e=>t(utf82.encode(e)),at:(t,n)=>{const o=n*e;if(o>r)throw new RangeError("Out of bounds");return toInt(t,o,e)},size:Math.ceil(8*r/e)}},toInt=(e,t,r)=>{let n=t/8|0,o=t%8,i=r,s=0;for(;i>0&&n<e.byteLength;){const t=8-o,r=t<i?t:i;s=(s<<r)+((255>>o&e[n])>>8-o-r),i-=r,n++,o=0}return s},Uint8Array_exports={};__export(Uint8Array_exports,{API:()=>api_exports,and:()=>and2,empty:()=>empty5,from:()=>from6,fromBytes:()=>fromBytes4,get:()=>get8,or:()=>or4,popcount:()=>popcount2,set:()=>set4,size:()=>size2,toBytes:()=>toBytes2,unset:()=>unset2});var empty5=(e=256)=>{if(e%8!=0)throw new Error("Must be multiple of 8");return new Uint8Array(e/8)},from6=(e,t)=>{let r=empty5(t);for(const t of e){const{byte:e,byteOffset:n,bitOffset:o}=at(r,t);r[n]=e|1<<o}return r},size2=e=>8*e.byteLength,at=(e,t)=>{const r=e.byteLength-1-(t/8|0),n=t%8;return{byte:e[r],byteOffset:r,bitOffset:n}},setByte=(e,t,r)=>{if(e[t]!==r){const n=e.slice(0);return n[t]=r,n}return e},set4=(e,t)=>{const{byte:r,byteOffset:n,bitOffset:o}=at(e,t);return setByte(e,n,r|1<<o)},unset2=(e,t)=>{const{byte:r,byteOffset:n,bitOffset:o}=at(e,t);return setByte(e,n,r&(255^1<<o))},get8=(e,t)=>{var{byte:r,bitOffset:n}=at(e,t);return 0!=(r>>n&1)},toBytes2=e=>e,fromBytes4=e=>e,popcount2=(e,t=8*e.byteLength)=>{const{byteOffset:r,bitOffset:n,byte:o}=at(e,t);let i=popcount(o,n),s=e.byteLength-1;for(;s>r;){const t=e[s];i+=bitCount(t),s--}return i},or4=(e,t)=>{const r=e.slice();let n=0;for(;n<e.length;)r[n]|=t[n],n++;return r},and2=(e,t)=>{const r=e.slice();let n=0;for(;n<e.length;)r[n]&=t[n],n++;return r},NOT_FOUND=new RangeError("Not Found"),configure4=({bitWidth:e=5,BitField:t=(5===e?Uint32_exports:Uint8Array_exports),Path:r=(5===e?configure2({bitWidth:e}):configure3({bitWidth:e}))}={})=>({bitWidth:e,BitField:t,Path:r}),has=(e,t)=>get7(e.root,t,NOT_FOUND)!==NOT_FOUND,get9=(e,t,r=void 0)=>get7(e.root,t,r),builder=e=>{const t={},r=configure4(e);return new HashMapBuilder(t,0,create11(r,t),r)},PersistentHashMap=class e{constructor(e=0,t,r){this.count=e,this.root=t,this.config=r}get size(){return this.count}clone(){return new e(this.count,this.root,this.config)}empty(){return new e(0,create11(this.config,null),this.config)}has(e){return has(this,e)}get(e){return get7(this.root,e,void 0)}set(t,r){const n={value:!1},o=set3(this.root,null,t,r,n);return o===this.root?this:new e(n.value?this.count+1:this.count,o,this.config)}delete(t){const r=remove2(this.root,null,t,{value:!1});return r===this.root?this:new e(this.count-1,r,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new HashMapBuilder({},this.count,this.root,this.config)}},HashMapBuilder=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.root=r,this.config=n}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,t){if(this.edit){const r={value:!1},n=set3(this.root,this.edit,e,t,r);return this.root!==n&&(this.root=n),r.value&&(this.count+=1),this}throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(0===this.count)return this;const t={value:!1},r=remove2(this.root,this.edit,e,t);return r!==this.root&&(this.root=r),t.value&&(this.count-=1),this}throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new PersistentHashMap(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}},utf83=new TextEncoder,hash642=e=>murmur364.encode(e),configure5=({bitWidth:e=8,hash:t=hash642})=>{const r=t(new Uint8Array).byteLength,n={bitWidth:e,hash:t,hashSize:r};return{at:(e,t)=>read3(e,t,n),from:e=>utf83.encode(e),size:1/0}},read3=(e,t=0,{bitWidth:r=8,hash:n,hashSize:o})=>{const i=8*o;let s=0,a=r,c=r*t;for(;a>0;){const t=c/i>>0,r=n(0===t?e:appendByte(e,t)),o=i<=c?c%i:c,u=i-o,d=u<a?u:a;s=(s<<d)+toInt(r,o,d),a-=d,c+=d}return s},appendByte=(e,t)=>{const r=new Uint8Array(e.byteLength+1).fill(t,e.byteLength);return r.set(e),r},bitWidth=8,config={bitWidth,Path:configure5({bitWidth})},builder2=(e=config)=>builder(e),HashMap=class extends Map{constructor(e=builder2()){super(),this.builder=e}clear(){this.builder=builder2()}delete(e){const{root:t}=this.builder;return this.builder.delete(e),this.builder.root!==t}forEach(e,t=this){for(const[r,n]of this.builder.root.entries())e.call(t,n,r,this)}get(e){return get9(this.builder,e)}has(e){return has(this.builder,e)}set(e,t){return this.builder.set(e,t),this}get size(){return this.builder.size}[Symbol.iterator](){return this.builder.root.entries()}entries(){return this.builder.root.entries()}keys(){return this.builder.root.keys()}values(){return this.builder.root.values()}},createWriter2=({writable:e,settings:t=defaults3()})=>new FileSystemWriter({writer:e.getWriter(),settings:t}),close8=async(e,{releaseLock:t=!0,closeWriter:r=!0}={})=>(r?await e.writer.close():t&&e.writer.releaseLock(),e),FileSystemWriter=class{constructor({writer:e,settings:t}){this.writer=e,this.settings=configure(t)}createFileWriter({settings:e=this.settings,metadata:t}={}){return create9({writer:this.writer,settings:e,metadata:t})}createDirectoryWriter({settings:e=this.settings,metadata:t}={}){return create10({writer:this.writer,settings:e,metadata:t})}close(e){return close8(this,e)}},BLOCK_SIZE_LIMIT=1048576,defaultCapacity=100*BLOCK_SIZE_LIMIT,withCapacity=(e=defaultCapacity)=>({highWaterMark:e,size:e=>e.bytes.length}),import_err_code9=__toESM(require_err_code(),1);function isAsyncIterable(e){return null!=e[Symbol.asyncIterator]}function last(e){if(isAsyncIterable(e))return(async()=>{let t;for await(const r of e)t=r;return t})();let t;for(const r of e)t=r;return t}var src_default=last,import_err_code8=__toESM(require_err_code(),1),code6=0,name6="identity",encode16=coerce2,digest=e=>create2(code6,encode16(e)),identity={code:code6,name:name6,encode:encode16,digest},import_err_code=__toESM(require_err_code(),1),resolve=async(e,t,r,n,o,i,s,a)=>{const c=await s.get(e,a),u=decode10(c);let d=u,l=r;for(;n.length>0;){const o=n[0];if(!(o in d))throw(0,import_err_code.default)(new Error(`No property named ${o} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),l=`${l}/${o}`;const s=CID2.asCID(d[o]);if(null!=s)return{entry:{type:"object",name:t,path:r,cid:e,node:c,depth:i,size:BigInt(c.length),content:async function*(){yield u}},next:{cid:s,name:o,path:l,toResolve:n}};d=d[o]}}return{entry:{type:"object",name:t,path:r,cid:e,node:c,depth:i,size:BigInt(c.length),content:async function*(){yield u}}}},dag_cbor_default=resolve,import_err_code3=__toESM(require_err_code(),1),CustomProgressEvent=class extends Event{constructor(e,t){super(e),this.detail=t}};function extractDataFromBlock(e,t,r,n){const o=BigInt(e.length),i=BigInt(t+o);return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.subarray(0,Number(n-t))),r>=t&&r<i&&(e=e.subarray(Number(r-t))),e)}var extract_data_from_block_default=extractDataFromBlock,import_err_code2=__toESM(require_err_code(),1),validateOffsetAndLength=(e,t=0,r=e)=>{const n=BigInt(e),o=BigInt(t??0);let i=BigInt(r);if(i!==n&&(i=o+i),i>n&&(i=n),o<0n)throw(0,import_err_code2.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw(0,import_err_code2.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(i<0n)throw(0,import_err_code2.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>n)throw(0,import_err_code2.default)(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:o,end:i}},validate_offset_and_length_default=validateOffsetAndLength,rawContent=e=>async function*(t={}){const{start:r,end:n}=validate_offset_and_length_default(e.length,t.offset,t.length),o=extract_data_from_block_default(e,0n,r,n);t.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:identity",{bytesRead:BigInt(o.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield o},resolve2=async(e,t,r,n,o,i,s,a)=>{if(n.length>0)throw(0,import_err_code3.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const c=decode8(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:rawContent(c.digest),depth:i,size:BigInt(c.digest.length),node:c.digest}}},identity_default=resolve2,import_err_code4=__toESM(require_err_code(),1),rawContent2=e=>async function*(t={}){const{start:r,end:n}=validate_offset_and_length_default(e.length,t.offset,t.length),o=extract_data_from_block_default(e,0n,r,n);t.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:raw",{bytesRead:BigInt(o.byteLength),totalBytes:n-r,fileSize:BigInt(e.byteLength)})),yield o},resolve3=async(e,t,r,n,o,i,s,a)=>{if(n.length>0)throw(0,import_err_code4.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const c=await s.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:rawContent2(c),depth:i,size:BigInt(c.length),node:c}}},raw_default=resolve3,import_err_code7=__toESM(require_err_code(),1),import_err_code5=__toESM(require_err_code(),1),import_reader3=__toESM(require_reader(),1),import_reader_buffer=__toESM(require_reader_buffer(),1),import_minimal2=__toESM(require_minimal(),1),import_writer2=__toESM(require_writer(),1),import_writer_buffer=__toESM(require_writer_buffer(),1);function configure6(){import_minimal2.default._configure(),import_reader3.default._configure(import_reader_buffer.default),import_writer2.default._configure(import_writer_buffer.default)}configure6();var methods=["uint64","int64","sint64","fixed64","sfixed64"],CODEC_TYPES,CODEC_TYPES2,Data2,UnixTime2,Metadata2;function patchReader(e){for(const t of methods){if(null==e[t])continue;const r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}function reader(e){return patchReader(new import_reader3.default(e))}function patchWriter(e){for(const t of methods){if(null==e[t])continue;const r=e[t];e[t]=function(e){return r.call(this,e.toString())}}return e}function writer(){return patchWriter(import_writer2.default.create())}function decodeMessage(e,t){const r=reader(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function encodeMessage(e,t){const r=writer();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}function createCodec(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function enumeration(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return createCodec("enum",CODEC_TYPES.VARINT,(function(e,r){const n=t(e);r.int32(n)}),(function(e){return t(e.int32())}))}function message(e,t){return createCodec("message",CODEC_TYPES.LENGTH_DELIMITED,e,t)}CODEC_TYPES2=CODEC_TYPES||(CODEC_TYPES={}),CODEC_TYPES2[CODEC_TYPES2.VARINT=0]="VARINT",CODEC_TYPES2[CODEC_TYPES2.BIT64=1]="BIT64",CODEC_TYPES2[CODEC_TYPES2.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",CODEC_TYPES2[CODEC_TYPES2.START_GROUP=3]="START_GROUP",CODEC_TYPES2[CODEC_TYPES2.END_GROUP=4]="END_GROUP",CODEC_TYPES2[CODEC_TYPES2.BIT32=5]="BIT32",function(e){let t;var r;let n;var o;let i;(r=t=e.DataType||(e.DataType={})).Raw="Raw",r.Directory="Directory",r.File="File",r.Metadata="Metadata",r.Symlink="Symlink",r.HAMTShard="HAMTShard",(o=n||(n={}))[o.Raw=0]="Raw",o[o.Directory=1]="Directory",o[o.File=2]="File",o[o.Metadata=3]="Metadata",o[o.Symlink=4]="Symlink",o[o.HAMTShard=5]="HAMTShard",function(e){e.codec=()=>enumeration(n)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==i&&(i=message(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(const e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),UnixTime2.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={blocksizes:[]},o=null==r?t.len:t.pos+r;for(;t.pos<o;){const r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=UnixTime2.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n}))),i),e.encode=t=>encodeMessage(t,e.codec()),e.decode=t=>decodeMessage(t,e.codec())}(Data2||(Data2={})),function(e){let t;e.codec=()=>(null==t&&(t=message(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>encodeMessage(t,e.codec()),e.decode=t=>decodeMessage(t,e.codec())}(UnixTime2||(UnixTime2={})),function(e){let t;e.codec=()=>(null==t&&(t=message(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();t>>>3==1?r.MimeType=e.string():e.skipType(7&t)}return r}))),t),e.encode=t=>encodeMessage(t,e.codec()),e.decode=t=>decodeMessage(t,e.codec())}(Metadata2||(Metadata2={}));var types={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},dirTypes=["directory","hamt-sharded-directory"],DEFAULT_FILE_MODE2=parseInt("0644",8),DEFAULT_DIRECTORY_MODE2=parseInt("0755",8),UnixFS=class e{constructor(e={type:"file"}){__publicField(this,"type"),__publicField(this,"data"),__publicField(this,"blockSizes"),__publicField(this,"hashType"),__publicField(this,"fanout"),__publicField(this,"mtime"),__publicField(this,"_mode"),__publicField(this,"_originalMode");const{type:t,data:r,blockSizes:n,hashType:o,fanout:i,mtime:s,mode:a}=e;if(null!=t&&!Object.values(types).includes(t))throw(0,import_err_code5.default)(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=r,this.hashType=o,this.fanout=i,this.blockSizes=n??[],this._originalMode=0,this.mode=a,this.mtime=s}static unmarshal(t){const r=Data2.decode(t),n=new e({type:types[null!=r.Type?r.Type.toString():"File"],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:null!=r.mtime?{secs:r.mtime.Seconds??0n,nsecs:r.mtime.FractionalNanoseconds}:void 0});return n._originalMode=r.mode??0,n}set mode(e){this._mode=null==e?this.isDirectory()?DEFAULT_DIRECTORY_MODE2:DEFAULT_FILE_MODE2:4095&e}get mode(){return this._mode}isDirectory(){return dirTypes.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Data2.DataType.Raw;break;case"directory":e=Data2.DataType.Directory;break;case"file":e=Data2.DataType.File;break;case"metadata":e=Data2.DataType.Metadata;break;case"symlink":e=Data2.DataType.Symlink;break;case"hamt-sharded-directory":e=Data2.DataType.HAMTShard;break;default:throw(0,import_err_code5.default)(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t,r,n=this.data;return null!=this.data&&0!==this.data.length||(n=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(this.mode??0),t!==DEFAULT_FILE_MODE2||this.isDirectory()||(t=void 0),t===DEFAULT_DIRECTORY_MODE2&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Data2.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}},import_sparse_array=__toESM(require_sparse_array(),1),identity_exports={};__export(identity_exports,{identity:()=>identity2});var identity2=from({prefix:"\0",name:"identity",encode:e=>toString(e),decode:e=>fromString(e)}),base2_exports={};__export(base2_exports,{base2:()=>base22});var base22=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base8_exports={};__export(base8_exports,{base8:()=>base8});var base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base10_exports={};__export(base10_exports,{base10:()=>base10});var base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base16_exports={};__export(base16_exports,{base16:()=>base16,base16upper:()=>base16upper});var base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base36_exports={};__export(base36_exports,{base36:()=>base36,base36upper:()=>base36upper});var base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base64_exports={};__export(base64_exports,{base64:()=>base642,base64pad:()=>base64pad2,base64url:()=>base64url2,base64urlpad:()=>base64urlpad2});var base642=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad2=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url2=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad2=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base256emoji_exports={};__export(base256emoji_exports,{base256emoji:()=>base256emoji});var alphabet=Array.from(""),alphabetBytesToChars=alphabet.reduce(((e,t,r)=>(e[r]=t,e)),[]),alphabetCharsToBytes=alphabet.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);function encode17(e){return e.reduce(((e,t)=>e+alphabetBytesToChars[t]),"")}function decode20(e){const t=[];for(const r of e){const e=alphabetCharsToBytes[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}var base256emoji=from({prefix:"",name:"base256emoji",encode:encode17,decode:decode20}),identity_exports2={};__export(identity_exports2,{identity:()=>identity3});var code7=0,name7="identity",encode18=coerce,digest2=e=>create(code7,encode18(e)),identity3={code:code7,name:name7,encode:encode18,digest:digest2},textEncoder5=new TextEncoder,textDecoder4=new TextDecoder,bases={...identity_exports,...base2_exports,...base8_exports,...base10_exports,...base16_exports,...base32_exports,...base36_exports,...base58_exports,...base64_exports,...base256emoji_exports},hashes={...sha2_browser_exports,...identity_exports2};function asUint8Array2(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function allocUnsafe(e=0){return null!=globalThis.Buffer?.allocUnsafe?asUint8Array2(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function createCodec2(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var string=createCodec2("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),ascii=createCodec2("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=allocUnsafe((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases},bases_default=BASES;function fromString5(e,t="utf8"){const r=bases_default[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):asUint8Array2(globalThis.Buffer.from(e,"utf-8"))}var Bucket=class e{constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new import_sparse_array.default,this.key=null}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((t,r)=>r instanceof e?t+r.leafCount():t+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const t=this._children.compactArray();for(const r of t)r instanceof e?yield*r.eachLeafSeries():yield r}serialize(t,r){return r(this._children.reduce(((n,o,i)=>(null!=o&&(o instanceof e?n.push(o.serialize(t,r)):n.push(t(o,i))),n)),[]))}async asyncTransform(e,t){return await asyncTransformBucket(this,e,t)}toJSON(){return this.serialize(mapNode,reduceNodes)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){const r=await this._findPlace(t),n=r.bucket._at(r.pos);if(!(n instanceof e))return null!=n&&n.key===t?n:void 0}async _findPlace(t){const r=this._options.hash("string"==typeof t?fromString5(t):t),n=await r.take(this._options.bits),o=this._children.get(n);return o instanceof e?await o._findPlace(r):{bucket:this,pos:n,hash:r,existingChild:o}}async _findNewBucketAndPos(t){const r=await this._findPlace(t);if(null!=r.existingChild&&r.existingChild.key!==t){const t=new e(this._options,r.bucket,r.pos);r.bucket._putObjectAt(r.pos,t);const n=await t._findPlace(r.existingChild.hash);return n.bucket._putAt(n,r.existingChild.key,r.existingChild.value),await t._findNewBucketAndPos(r.hash)}return r}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const t=this._children.find(exists);if(null!=t&&!(t instanceof e)){const e=t.hash;e.untake(this._options.bits);const r={pos:this._posAtParent,hash:e,bucket:this._parent};this._parent._putAt(r,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function exists(e){return Boolean(e)}function mapNode(e,t){return e.key}function reduceNodes(e){return e}async function asyncTransformBucket(e,t,r){const n=[];for(const o of e._children.compactArray())if(o instanceof Bucket)await asyncTransformBucket(o,t,r);else{const r=await t(o);n.push({bitField:e._children.bitField(),children:r})}return await r(n)}var START_MASKS=[255,254,252,248,240,224,192,128],STOP_MASKS=[1,3,7,15,31,63,127,255],ConsumableBuffer=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,o=Math.min(n,t);r=(r<<o)+byteBitsToInt(e,n-o,o),t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function byteBitsToInt(e,t,r){return(e&maskFor(t,r))>>>t}function maskFor(e,t){return START_MASKS[e]&STOP_MASKS[Math.min(t+e-1,7)]}function concat4(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=allocUnsafe(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return asUint8Array2(r)}function wrapHash(e){return function(t){return t instanceof InfiniteHash?t:new InfiniteHash(t,e)}}var InfiniteHash=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?concat4([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new ConsumableBuffer(t);this._buffers.push(r),this._availableBits+=r.availableBits()}};function createHAMT(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:wrapHash(e.hashFn)};return new Bucket(t)}var hashFn=async function(e){return(await murmur3128.encode(e)).slice(0,8).reverse()},addLinksToHamtBucket=async(e,t,r)=>{await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(2!==e.Name.length)await r.put(e.Name.substring(2),!0);else{const n=parseInt(e.Name,16);t._putObjectAt(n,new Bucket({hash:r._options.hash,bits:r._options.bits},t,n))}})))},toPrefix=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),toBucketPath=e=>{let t=e.bucket;const r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()},findShardCid=async(e,t,r,n,o)=>{if(null==n){const e=createHAMT({hashFn});n={rootBucket:e,hamtDepth:1,lastBucket:e}}await addLinksToHamtBucket(e.Links,n.lastBucket,n.rootBucket);const i=await n.rootBucket._findNewBucketAndPos(t);let s=toPrefix(i.pos);const a=toBucketPath(i);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],s=toPrefix(n.lastBucket._posAtParent));const c=e.Links.find((e=>{if(null==e.Name)return!1;const r=e.Name.substring(0,2),n=e.Name.substring(2);return r===s&&(""===n||n===t)}));if(null!=c)return null!=c.Name&&c.Name.substring(2)===t?c.Hash:(n.hamtDepth++,e=decode18(await r.get(c.Hash,o)),findShardCid(e,t,r,n,o))},find_cid_in_shard_default=findShardCid;function peekable(e){const[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}var src_default2=peekable;function isAsyncIterable2(e){return null!=e[Symbol.asyncIterator]}function filter(e,t){if(isAsyncIterable2(e))return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=src_default2(e),{value:n,done:o}=r.next();if(!0===o)return function*(){}();const i=t(n);if("function"==typeof i.then)return async function*(){await i&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const s=t;return function*(){!0===i&&(yield n);for(const e of r)s(e)&&(yield e)}()}var src_default3=filter;function isAsyncIterable3(e){return null!=e[Symbol.asyncIterator]}function map(e,t){if(isAsyncIterable3(e))return async function*(){for await(const r of e)yield t(r)}();const r=src_default2(e),{value:n,done:o}=r.next();if(!0===o)return function*(){}();const i=t(n);if("function"==typeof i.then)return async function*(){yield await i;for await(const e of r)yield t(e)}();const s=t;return function*(){yield i;for(const e of r)yield s(e)}()}var src_default4=map;function pDefer(){const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e}var CustomEvent=globalThis.CustomEvent??Event;async function*parallel(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);const n=null!=t.ordered&&t.ordered,o=new EventTarget,i=[];let s,a=pDefer(),c=pDefer(),u=!1,d=!1;function l(){return n?i[0]?.done:Boolean(i.find((e=>e.done)))}function*h(){for(;i.length>0&&i[0].done;){const e=i[0];if(i.shift(),!e.ok)throw d=!0,a.resolve(),e.err;yield e.value,a.resolve()}}function*f(){for(;l();)for(let e=0;e<i.length;e++)if(i[e].done){const t=i[e];if(i.splice(e,1),e--,!t.ok)throw d=!0,a.resolve(),t.err;yield t.value,a.resolve()}}for(o.addEventListener("task-complete",(()=>{c.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(i.length===r&&(a=pDefer(),await a.promise),d)break;const e={done:!1};i.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new CustomEvent("task-complete"))}),(t=>{e.done=!0,e.err=t,o.dispatchEvent(new CustomEvent("task-complete"))}))}u=!0,o.dispatchEvent(new CustomEvent("task-complete"))}catch(e){s=e,o.dispatchEvent(new CustomEvent("task-complete"))}}));;){if(l()||(c=pDefer(),await c.promise),null!=s)throw s;if(n?yield*h():yield*f(),u&&0===i.length)break}}var FixedFIFO=class{constructor(e){if(__publicField(this,"buffer"),__publicField(this,"mask"),__publicField(this,"top"),__publicField(this,"btm"),__publicField(this,"next"),!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}},FIFO=class{constructor(e={}){__publicField(this,"size"),__publicField(this,"hwm"),__publicField(this,"head"),__publicField(this,"tail"),this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}},AbortError=class extends Error{constructor(e,t){super(e??"The operation was aborted"),__publicField(this,"type"),__publicField(this,"code"),this.type="aborted",this.code=t??"ABORT_ERR"}};function pushable(e={}){return _pushable((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function _pushable(e,t){let r,n,o,i=(t=t??{}).onEnd,s=new FIFO,a=pDefer();const c=e=>null!=n?n(e):(s.push(e),r),u=e=>{if(o)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},d=e=>o?r:(o=!0,null!=e?(e=>(s=new FIFO,null!=n?n({error:e}):(s.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return s.isEmpty()?o?{done:!0}:await new Promise(((t,o)=>{n=i=>{n=null,s.push(i);try{t(e(s))}catch(e){o(e)}return r}})):e(s)}finally{s.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=pDefer()}))}},return:()=>(s=new FIFO,d(),{done:!0}),throw:e=>(d(e),{done:!0}),push:u,end:d,get readableLength(){return s.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),s.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new AbortError)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==i)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=i&&(i(e),i=void 0),{done:!0}),return:()=>(l.return(),null!=i&&(i(),i=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=i&&(i(e),i=void 0),r),get readableLength(){return l.readableLength}},r}function isAsyncIterable4(e){return null!=e[Symbol.asyncIterator]}function merge(...e){const t=[];for(const r of e)isAsyncIterable4(r)||t.push(r);return t.length===e.length?function*(){for(const e of t)yield*e}():async function*(){const t=pushable({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}})),yield*t}()}var src_default5=merge;function pipe(e,...t){if(null==e)throw new Error("Empty pipeline");if(isDuplex(e)){const t=e;e=()=>t.source}else if(isIterable(e)||isAsyncIterable5(e)){const t=e;e=()=>t}const r=[e,...t];if(r.length>1&&isDuplex(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)isDuplex(r[e])&&(r[e]=duplexPipelineFn(r[e]));return rawPipe(...r)}var rawPipe=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},isAsyncIterable5=e=>null!=e?.[Symbol.asyncIterator],isIterable=e=>null!=e?.[Symbol.iterator],isDuplex=e=>null!=e&&null!=e.sink&&null!=e.source,duplexPipelineFn=e=>t=>{const r=e.sink(t);if(null!=r?.then){const t=pushable({objectMode:!0});let n;r.then((()=>{t.end()}),(e=>{t.end(e)}));const o=e.source;if(isAsyncIterable5(o))n=async function*(){yield*o,t.end()};else{if(!isIterable(o))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");n=function*(){yield*o,t.end()}}return src_default5(t,n())}return e.source},directoryContent=(e,t,r,n,o,i,s)=>async function*(r={}){const a=r.offset??0,c=r.length??t.Links.length,u=t.Links.slice(a,c);r.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:directory",{cid:e})),yield*pipe(u,(e=>src_default4(e,(e=>async()=>{const t=e.Name??"",a=`${n}/${t}`;return(await o(e.Hash,t,a,[],i+1,s,r)).entry}))),(e=>parallel(e,{ordered:!0})),(e=>src_default3(e,(e=>null!=e))))},directory_default=directoryContent,import_err_code6=__toESM(require_err_code(),1),import_eventemitter3=__toESM(require_eventemitter3(),1),TimeoutError=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},AbortError2=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},getDOMException=e=>void 0===globalThis.DOMException?new AbortError2(e):new DOMException(e),getAbortedReason=e=>{const t=void 0===e.reason?getDOMException("This operation was aborted."):e.reason;return t instanceof Error?t:getDOMException(t)};function pTimeout(e,t,r,n){let o;const i=new Promise(((i,s)=>{if("number"!=typeof t||1!==Math.sign(t))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t!==Number.POSITIVE_INFINITY){if((n={customTimers:{setTimeout,clearTimeout},...n}).signal){const{signal:e}=n;e.aborted&&s(getAbortedReason(e)),e.addEventListener("abort",(()=>{s(getAbortedReason(e))}))}o=n.customTimers.setTimeout.call(void 0,(()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}const n=r instanceof Error?r:new TimeoutError("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),s(n)}),t),(async()=>{try{i(await e)}catch(e){s(e)}finally{n.customTimers.clearTimeout.call(void 0,o)}})()}else i(e)}));return i.clear=()=>{clearTimeout(o),o=void 0},i}function lowerBound(e,t,r){let n=0,o=e.length;for(;o>0;){const i=Math.trunc(o/2);let s=n+i;r(e[s],t)<=0?(n=++s,o-=i+1):o=i}return n}var __classPrivateFieldGet=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},_PriorityQueue_queue,PriorityQueue=class{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&__classPrivateFieldGet(this,_PriorityQueue_queue,"f")[this.size-1].priority>=t.priority)return void __classPrivateFieldGet(this,_PriorityQueue_queue,"f").push(r);const n=lowerBound(__classPrivateFieldGet(this,_PriorityQueue_queue,"f"),r,((e,t)=>t.priority-e.priority));__classPrivateFieldGet(this,_PriorityQueue_queue,"f").splice(n,0,r)}dequeue(){const e=__classPrivateFieldGet(this,_PriorityQueue_queue,"f").shift();return null==e?void 0:e.run}filter(e){return __classPrivateFieldGet(this,_PriorityQueue_queue,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return __classPrivateFieldGet(this,_PriorityQueue_queue,"f").length}};_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=function(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},__classPrivateFieldGet2=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pending,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_throwOnAbort,_PQueue_onEvent,AbortError3=class extends Error{},PQueue=class extends import_eventemitter3.default{constructor(e){var t,r,n,o;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pending.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(o=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==o?o:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,!0===e.throwOnTimeout,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,!1===e.autoStart,"f")}get concurrency(){return __classPrivateFieldGet2(this,_PQueue_concurrency,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:__classPrivateFieldGet2(this,_PQueue_throwOnTimeout,"f"),...t},new Promise(((r,n)=>{__classPrivateFieldGet2(this,_PQueue_queue,"f").enqueue((async()=>{var o,i,s;__classPrivateFieldSet(this,_PQueue_pending,(i=__classPrivateFieldGet2(this,_PQueue_pending,"f"),++i),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(s=__classPrivateFieldGet2(this,_PQueue_intervalCount,"f"),++s),"f");try{if(null===(o=t.signal)||void 0===o?void 0:o.aborted)throw new AbortError3("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=pTimeout(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_throwOnAbort).call(this,t.signal)]));const i=await n;r(i),this.emit("completed",i)}catch(e){if(e instanceof TimeoutError&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_next).call(this)}}),t),this.emit("add"),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return __classPrivateFieldGet2(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet2(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){0!==__classPrivateFieldGet2(this,_PQueue_queue,"f").size&&await __classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet2(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",(()=>__classPrivateFieldGet2(this,_PQueue_queue,"f").size<e))}async onIdle(){0===__classPrivateFieldGet2(this,_PQueue_pending,"f")&&0===__classPrivateFieldGet2(this,_PQueue_queue,"f").size||await __classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet2(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet2(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet2(this,_PQueue_pending,"f")}get isPaused(){return __classPrivateFieldGet2(this,_PQueue_isPaused,"f")}};async function walkDAG(e,t,r,n,o,i,s){if(t instanceof Uint8Array){const e=extract_data_from_block_default(t,n,o,i);return void r.push(e)}if(null==t.Data)throw(0,import_err_code6.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=UnixFS.unmarshal(t.Data)}catch(e){throw(0,import_err_code6.default)(e,"ERR_NOT_UNIXFS")}if(null!=a.data){const e=a.data,t=extract_data_from_block_default(e,n,o,i);r.push(t),n+=BigInt(t.byteLength)}const c=[];if(t.Links.length!==a.blockSizes.length)throw(0,import_err_code6.default)(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let e=0;e<t.Links.length;e++){const r=t.Links[e],s=n,u=s+a.blockSizes[e];if((o>=s&&o<u||i>=s&&i<=u||o<s&&i>u)&&c.push({link:r,blockStart:n}),(n=u)>i)break}await pipe(c,(t=>src_default4(t,(t=>async()=>{const r=await e.get(t.link.Hash,s);return{...t,block:r}}))),(e=>parallel(e,{ordered:!0})),(async t=>{for await(const{link:n,block:a,blockStart:c}of t){let t;switch(n.Hash.code){case code4:t=decode18(a);break;case code2:t=a;break;default:return void r.end((0,import_err_code6.default)(new Error(`Unsupported codec: ${n.Hash.code}`),"ERR_NOT_UNIXFS"))}const u=new PQueue({concurrency:1});u.on("error",(e=>{r.end(e)})),u.add((async()=>{s.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:file",{cid:n.Hash})),await walkDAG(e,t,r,c,o,i,s)})),await u.onIdle()}})),n>=i&&r.end()}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pending=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function(){return __classPrivateFieldGet2(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet2(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet2(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function(){return __classPrivateFieldGet2(this,_PQueue_pending,"f")<__classPrivateFieldGet2(this,_PQueue_concurrency,"f")},_PQueue_next=function(){var e;__classPrivateFieldSet(this,_PQueue_pending,(e=__classPrivateFieldGet2(this,_PQueue_pending,"f"),--e),"f"),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_onResumeInterval=function(){__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function(){const e=Date.now();if(void 0===__classPrivateFieldGet2(this,_PQueue_intervalId,"f")){const t=__classPrivateFieldGet2(this,_PQueue_intervalEnd,"f")-e;if(!(t<0))return void 0===__classPrivateFieldGet2(this,_PQueue_timeoutId,"f")&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout((()=>{__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)}),t),"f"),!0;__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet2(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet2(this,_PQueue_pending,"f"):0,"f")}return!1},_PQueue_tryToStartAnother=function(){if(0===__classPrivateFieldGet2(this,_PQueue_queue,"f").size)return __classPrivateFieldGet2(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet2(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),this.emit("empty"),0===__classPrivateFieldGet2(this,_PQueue_pending,"f")&&this.emit("idle"),!1;if(!__classPrivateFieldGet2(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet2(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet2(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet2(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const t=__classPrivateFieldGet2(this,_PQueue_queue,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0)}}return!1},_PQueue_initializeIntervalIfNeeded=function(){__classPrivateFieldGet2(this,_PQueue_isIntervalIgnored,"f")||void 0!==__classPrivateFieldGet2(this,_PQueue_intervalId,"f")||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval((()=>{__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)}),__classPrivateFieldGet2(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet2(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function(){0===__classPrivateFieldGet2(this,_PQueue_intervalCount,"f")&&0===__classPrivateFieldGet2(this,_PQueue_pending,"f")&&__classPrivateFieldGet2(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet2(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet2(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet2(this,_PQueue_pending,"f"):0,"f"),__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function(){for(;__classPrivateFieldGet2(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_throwOnAbort=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new AbortError3("The task was aborted."))}),{once:!0})}))},_PQueue_onEvent=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var fileContent=(e,t,r,n,o,i,s)=>async function*(n={}){const o=r.fileSize();if(void 0===o)throw new Error("File was a directory");const{start:i,end:a}=validate_offset_and_length_default(o,n.offset,n.length);if(0n===a)return;let c=0n;const u=a-i,d=pushable();n.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:file",{cid:e})),walkDAG(s,t,d,0n,i,a,n).catch((e=>{d.end(e)}));for await(const e of d)if(null!=e){if(c+=BigInt(e.byteLength),c>u)throw d.end(),(0,import_err_code6.default)(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");c===u&&d.end(),n.onProgress?.(new CustomProgressEvent("unixfs:exporter:progress:unixfs:file",{bytesRead:c,totalBytes:u,fileSize:o})),yield e}if(c<u)throw(0,import_err_code6.default)(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")},file_default=fileContent,hamtShardedDirectoryContent=(e,t,r,n,o,i,s)=>function(r={}){return r.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),listDirectory(t,n,o,i,s,r)};async function*listDirectory(e,t,r,n,o,i){const s=pipe(e.Links,(s=>src_default4(s,(s=>async()=>{const a=null!=s.Name?s.Name.substring(2):null;if(null!=a&&""!==a){const e=await r(s.Hash,a,`${t}/${a}`,[],n+1,o,i);return{entries:null==e.entry?[]:[e.entry]}}{const a=await o.get(s.Hash,i);return e=decode18(a),i.onProgress?.(new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:s.Hash})),{entries:listDirectory(e,t,r,n,o,i)}}}))),(e=>parallel(e,{ordered:!0})));for await(const{entries:e}of s)yield*e}var hamt_sharded_directory_default=hamtShardedDirectoryContent,findLinkCid=(e,t)=>{const r=e.Links.find((e=>e.Name===t));return r?.Hash},contentExporters={raw:file_default,file:file_default,directory:directory_default,"hamt-sharded-directory":hamt_sharded_directory_default,metadata:(e,t,r,n,o,i,s)=>()=>[],symlink:(e,t,r,n,o,i,s)=>()=>[]},unixFsResolver=async(e,t,r,n,o,i,s,a)=>{const c=decode18(await s.get(e,a));let u,d;if(null==t&&(t=e.toString()),null==c.Data)throw(0,import_err_code7.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{u=UnixFS.unmarshal(c.Data)}catch(e){throw(0,import_err_code7.default)(e,"ERR_NOT_UNIXFS")}if(null==r&&(r=t),n.length>0){let e;if(e="hamt-sharded-directory"===u?.type?await find_cid_in_shard_default(c,n[0],s):findLinkCid(c,n[0]),null==e)throw(0,import_err_code7.default)(new Error("file does not exist"),"ERR_NOT_FOUND");const t=n.shift();d={cid:e,toResolve:n,name:t??"",path:`${r}/${t}`}}const l=contentExporters[u.type](e,c,u,r,o,i,s);if(null==l)throw(0,import_err_code7.default)(new Error("could not find content exporter"),"ERR_NOT_FOUND");return u.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:l,unixfs:u,depth:i,node:c,size:u.fileSize()},next:d}:{entry:{type:"file",name:t,path:r,cid:e,content:l,unixfs:u,depth:i,node:c,size:u.fileSize()},next:d}},unixfs_v1_default=unixFsResolver,resolvers={[code4]:unixfs_v1_default,[code2]:raw_default,[code]:dag_cbor_default,[identity.code]:identity_default},resolve4=async(e,t,r,n,o,i,s)=>{const a=resolvers[e.code];if(null==a)throw(0,import_err_code8.default)(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return a(e,t,r,n,resolve4,o,i,s)},resolvers_default=resolve4,toPathComponents=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),cidAndRest=e=>{if(e instanceof Uint8Array)return{cid:CID2.decode(e),toResolve:[]};const t=CID2.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=toPathComponents(e);return{cid:CID2.parse(t[0]),toResolve:t.slice(1)}}throw(0,import_err_code9.default)(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*walkPath(e,t,r={}){let{cid:n,toResolve:o}=cidAndRest(e),i=n.toString(),s=i;const a=o.length;for(;;){const c=await resolvers_default(n,i,s,o,a,t,r);if(null==c.entry&&null==c.next)throw(0,import_err_code9.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(null!=c.entry&&(yield c.entry),null==c.next)return;o=c.next.toResolve,n=c.next.cid,i=c.next.name,s=c.next.path}}async function exporter(e,t,r={}){const n=await src_default(walkPath(e,t,r));if(null==n)throw(0,import_err_code9.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}var queuingStrategy=withCapacity(),settings=configure({fileChunkEncoder:raw_exports,smallFileEncoder:raw_exports,chunker:withMaxChunkSize(1048576),fileLayout:withWidth(1024)}),_file;async function encodeFile2(e){const t=createFileEncoderStream(e),r=await collect2(t);return{cid:r.at(-1).cid,blocks:r}}async function decodeFile(e,t,r){const n=await exporter(t.toString(),e,{length:r.size}),o=[];for await(const e of n.content())o.push(e);return new File(o,n.name,{type:r.type,lastModified:0})}function createFileEncoderStream(e){const{readable:t,writable:r}=new TransformStream({},queuingStrategy),n=createWriter2({writable:r,settings}),o=new UnixFSFileBuilder("",e);return(async()=>{await o.finalize(n),await n.close()})(),t}async function collect2(e){const t=[];return await e.pipeTo(new WritableStream({write(e){t.push(e)}})),t}var UnixFSFileBuilder=class{constructor(e,t){__privateAdd(this,_file,void 0),__publicField(this,"name"),this.name=e,__privateSet(this,_file,t)}async finalize(e){const t=create9(e);return await __privateGet(this,_file).stream().pipeTo(new WritableStream({async write(e){await t.write(e)}})),await t.close()}};async function applyBulkUpdateToCrdt(e,t,r,n){let o;for(const i of r){const s=await writeDocContent(e,i);o=await put2(e,t,i.key,s,n);const a=o.root.toString();if(!o.additions.some((e=>e.cid.toString()===a))&&!await e.get(o.root))throw new Error(`missing root in additions: ${o.additions.length} ${a} keys: ${r.map((e=>e.key)).toString()}`);for(const{cid:t,bytes:r}of[...o.additions,...o.removals,o.event])e.putSync(t,r);t=o.head}return{head:t}}async function writeDocContent(e,t){let r;t.del?r={del:!0}:(await processFiles(e,t.value),r={doc:t.value});const n=await encode8({value:r,hasher:sha256,codec:src_exports});return e.putSync(n.cid,n.bytes),n.cid}async function processFiles(e,t){t._files&&await processFileset(e,t._files),t._publicFiles&&await processFileset(e,t._publicFiles,!0)}async function processFileset(e,t,r=!1){const n=e.parent,o=new Transaction(n),i=[];for(const e in t)if(File===t[e].constructor){const r=t[e],{cid:n,blocks:s}=await encodeFile2(r);i.push(e);for(const e of s)o.putSync(e.cid,e.bytes);t[e]={cid:n,type:r.type,size:r.size}}if(i.length){const e=await(n.loader?.commit(o,{files:t},{public:r}));if(e)for(const r of i)t[r]={car:e,...t[r]}}}async function getValueFromCrdt(e,t,r){if(!t.length)throw new Error("Getting from an empty database");const n=await get4(e,t,r);if(!n)throw new Error(`Missing key ${r}`);return await getValueFromLink(e,n)}function readFiles(e,{doc:t}){t&&(t._files&&readFileset(e,t._files),t._publicFiles&&readFileset(e,t._publicFiles,!0))}function readFileset(e,t,r=!1){for(const n in t){const o=t[n];if(o.cid&&(r&&(o.url=`https://${o.cid.toString()}.ipfs.w3s.link/`),o.car&&e.loader)){const t=e.loader;o.file=async()=>await decodeFile({get:async e=>{const n=await t.loadFileCar(o.car,r),i=await n.get(e);if(!i)throw new Error(`Missing block ${e.toString()}`);return i.bytes}},o.cid,o)}t[n]=o}}async function getValueFromLink(e,t){const r=await e.get(t);if(!r)throw new Error(`Missing linked block ${t.toString()}`);const{value:n}=await decode12({bytes:r.bytes,hasher:sha256,codec:src_exports});return readFiles(e,n),n}_file=new WeakMap;var DirtyEventFetcher=class extends EventFetcher{async get(e){try{return await super.get(e)}catch(t){return console.error("missing event",e.toString(),t),{value:null}}}};async function clockChangesSince(e,t,r,n){const o=n.dirty?new DirtyEventFetcher(e):new EventFetcher(e),i=new Set;return{result:(await gatherUpdates(e,o,t,r,[],i,new Set,n.limit||1/0)).reverse(),head:t}}async function gatherUpdates(e,t,r,n,o=[],i,s,a){if(a<=0)return o;const c=r.map((e=>e.toString()));for(const e of n)if(c.includes(e.toString()))return o;for(const c of r){if(s.has(c.toString()))continue;s.add(c.toString());const{value:r}=await t.get(c);if(!r)continue;const{key:u,value:d}=r.data;if(i.has(u))r.parents&&(o=await gatherUpdates(e,t,r.parents,n,o,i,s,a));else{i.add(u);const l=await getValueFromLink(e,d);o.push({key:u,value:l.doc,del:l.del,clock:c}),a--,r.parents&&(o=await gatherUpdates(e,t,r.parents,n,o,i,s,a))}}return o}async function*getAllEntries(e,t){for await(const[r,n]of entries2(e,t)){const t=await getValueFromLink(e,n);yield{key:r,value:t.doc,del:t.del}}}async function*clockVis(e,t){for await(const r of vis(e,t))yield r}var isCompacting=!1;async function doCompact(e,t){if(isCompacting)return;isCompacting=!0;const r=new LoggingFetcher(e);for(const e of t)if(!await r.get(e))throw new Error("Missing head block: "+e.toString());for await(const e of getAllEntries(r,t));for await(const[,e]of entries2(r,t))if(!await r.get(e))throw new Error("Missing entry block: "+e.toString());for await(const e of vis(r,t));const n=await root(r,t);for(const{cid:e,bytes:t}of[...n.additions,...n.removals])r.loggedBlocks.putSync(e,t);await clockChangesSince(r,t,[],{});const o=await e.commitCompaction(r.loggedBlocks,t);return isCompacting=!1,o}async function getThatBlock({bytes:e}){const t=Uint8Array.from(atob(e),(e=>e.charCodeAt(0))),{cid:r,value:n}=await decode12({bytes:t,codec:src_exports,hasher:sha256});return new Block({cid:r,value:n,bytes:t})}async function getBlock(e,t){const r=await e.get(parse3(t));if(!r)throw new Error(`Missing block ${t}`);const{cid:n,value:o}=await decode12({bytes:r.bytes,codec:src_exports,hasher:sha256});return new Block({cid:n,value:o,bytes:r.bytes})}var _IdxLoader=class e extends Loader{constructor(t,r,n){super(t,n),__publicField(this,"crdt"),__publicField(this,"defaultHeader",e.defaultHeader),this.crdt=r}async _applyCarHeader(e){for(const[t,r]of Object.entries(e.indexes))index({_crdt:this.crdt},t,void 0,r)}makeCarHeader({indexes:e},t,r=!1){return r?{indexes:e,cars:[],compact:t}:{indexes:e,cars:t,compact:[]}}};__publicField(_IdxLoader,"defaultHeader",{cars:[],compact:[],indexes:new Map});var IdxLoader=_IdxLoader,_DbLoader=class e extends Loader{constructor(t,r,n){super(t,n),__publicField(this,"defaultHeader",e.defaultHeader),__publicField(this,"clock"),__publicField(this,"awaitingCompact",!1),__publicField(this,"compacting",Promise.resolve()),__publicField(this,"writing",Promise.resolve()),__publicField(this,"remoteFileStore"),__publicField(this,"fileStore"),this.fileStore=new DataStore2(this),this.clock=r}async _readyForMerge(){await this.compacting}async _setWaitForWrite(e){const t=this.writing;return this.writing=t.then((async()=>(await e(),t))),this.writing.then((()=>{}))}async compact(e){await this.ready,this.carLog.length<2||this.awaitingCompact||(this.awaitingCompact=!0,this.compacting=this._setWaitForWrite((async()=>{if(this.isCompacting)return;if(this.isWriting)return;this.isCompacting=!0;const t=this.clock.head,r=await doCompact(e,this.clock.head);return await this.clock.applyHead(null,t,t,null),r})),this.compacting.finally((()=>{this.isCompacting=!1,this.awaitingCompact=!1})),await this.compacting)}async loadFileCar(e,t=!1){return await this.storesLoadCar(e,this.fileStore,this.remoteFileStore,t)}async _applyCarHeader(e,t=!1){t?await this.clock.applyHead(null,e.head,this.clock.head):await this.clock.applyHead(null,e.head,[])}makeCarHeader(e,t,r=!1){if(isFileResult(e)){const t=[];for(const[,r]of Object.entries(e.files))t.push(r.cid);return{files:t}}{const{head:n}=e;return r?{head:n,cars:[],compact:t}:{head:n,cars:t,compact:[]}}}};__publicField(_DbLoader,"defaultHeader",{cars:[],compact:[],head:[]});var DbLoader=_DbLoader;function isFileResult(e){return e&&void 0!==e.files}var Transaction=class extends MemoryBlockstore{constructor(e){super(),__publicField(this,"parent"),e.transactions.add(this),this.parent=e}async get(e){return this.parent.get(e)}async superGet(e){return super.get(e)}},FireproofBlockstore=class{constructor(e,t,r){if(__publicField(this,"ready"),__publicField(this,"name",null),__publicField(this,"loader",null),__publicField(this,"opts",{}),__publicField(this,"transactions",new Set),this.opts=r||this.opts,e){if(this.name=e,!t)throw new Error("missing loader");this.loader=t,this.ready=this.loader.ready}else this.ready=Promise.resolve()}async put(){throw new Error("use a transaction to put")}async get(e){if(!e)throw new Error("required cid");for(const t of this.transactions){const r=await t.superGet(e);if(r)return r}if(this.loader)return await this.loader.getBlock(e)}async commitCompaction(e,t){return await this.loader.commit(e,{head:t},{compact:!0,noLoader:!0})}async*entries(){const e=new Set;for(const t of this.transactions)for await(const r of t.entries())e.has(r.cid.toString())||(e.add(r.cid.toString()),yield r)}async executeTransaction(e,t){const r=new Transaction(this),n=await e(r),{car:o,done:i}=await t(r,n);return o?{...i,car:o}:i}},IndexBlockstore=class extends FireproofBlockstore{constructor(e,t,r){e?super(e,new IdxLoader(e,t,r),r):super(null)}async transaction(e,t){return this.executeTransaction(e,(async(e,r)=>(t.set(r.name,r),{car:await(this.loader?.commit(e,{indexes:t})),done:r})))}},TransactionBlockstore=class extends FireproofBlockstore{constructor(e,t,r){e?super(e,new DbLoader(e,t,r),r):super(null)}async transaction(e,t,r={noLoader:!1}){return this.executeTransaction(e,(async(e,t)=>({car:await(this.loader?.commit(e,t,r)),done:t})))}},LoggingFetcher=class{constructor(e){__publicField(this,"blocks"),__publicField(this,"loader",null),__publicField(this,"loggedBlocks"),this.blocks=e,this.loader=e.loader,this.loggedBlocks=new Transaction(e)}async get(e){const t=await this.blocks.get(e);return t&&this.loggedBlocks.putSync(e,t.bytes),t}};function applyHeadQueue(e){const t=[];let r=!1;async function*n(){if(r||0===t.length)return;r=!0;const o=[];try{for(;t.length>0;){t.sort(((e,t)=>t.updates?1:-1));const r=t.shift();if(r&&(await e(r.id,r.tblocks,r.newHead,r.prevHead,r.updates),r.updates&&o.push(...r.updates),!t.some((e=>e.updates))||r.updates)){const e=t.every((e=>null!==e.updates));yield{updates:o,all:e},o.length=0}}}finally{r=!1;const e=n();let t=await e.next();for(;!t.done;)t=await e.next()}}return{push:e=>(t.push(e),n())}}var CRDTClock=class{constructor(){__publicField(this,"head",[]),__publicField(this,"zoomers",new Set),__publicField(this,"watchers",new Set),__publicField(this,"emptyWatchers",new Set),__publicField(this,"blocks",null),__publicField(this,"applyHeadQueue"),this.applyHeadQueue=applyHeadQueue(this.int_applyHead.bind(this))}setHead(e){this.head=e}async applyHead(e,t,r,n=null){const o=Math.random().toString().slice(2,8);for await(const{updates:i,all:s}of this.applyHeadQueue.push({id:o,tblocks:e,newHead:t,prevHead:r,updates:n}))(async(e,t)=>{Promise.resolve().then((async()=>{let n=e;this.watchers.size&&!t&&(n=(await clockChangesSince(this.blocks,this.head,r,{})).result),this.zoomers.forEach((e=>e())),this.notifyWatchers(n||[])}))})([...i],s)}async int_applyHead(e,t,r,n,o=null){const i=this.head.sort(((e,t)=>e.toString().localeCompare(t.toString())));if((r=r.sort(((e,t)=>e.toString().localeCompare(t.toString())))).map((e=>{if(!this.blocks.get(e))throw new Error("int_applyHead missing block: "+e.toString())})),i.toString()===r.toString())return;const s=n.sort(((e,t)=>e.toString().localeCompare(t.toString())));if(i.toString()===s.toString())return void this.setHead(r);let a=this.head;await(async(e,t)=>{if(!this.blocks)throw new Error("missing blocks");return await this.blocks.transaction((async e=>{for(const t of r)try{a=await advance(e,a,t)}catch(e){console.error("failed to advance",t.toString(),e);continue}const t=await root(e,a);for(const{cid:r,bytes:n}of[...t.additions,...t.removals])e.putSync(r,n);return{head:a}}),void 0,{noLoader:!1})})(),this.setHead(a)}notifyWatchers(e){this.emptyWatchers.forEach((e=>e())),this.watchers.forEach((t=>t(e||[])))}onTick(e){this.watchers.add(e)}onTock(e){this.emptyWatchers.add(e)}onZoom(e){this.zoomers.add(e)}},CRDT=class{constructor(e,t){__publicField(this,"name"),__publicField(this,"opts",{}),__publicField(this,"ready"),__publicField(this,"blocks"),__publicField(this,"indexBlocks"),__publicField(this,"indexers",new Map),__publicField(this,"clock",new CRDTClock),this.name=e||null,this.opts=t||this.opts,this.blocks=new TransactionBlockstore(this.name,this.clock,this.opts),this.clock.blocks=this.blocks,this.indexBlocks=new IndexBlockstore(this.opts.persistIndexes&&this.name?this.name+".idx":null,this,this.opts),this.ready=Promise.all([this.blocks.ready,this.indexBlocks.ready]).then((()=>{})),this.clock.onZoom((()=>{for(const e of this.indexers.values())e._resetIndex()})),this.clock.onTock((async()=>{this.blocks.loader&&this.blocks.loader.carLog.length<100||await this.compact()}))}async bulk(e,t){await this.ready;const r=this.blocks.loader,n=[...this.clock.head],o=(async()=>{if(await(r?.compacting),r?.isCompacting)throw new Error("cant bulk while compacting");const o=await this.blocks.transaction((async n=>{const{head:o}=await applyBulkUpdateToCrdt(n,this.clock.head,e,t);return e=e.map((({key:e,value:t,del:r,clock:n})=>(readFiles(this.blocks,{doc:t}),{key:e,value:t,del:r,clock:n}))),r?.awaitingCompact&&console.log("missing?",o.toString()),r?.isCompacting&&console.log("compacting?",o.toString()),{head:o}}));return await this.clock.applyHead(null,o.head,n,e),o})();if(r){const e=r.writing;r.writing=e.then((async()=>(r.isWriting=!0,await o,r.isWriting=!1,e)))}return await o}async allDocs(){await this.ready;const e=[];for await(const t of getAllEntries(this.blocks,this.clock.head))e.push(t);return{result:e,head:this.clock.head}}async vis(){await this.ready;const e=[];for await(const t of clockVis(this.blocks,this.clock.head))e.push(t);return e.join("\n")}async getBlock(e){return await this.ready,await getBlock(this.blocks,e)}async getThatBlock(){return await getThatBlock({cid:"bafyreib7ee4pscqpuioxobmh3ac5xbbslypmaqqbkugalhw67hnco6dvoa",bytes:"omRkYXRhpGNrZXl4JDAxOGFmNzdiLWZmMTUtNzI5Ny04ODZiLTYwMjViM2MxODI2ZWRyb2902CpYJQABcRIgKVLI53HO1TFDbPUoSaybd0mop2oX/CRFm1RrpiY4ne9kdHlwZWNwdXRldmFsdWXYKlglAAFxEiAGw53MVtPzeeGT/itfdLBfCVu6MTj96AHU6v9a3K/wYGdwYXJlbnRzgdgqWCUAAXESIJiL5qjdpgghUfbQLpKJeCgMX+ubhoTpYBoZHYdzbQJ/"})}async get(e){await this.ready;const t=await getValueFromCrdt(this.blocks,this.clock.head,e);return t.del?null:t}async changes(e=[],t={}){return await this.ready,await clockChangesSince(this.blocks,this.clock.head,e,t)}async compact(){await this.ready,this.blocks.loader&&await this.blocks.loader.compact(this.blocks)}},Database=class{constructor(e,t){__publicField(this,"name"),__publicField(this,"opts",{}),__publicField(this,"_listening",!1),__publicField(this,"_listeners",new Set),__publicField(this,"_noupdate_listeners",new Set),__publicField(this,"_crdt"),__publicField(this,"_writeQueue"),this.name=e||null,this.opts=t||this.opts,this._crdt=new CRDT(e,this.opts),this._writeQueue=writeQueue((async e=>await this._crdt.bulk(e))),this._crdt.clock.onTock((()=>{this._no_update_notify()}))}async get(e){const t=await this._crdt.get(e).catch((t=>{throw t.message=`Not found: ${e} - `+t.message,t}));if(!t)throw new Error(`Not found: ${e}`);const{doc:r}=t;return{_id:e,...r}}async put(e){const{_id:t,...r}=e,n=t||uuidv7(),o=await this._writeQueue.push({key:n,value:r});return{id:n,clock:o?.head}}async del(e){const t=await this._writeQueue.push({key:e,del:!0});return{id:e,clock:t?.head}}async changes(e=[],t={}){const{result:r,head:n}=await this._crdt.changes(e,t);return{rows:r.map((({key:e,value:t,del:r,clock:n})=>({key:e,value:r?{_id:e,_deleted:!0}:{_id:e,...t},clock:n}))),clock:n}}async allDocs(){const{result:e,head:t}=await this._crdt.allDocs();return{rows:e.map((({key:e,value:t,del:r})=>({key:e,value:r?{_id:e,_deleted:!0}:{_id:e,...t}}))),clock:t}}subscribe(e,t){return t?(this._listening||(this._listening=!0,this._crdt.clock.onTick((e=>{this._notify(e)}))),this._listeners.add(e),()=>{this._listeners.delete(e)}):(this._noupdate_listeners.add(e),()=>{this._noupdate_listeners.delete(e)})}async query(e,t={}){const r="string"==typeof e?index({_crdt:this._crdt},e):index({_crdt:this._crdt},makeName(e.toString()),e);return await r.query(t)}async compact(){await this._crdt.compact()}async getDashboardURL(e=!0){const t="https://dashboard.fireproof.storage/";if(!this._crdt.blocks.loader?.remoteCarStore)return new URL("/howto",t);e&&await this.compact();const r=await(this._crdt.blocks.loader?.metaStore?.load());if(!r)throw new Error("Can't sync empty database: save data first");if(r.length>1)throw new Error("Can't sync database with split heads: make an update first");const n=r[0],o={car:n.car.toString()};n.key&&(o.key=n.key.toString()),this.name&&(o.name=this.name);const i=new URL("/import#"+new URLSearchParams(o).toString(),t);return console.log("Import to dashboard: "+i.toString()),i}openDashboard(){this.getDashboardURL().then((e=>{e&&window.open(e.toString(),"_blank")}))}async _notify(e){if(this._listeners.size){const t=e.map((({key:e,value:t})=>({_id:e,...t})));for(const e of this._listeners)await(async()=>await e(t))().catch((e=>{console.error("subscriber error",e)}))}}async _no_update_notify(){if(this._noupdate_listeners.size)for(const e of this._noupdate_listeners)await(async()=>await e([]))().catch((e=>{console.error("subscriber error",e)}))}};function fireproof(e,t){return Database.databases.has(e)||Database.databases.set(e,new Database(e,t)),Database.databases.get(e)}function makeName(e){let t=null;return 0===Array.from(e.matchAll(/\(([^,()]+,\s*[^,()]+|\[[^\]]+\],\s*[^,()]+)\)/g),(e=>e[1].trim())).length&&(t=/=>\s*(.*)/.exec(e)),t?t[1]:e}__publicField(Database,"databases",new Map)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";var e=__webpack_require__(887);function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(){r=function(){return n};var e,n={},o=Object.prototype,i=o.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),a=new D(n||[]);return s(i,"_invoke",{value:B(e,r,a)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=h;var p="suspendedStart",y="suspendedYield",m="executing",g="completed",w={};function b(){}function _(){}function v(){}var k={};l(k,c,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(N([])));T&&T!==o&&i.call(T,c)&&(k=T);var S=v.prototype=b.prototype=Object.create(k);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,r){function n(o,s,a,c){var u=f(e[o],e,s);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==t(l)&&i.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):r.resolve(l).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var o;s(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function B(t,r,n){var o=p;return function(i,s){if(o===m)throw new Error("Generator is already running");if(o===g){if("throw"===i)throw s;return{value:e,done:!0}}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var c=A(a,n);if(c){if(c===w)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=f(t,r,n);if("normal"===u.type){if(o=n.done?g:y,u.arg===w)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),w;var i=f(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,w;var s=i.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,w):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,w)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function N(r){if(r||""===r){var n=r[c];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var o=-1,s=function t(){for(;++o<r.length;)if(i.call(r,o))return t.value=r[o],t.done=!1,t;return t.value=e,t.done=!0,t};return s.next=s}}throw new TypeError(t(r)+" is not iterable")}return _.prototype=v,s(S,"constructor",{value:v,configurable:!0}),s(v,"constructor",{value:_,configurable:!0}),_.displayName=l(v,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,d,"GeneratorFunction")),e.prototype=Object.create(S),e},n.awrap=function(e){return{__await:e}},x(C.prototype),l(C.prototype,u,(function(){return this})),n.AsyncIterator=C,n.async=function(e,t,r,o,i){void 0===i&&(i=Promise);var s=new C(h(e,t,r,o),i);return n.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x(S),l(S,d,"Generator"),l(S,c,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=N,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return a.type="throw",a.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),u=i.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,w):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),w}},n}function n(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var s=e.apply(t,r);function a(e){n(s,o,i,a,c,"next",e)}function c(e){n(s,o,i,a,c,"throw",e)}a(void 0)}))}}var i=[];Object.keys(localStorage).forEach((function(e){if(e.includes("fp.0.14.meta.")){var t=e.slice(13).split(".");i.push(t[0])}})),o(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("This is the array of database names",i),e.next=3,chrome.runtime.sendMessage(i);case 3:t=e.sent,console.log(t);case 5:case"end":return e.stop()}}),e)})))(),chrome.runtime.onMessage.addListener((function(t,n,i){function s(){return(s=o(r().mark((function n(){var o,i,s;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=(0,e.fireproof)(t.data),console.log("This is the result from fireproof",o),r.next=4,o.allDocs();case 4:return i=r.sent,console.log("The query result",i),s={data:i.rows,type:"document"},r.next=9,chrome.runtime.sendMessage(s);case 9:r.sent;case 10:case"end":return r.stop()}}),n)})))).apply(this,arguments)}console.log("This is the click event data received from the service worker",t.data),function(){s.apply(this,arguments)}()}))})()})();